<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="icon" type="image/png" href="../favicon.png">
    <link rel="apple-touch-icon" href="../apple-touch-icon.png">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hammadde Module | Cable Factory ERP</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --bg: #f3f3f3;
            --fg: #000000;
            --gray-100: #f3f4f6;
            --gray-300: #d1d5db;
            --positive: #16a34a;
            --negative: #dc2626;
            --accent: #2563eb;
            --turquoise: #00b5ad;
        }
        body { font-family: 'IBM Plex Mono', monospace; background: var(--bg); color: var(--fg); font-size: 12px; line-height: 1.3; }
        .nav { position: sticky; top: 0; z-index: 50; border-bottom: 2px solid var(--fg); background: var(--bg); }
        .nav-container { max-width: 1400px; margin: 0 auto; padding: 0 64px; height: 56px; display: flex; align-items: center; }
        .nav-left { display: flex; align-items: center; gap: 12px; }
        .nav-logo { font-size: 18px; font-weight: 700; letter-spacing: 2px; text-decoration: none; color: var(--fg); }
        .nav-right { margin-left: auto; }
        .nav-link-small { color: var(--fg); text-decoration: underline; font-size: 11px; }
        .nav-divider { color: var(--fg); font-size: 14px; font-weight: 300; }
        .report { max-width: 1400px; margin: 0 auto; padding: 24px 64px; }
        .report h1 { font-size: 28px; margin-bottom: 8px; letter-spacing: 2px; }
        .report h2 { font-size: 18px; margin-top: 36px; margin-bottom: 12px; border-bottom: 2px solid #000; padding-bottom: 4px; scroll-margin-top: 72px; }
        .report h3 { font-size: 14px; margin-top: 20px; margin-bottom: 8px; }
        .report h4 { font-size: 12px; margin-top: 14px; margin-bottom: 6px; }
        .report p { font-size: 13px; line-height: 1.6; margin-bottom: 12px; }
        .report ul { font-size: 13px; margin: 12px 0; padding-left: 20px; }
        .report li { margin-bottom: 6px; line-height: 1.5; }
        .report ol { font-size: 13px; margin: 12px 0; padding-left: 20px; }
        .report ol li { margin-bottom: 6px; line-height: 1.5; }
        .report .subtitle { font-size: 14px; color: #666; margin-bottom: 4px; }
        .report .authors { font-size: 12px; color: #888; margin-bottom: 32px; }
        .report code { background: #e5e5e0; padding: 1px 5px; font-size: 12px; }
        .report pre { background: #1a1a2e; color: #e0e0e0; padding: 16px; margin: 12px 0; overflow-x: auto; font-size: 12px; line-height: 1.5; border: 2px solid #000; }
        .report pre .comment { color: #6a9955; }
        .report pre .keyword { color: #569cd6; }
        .report pre .string { color: #ce9178; }
        .report pre .decorator { color: #dcdcaa; }
        .report .abstract { background: #f5f5f0; padding: 16px; margin: 20px 0; border-left: 3px solid #000; }
        .report .finding { background: #fffbe6; padding: 12px; margin: 12px 0; border: 1px solid #e6d600; }
        .report .warning { background: #fee2e2; padding: 12px; margin: 12px 0; border: 1px solid #dc2626; }
        .report .discovery { background: #e6ffe6; padding: 12px; margin: 12px 0; border: 1px solid #0a0; }
        .report .insight { background: #eff6ff; padding: 12px; margin: 12px 0; border: 1px solid #2563eb; }
        .report .philosophy { background: #faf5ff; padding: 12px; margin: 12px 0; border: 1px solid #7c3aed; }
        .stat-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin: 16px 0; }
        .stat-grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin: 16px 0; }
        .stat-box { background: #f3f4f6; padding: 12px; text-align: center; border: 2px solid #000; }
        .stat-box .value { font-size: 24px; font-weight: bold; }
        .stat-box .label { font-size: 10px; color: #666; margin-top: 2px; }
        .report table { width: auto; border-collapse: collapse; border: 2px solid #000; margin: 16px 0; }
        .report tr:first-child { background: #f3f4f6; border-bottom: 2px solid #000; }
        .report th { padding: 4px 10px; text-align: left; font-size: 0.65rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.03em; white-space: nowrap; border-right: 2px solid #000; background: #f3f4f6; }
        .report th:last-child { border-right: none; }
        .report tr:not(:first-child) { border-bottom: 1px solid #d1d5db; }
        .report tr:last-child { border-bottom: none; }
        .report td { padding: 4px 10px; font-size: 0.75rem; border-right: 2px solid #000; }
        .report td:last-child { border-right: none; }
        .report tr:not(:first-child):hover { background: rgba(0,0,0,0.02); }
        .flow { display: flex; align-items: center; gap: 8px; margin: 16px 0; flex-wrap: wrap; }
        .flow-box { padding: 8px 14px; border: 2px solid #000; font-size: 12px; font-weight: 700; text-align: center; min-width: 100px; }
        .flow-arrow { font-size: 18px; font-weight: 700; }
        .flow-box.done { background: #dcfce7; border-color: #16a34a; }
        .flow-box.active { background: #dbeafe; border-color: #2563eb; }
        .flow-box.pending { background: #f3f4f6; }
        .arch-box { background: #fff; border: 2px solid #000; padding: 16px; margin: 12px 0; }
        .arch-box h4 { font-size: 14px; margin-bottom: 8px; margin-top: 0; }
        .arch-box p { font-size: 12px; line-height: 1.5; }
        .arch-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 16px; margin: 16px 0; }
        .back-link { display: inline-block; font-size: 12px; color: #666; text-decoration: none; margin-bottom: 24px; padding: 8px 0; }
        .back-link:hover { color: #000; }
        .back-link::before { content: "\2190  "; }
        .good { color: #16a34a; font-weight: 700; }
        .bad { color: #dc2626; font-weight: 700; }

        .submod-card { background: #fff; border: 2px solid #000; padding: 16px; margin: 10px 0; display: flex; align-items: flex-start; gap: 16px; }
        .submod-num { background: #000; color: #fff; font-size: 13px; font-weight: 700; min-width: 36px; height: 36px; padding: 0 8px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        .submod-body { flex: 1; }
        .submod-body h4 { font-size: 14px; margin: 0 0 4px 0; }
        .submod-body p { font-size: 12px; color: #555; margin: 0 0 6px 0; line-height: 1.4; }
        .submod-tags { display: flex; gap: 6px; flex-wrap: wrap; }
        .submod-tag { font-size: 10px; padding: 2px 6px; background: #f3f4f6; border: 1px solid #d1d5db; }

        @media (max-width: 768px) {
            .report { padding: 16px; }
            .nav-container { padding: 0 16px; }
            .stat-grid, .stat-grid-3 { grid-template-columns: repeat(2, 1fr); }
            .flow { flex-direction: column; align-items: stretch; }
            .flow-arrow { transform: rotate(90deg); text-align: center; }
            .arch-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <nav class="nav">
        <div class="nav-container">
            <div class="nav-left">
                <a href="erp-system.html" class="nav-logo">ERP SYSTEM</a>
            </div>
            <div class="nav-right">
                <a href="erp-mod-hammadde-tr.html" class="nav-link-small">TR</a>
                <span class="nav-divider">|</span>
                <a href="erp-mod-hammadde.html" class="nav-link-small" style="font-weight: 700;">EN</a>
            </div>
        </div>
    </nav>

    <main class="report">
        <a href="erp-deep-dives.html" class="back-link">Back to Modules</a>
        <h1>HAMMADDE &mdash; RAW MATERIALS</h1>
        <p class="subtitle">The supply chain from purchase order to QR-coded inventory. Every gram of copper, tin, plastic, catalyst, dye, palette, and reel &mdash; tracked from the moment it enters the factory gate.</p>
        <p class="authors">February 2026 &bull; Solen Kablo &bull; Living Document</p>

        <div class="abstract">
            <p style="margin-bottom: 0;"><strong>Hammadde is where physical material meets digital tracking.</strong> A cable factory consumes eight categories of raw materials: copper wire rods, tin ingots, plastic granules, catalysts, dyes, anti-rodent compounds, palettes (wooden shipping platforms), and reels (cable drums). Each one arrives from a supplier, gets weighed, photographed, assigned a unique QR code, and entered into the system. From that moment, the material is traceable &mdash; through production consumption, remaining weight tracking, and all the way to the finished cable on the reel. Hammadde also manages the entire purchase order lifecycle: from creating orders to tracking delivery dates, recording date-change reasons, and rating supplier performance after delivery.</p>
        </div>

        <div class="stat-grid">
            <div class="stat-box">
                <div class="value" style="color: var(--accent);">4</div>
                <div class="label">SUBMODULES</div>
            </div>
            <div class="stat-box">
                <div class="value" style="color: var(--turquoise);">~30</div>
                <div class="label">API ENDPOINTS</div>
            </div>
            <div class="stat-box">
                <div class="value">6</div>
                <div class="label">DATABASE TABLES</div>
            </div>
            <div class="stat-box">
                <div class="value" style="color: var(--positive);">5100+</div>
                <div class="label">LINES OF FRONTEND</div>
            </div>
        </div>

        <!-- TABLE OF CONTENTS -->
        <div style="background: #fff; border: 2px solid #000; padding: 20px 28px; margin: 24px 0;">
            <h3 style="margin: 0 0 12px 0; font-size: 14px; letter-spacing: 1px;">TABLE OF CONTENTS</h3>
            <div style="columns: 2; column-gap: 32px; font-size: 12px; line-height: 2;">
                <a href="#sec-1" style="text-decoration: none; color: var(--fg); display: block;"><strong>1.</strong> What Hammadde Does</a>
                <a href="#sec-2" style="text-decoration: none; color: var(--fg); display: block;"><strong>2.</strong> The Data Flow</a>
                <a href="#sec-3" style="text-decoration: none; color: var(--fg); display: block;"><strong>3.</strong> The Database Layer</a>
                <a href="#sec-4" style="text-decoration: none; color: var(--fg); display: block;"><strong>4.</strong> The Backend Architecture</a>
                <a href="#sec-5" style="text-decoration: none; color: var(--fg); display: block;"><strong>5.</strong> The Frontend</a>
                <a href="#sec-6" style="text-decoration: none; color: var(--fg); display: block;"><strong>6.</strong> The Submodules</a>
                <a href="#sec-6-1" style="text-decoration: none; color: #555; display: block; padding-left: 16px;">6.1 Tedarik&ccedil;i Y&ouml;netimi</a>
                <a href="#sec-6-2" style="text-decoration: none; color: #555; display: block; padding-left: 16px;">6.2 Hammadde Sipari&#351;</a>
                <a href="#sec-6-3" style="text-decoration: none; color: #555; display: block; padding-left: 16px;">6.3 Hammadde Giri&#351;i</a>
                <a href="#sec-6-4" style="text-decoration: none; color: #555; display: block; padding-left: 16px;">6.4 Hammaddeler Listesi</a>
                <a href="#sec-7" style="text-decoration: none; color: var(--fg); display: block;"><strong>7.</strong> Conclusion</a>
            </div>
        </div>

        <!-- ============================================ -->
        <h2 id="sec-1">1. WHAT HAMMADDE DOES</h2>
        <!-- ============================================ -->

        <p>The Hammadde module answers four questions that the factory&rsquo;s supply chain depends on:</p>

        <ol>
            <li><strong>What raw materials do we have in stock?</strong> &mdash; Material Entry registers every incoming shipment. Copper arrives on palettes (multiple per delivery), tin as single weighed ingots, and plastics/catalysts/dyes/antirodent as lot-based entries. Each gets a QR code (A=copper, B=tin, C=plastic, D=catalyst, E=dye, F=antirodent, I=palette, H=reel), delivery and test photos, and a link to its purchase order.</li>
            <li><strong>Where is every gram of material right now?</strong> &mdash; Materials List provides a full inventory view with lazy-loaded photo thumbnails, status tracking (received &rarr; approved &rarr; in_use &rarr; consumed/rejected), remaining weight after production, and real-time WebSocket updates when materials are created, modified, or deleted.</li>
            <li><strong>What have we ordered and when is it arriving?</strong> &mdash; Material Orders tracks every purchase with order group codes (R1, R2, R3...), expected delivery dates, actual delivery dates, date-change history with reasons (supplier/solen/other), delivered quantity tracking, and supplier ratings (0.5&ndash;5 stars) after delivery.</li>
            <li><strong>Who are our suppliers and what do they provide?</strong> &mdash; Supplier Management maintains a one-to-many relationship: one supplier company can provide multiple material types (copper, plastic, dye, etc.), each with material-specific properties like density (g/cm&sup3;), dimensions (boyut), and reel type (yaz&#305;l&#305;/yaz&#305;s&#305;z).</li>
        </ol>

        <div class="finding">
            <p style="margin-bottom: 0;"><strong>Downstream consumer.</strong> Hammadde is the primary consumer of Teknik&rsquo;s Cable Database. When the Sipari&scedil; module calculates material requirements for an order (copper weight, tin coating, plastic volumes, catalyst/dye percentages), it uses the <code>material_calculator</code> service which reads cable specifications from Teknik and produces procurement quantities that Hammadde must fulfill. The Material Entry page also links incoming deliveries directly to Material Orders, closing the loop between &ldquo;what was ordered&rdquo; and &ldquo;what actually arrived.&rdquo;</p>
        </div>

        <!-- ============================================ -->
        <h2 id="sec-2">2. THE DATA FLOW</h2>
        <!-- ============================================ -->

        <p>Data flows through Hammadde in a clear procurement-to-consumption cycle:</p>

        <h3>Procurement Flow</h3>
        <div class="flow">
            <div class="flow-box" style="background: #faf5ff; border-color: #7c3aed;">SUPPLIER<br><span style="font-size:9px;color:#666;">Registered in system</span></div>
            <span class="flow-arrow">&rarr;</span>
            <div class="flow-box" style="background: #eff6ff; border-color: #2563eb;">ORDER<br><span style="font-size:9px;color:#666;">R1, R2... created</span></div>
            <span class="flow-arrow">&rarr;</span>
            <div class="flow-box" style="background: #fffbe6; border-color: #f59e0b;">DELIVERY<br><span style="font-size:9px;color:#666;">Date tracking</span></div>
            <span class="flow-arrow">&rarr;</span>
            <div class="flow-box" style="background: #dcfce7; border-color: #16a34a;">ENTRY<br><span style="font-size:9px;color:#666;">QR + photos</span></div>
        </div>

        <h3>Consumption Flow</h3>
        <div class="flow">
            <div class="flow-box" style="background: #dcfce7; border-color: #16a34a;">MATERIAL<br><span style="font-size:9px;color:#666;">Status: received</span></div>
            <span class="flow-arrow">&rarr;</span>
            <div class="flow-box" style="background: #dbeafe; border-color: #2563eb;">APPROVED<br><span style="font-size:9px;color:#666;">Lab cleared</span></div>
            <span class="flow-arrow">&rarr;</span>
            <div class="flow-box" style="background: #fffbe6; border-color: #f59e0b;">IN USE<br><span style="font-size:9px;color:#666;">On production line</span></div>
            <span class="flow-arrow">&rarr;</span>
            <div class="flow-box" style="background: #f3f4f6; border-color: #666;">CONSUMED<br><span style="font-size:9px;color:#666;">remaining_weight = 0</span></div>
        </div>

        <h3>The Order-to-Entry Link</h3>
        <p>When a material delivery arrives, the Material Entry page can link the incoming material directly to its pending purchase order. This updates the order&rsquo;s <code>delivered_quantity</code>, sets its status to <code>delivered</code>, and records the <code>delivered_date</code>. This tight link means the system always knows: for every kilogram ordered, how much actually arrived and when.</p>

        <div class="insight">
            <p style="margin-bottom: 0;"><strong>Real-time everywhere.</strong> Every material creation, update, and deletion broadcasts a WebSocket event. The Materials List page auto-refreshes without polling. The Supplier Management page does the same. This means multiple users (lab technicians, procurement staff) see changes instantly across all their screens.</p>
        </div>

        <!-- ============================================ -->
        <h2 id="sec-3">3. THE DATABASE LAYER</h2>
        <!-- ============================================ -->

        <p>6 tables serve the Hammadde module. They fall into three groups:</p>

        <h3>Material Tables (2)</h3>

        <h4>raw_materials</h4>
        <p>The central table. Every physical material that enters the factory gets one row here &mdash; regardless of type.</p>
        <table>
            <tr><th>Column</th><th>Type</th><th>Purpose</th></tr>
            <tr><td>id</td><td>INTEGER PK</td><td>Auto-increment primary key</td></tr>
            <tr><td>material_type</td><td>VARCHAR(50)</td><td>raw_copper, raw_tin, raw_plastic, raw_catalyst, raw_dye, raw_antirodent, raw_palette, raw_reel</td></tr>
            <tr><td>material_name</td><td>VARCHAR(200)</td><td>Specific material name from supplier catalog (e.g., HFX500, K388)</td></tr>
            <tr><td>sequence_number</td><td>INTEGER</td><td>Per-type counter &mdash; separate sequence for each material_type</td></tr>
            <tr><td>qr_code</td><td>VARCHAR(50) UNIQUE</td><td>Generated code: prefix + sequence (A1, B7, C23, I145...)</td></tr>
            <tr><td>supplier_id</td><td>FK &rarr; suppliers</td><td>Which supplier provided this material</td></tr>
            <tr><td>material_order_id</td><td>FK &rarr; material_orders</td><td>Links to purchase order (for delivery tracking)</td></tr>
            <tr><td>lot_number</td><td>VARCHAR(100)</td><td>Supplier&rsquo;s lot number (or auto-generated for tin: TIN-N)</td></tr>
            <tr><td>weight</td><td>FLOAT</td><td>Measured weight when received (kg)</td></tr>
            <tr><td>remaining_weight</td><td>FLOAT</td><td>Weight remaining after production consumption (kg)</td></tr>
            <tr><td>form_weight</td><td>FLOAT</td><td>Official form weight (for copper palettes)</td></tr>
            <tr><td>quantity</td><td>INTEGER</td><td>Count for lot-based materials (plastic/catalyst/dye/antirodent)</td></tr>
            <tr><td>status</td><td>VARCHAR(50)</td><td>received &rarr; approved &rarr; in_use &rarr; consumed | rejected</td></tr>
            <tr><td>entered_by</td><td>FK &rarr; users</td><td>Who entered this material into the system</td></tr>
            <tr><td>notes</td><td>TEXT</td><td>Free-form notes</td></tr>
            <tr><td>received_date</td><td>DATETIME</td><td>When the material was physically received</td></tr>
            <tr><td>created_at</td><td>DATETIME</td><td>Record creation timestamp</td></tr>
            <tr><td>updated_at</td><td>DATETIME</td><td>Last update timestamp (auto-set on change)</td></tr>
        </table>

        <h4>material_photos</h4>
        <p>Photos stored separately for <strong>lazy loading performance</strong>. With thousands of materials, loading base64 photo data in every list query would be catastrophic. Instead, the list returns only photo IDs, and the frontend fetches actual photo data on demand.</p>
        <table>
            <tr><th>Column</th><th>Type</th><th>Purpose</th></tr>
            <tr><td>id</td><td>INTEGER PK</td><td>Photo identifier</td></tr>
            <tr><td>material_id</td><td>FK &rarr; raw_materials (CASCADE)</td><td>Which material this photo belongs to</td></tr>
            <tr><td>photo_type</td><td>VARCHAR(20)</td><td>&lsquo;delivery&rsquo; or &lsquo;test&rsquo;</td></tr>
            <tr><td>sequence</td><td>INTEGER</td><td>1, 2, or 3 (up to 3 photos per type)</td></tr>
            <tr><td>photo_data</td><td>TEXT</td><td>Base64 encoded image data</td></tr>
            <tr><td>created_at</td><td>DATETIME</td><td>Upload timestamp</td></tr>
        </table>

        <div class="discovery">
            <p style="margin-bottom: 0;"><strong>Performance pattern:</strong> The old design stored photos directly in the <code>raw_materials</code> table as JSON arrays of base64 strings. This made list queries unbearably slow. The migration to a separate <code>material_photos</code> table with lazy loading via individual photo endpoints (<code>GET /materials/photo/{id}</code>) solved this completely. The old columns (<code>delivery_form_photo</code>, <code>test_report_photo</code>, <code>delivery_form_photos</code>, <code>test_report_photos</code>) are kept for backward compatibility but are no longer used.</p>
        </div>

        <h3>Order Tables (2)</h3>

        <h4>material_orders</h4>
        <p>Tracks purchase orders. Not official ERP purchase orders &mdash; these are internal tracking records for when materials are expected to arrive.</p>
        <table>
            <tr><th>Column</th><th>Type</th><th>Purpose</th></tr>
            <tr><td>id</td><td>INTEGER PK</td><td>Order identifier</td></tr>
            <tr><td>order_group_code</td><td>VARCHAR(20)</td><td>Grouping code (R1, R2...) &mdash; orders from same shipment share this</td></tr>
            <tr><td>material_type</td><td>VARCHAR(50)</td><td>What is being ordered (copper, plastic, etc.)</td></tr>
            <tr><td>supplier_id</td><td>FK &rarr; suppliers</td><td>Which supplier is fulfilling this order</td></tr>
            <tr><td>supplier_material_id</td><td>FK &rarr; supplier_materials</td><td>Specific material being ordered</td></tr>
            <tr><td>quantity</td><td>FLOAT</td><td>Ordered quantity</td></tr>
            <tr><td>delivered_quantity</td><td>FLOAT</td><td>Actually delivered quantity (updated when material entry is linked)</td></tr>
            <tr><td>unit</td><td>VARCHAR(20)</td><td>&lsquo;kg&rsquo; for materials, &lsquo;adet&rsquo; for palettes/reels</td></tr>
            <tr><td>order_date</td><td>DATE</td><td>When the order was placed</td></tr>
            <tr><td>expected_date</td><td>DATE</td><td>When delivery is expected (can change &mdash; tracked)</td></tr>
            <tr><td>delivered_date</td><td>DATE</td><td>Actual delivery date</td></tr>
            <tr><td>status</td><td>VARCHAR(20)</td><td>pending &rarr; shipped &rarr; delivered | cancelled</td></tr>
            <tr><td>rating</td><td>FLOAT</td><td>Post-delivery rating (0.5&ndash;5 stars, half increments)</td></tr>
            <tr><td>rating_note</td><td>TEXT</td><td>Rating comment</td></tr>
            <tr><td>notes</td><td>TEXT</td><td>Order notes</td></tr>
            <tr><td>created_by</td><td>FK &rarr; users</td><td>Who created this order</td></tr>
        </table>

        <h4>material_order_date_changes</h4>
        <p>An audit trail for expected delivery date changes. Every time someone changes the expected date, the system records why.</p>
        <table>
            <tr><th>Column</th><th>Type</th><th>Purpose</th></tr>
            <tr><td>id</td><td>INTEGER PK</td><td>Change record identifier</td></tr>
            <tr><td>order_id</td><td>FK &rarr; material_orders (CASCADE)</td><td>Which order was changed</td></tr>
            <tr><td>old_date</td><td>DATE</td><td>Previous expected date</td></tr>
            <tr><td>new_date</td><td>DATE</td><td>New expected date</td></tr>
            <tr><td>reason_type</td><td>VARCHAR(20)</td><td>&lsquo;supplier&rsquo; | &lsquo;solen&rsquo; | &lsquo;other&rsquo;</td></tr>
            <tr><td>reason_detail</td><td>TEXT</td><td>Manual explanation (required for &lsquo;other&rsquo;)</td></tr>
            <tr><td>changed_by</td><td>FK &rarr; users</td><td>Who changed the date</td></tr>
            <tr><td>created_at</td><td>DATETIME</td><td>When the change was recorded</td></tr>
        </table>

        <h3>Supplier Tables (2)</h3>

        <h4>suppliers</h4>
        <p>Company-level supplier records. Each supplier is a single company with contact details.</p>
        <table>
            <tr><th>Column</th><th>Type</th><th>Purpose</th></tr>
            <tr><td>id</td><td>INTEGER PK</td><td>Supplier identifier</td></tr>
            <tr><td>name</td><td>VARCHAR(200) UNIQUE</td><td>Company name (stored UPPERCASE)</td></tr>
            <tr><td>contact_person</td><td>VARCHAR(100)</td><td>Primary contact name</td></tr>
            <tr><td>phone</td><td>VARCHAR(50)</td><td>Auto-formatted Turkish phone number</td></tr>
            <tr><td>email</td><td>VARCHAR(100)</td><td>Email (validated regex)</td></tr>
            <tr><td>address</td><td>TEXT</td><td>Physical address</td></tr>
            <tr><td>tax_number</td><td>VARCHAR(50)</td><td>Tax registration number</td></tr>
            <tr><td>is_active</td><td>BOOLEAN</td><td>Soft delete flag (toggle active/inactive)</td></tr>
            <tr><td>notes</td><td>TEXT</td><td>Free-form notes</td></tr>
        </table>

        <h4>supplier_materials</h4>
        <p>The one-to-many relationship. One supplier can provide multiple material types, each with type-specific properties.</p>
        <table>
            <tr><th>Column</th><th>Type</th><th>Purpose</th></tr>
            <tr><td>id</td><td>INTEGER PK</td><td>Supplier-material link identifier</td></tr>
            <tr><td>supplier_id</td><td>FK &rarr; suppliers</td><td>Which supplier</td></tr>
            <tr><td>material_type</td><td>VARCHAR(50)</td><td>copper, tin, plastic, catalyst, dye, antirodent, palette, reel</td></tr>
            <tr><td>material_name</td><td>VARCHAR(100)</td><td>Specific product name (HF-500, CAT-203, etc.)</td></tr>
            <tr><td>density</td><td>FLOAT</td><td>For plastic/catalyst/dye/antirodent (g/cm&sup3;)</td></tr>
            <tr><td>boyut</td><td>VARCHAR(100)</td><td>Dimensions for palette/reel</td></tr>
            <tr><td>reel_type</td><td>VARCHAR(20)</td><td>For reels: Yaz&#305;l&#305;/Yaz&#305;s&#305;z (labeled/unlabeled)</td></tr>
            <tr><td>is_active</td><td>BOOLEAN</td><td>Whether this material is still offered</td></tr>
        </table>

        <div class="finding">
            <p style="margin-bottom: 0;"><strong>Entity relationship summary:</strong> <code>suppliers</code> 1&mdash;N <code>supplier_materials</code> (what they sell), <code>suppliers</code> 1&mdash;N <code>raw_materials</code> (what they delivered), <code>material_orders</code> N&mdash;1 <code>suppliers</code> (who we ordered from), <code>material_orders</code> N&mdash;1 <code>supplier_materials</code> (what exactly), <code>raw_materials</code> N&mdash;1 <code>material_orders</code> (linked delivery), <code>raw_materials</code> 1&mdash;N <code>material_photos</code> (lazy-loaded), <code>material_orders</code> 1&mdash;N <code>material_order_date_changes</code> (audit trail).</p>
        </div>

        <!-- ============================================ -->
        <h2 id="sec-4">4. THE BACKEND ARCHITECTURE</h2>
        <!-- ============================================ -->

        <p>The backend is built with FastAPI and organized into 4 route files, 4 models, 2 schema files, and 1 service. Total backend code: ~3,200 lines.</p>

        <h3>4.1 Route Organization</h3>

        <div class="arch-grid">
            <div class="arch-box">
                <h4>material_routes.py (986 lines)</h4>
                <p>Router prefix: <code>/api/materials</code><br>
                The main material CRUD. Handles copper entry (multi-palette), tin entry (single), lot-based entry (plastic/catalyst/dye/antirodent), photo retrieval, list, update, print preview, printer management, QR printing, status toggle, and hard delete. Includes the palette_routes sub-router.</p>
            </div>
            <div class="arch-box">
                <h4>material_order_routes.py (478 lines)</h4>
                <p>Router prefix: <code>/api/material-orders</code><br>
                Order lifecycle management. List with filters, pending orders grouped by supplier/date (for Material Entry linking), create (single or batch with auto-generated R-codes), update with date-change tracking, date-change history retrieval, delivery rating, and deletion.</p>
            </div>
            <div class="arch-box">
                <h4>palette_routes.py (316 lines)</h4>
                <p>Included in material_routes (no separate prefix).<br>
                Palette and reel entry endpoints. Similar to lot-entry but specialized for inventory items: palettes get QR prefix I, reels get H. Both support order linking and photo uploads.</p>
            </div>
            <div class="arch-box">
                <h4>supplier_routes.py (435 lines)</h4>
                <p>Router prefix: <code>/api/suppliers</code><br>
                Full supplier lifecycle: create with nested materials, list with eager-loaded materials, filter by material type, get unique materials list (deduplicated specs), get single supplier, update with material replacement, hard delete with dependency check, and status toggle.</p>
            </div>
        </div>

        <h3>4.2 The QR Code System</h3>
        <p>Every material gets a deterministic QR code based on type prefix and sequence number:</p>

        <pre><span class="keyword">def</span> generate_qr_code(material_type: str, sequence_number: int) -&gt; str:
    prefix_map = {
        <span class="string">"raw_copper"</span>:     <span class="string">"A"</span>,   <span class="comment"># A1, A2, A3...</span>
        <span class="string">"raw_tin"</span>:        <span class="string">"B"</span>,   <span class="comment"># B1, B2, B3...</span>
        <span class="string">"raw_plastic"</span>:    <span class="string">"C"</span>,   <span class="comment"># C1, C2, C3...</span>
        <span class="string">"raw_catalyst"</span>:   <span class="string">"D"</span>,   <span class="comment"># D1, D2, D3...</span>
        <span class="string">"raw_dye"</span>:        <span class="string">"E"</span>,   <span class="comment"># E1, E2, E3...</span>
        <span class="string">"raw_antirodent"</span>: <span class="string">"F"</span>,   <span class="comment"># F1, F2, F3...</span>
        <span class="string">"raw_palette"</span>:    <span class="string">"I"</span>,   <span class="comment"># I1, I2, I3...</span>
        <span class="string">"raw_reel"</span>:       <span class="string">"H"</span>,   <span class="comment"># H1, H2, H3...</span>
    }
    prefix = prefix_map.get(material_type, <span class="string">"X"</span>)
    <span class="keyword">return</span> f<span class="string">"{prefix}{sequence_number}"</span></pre>

        <p>The sequence number is per-type: the system queries the maximum <code>sequence_number</code> for that <code>material_type</code> and increments. This means A1 and B1 can coexist &mdash; each type has its own independent counter.</p>

        <h3>4.3 Material Entry Logic</h3>
        <p>The entry endpoint handles three fundamentally different flows based on material type:</p>

        <table>
            <tr><th>Material Type</th><th>Entry Method</th><th>Key Behavior</th></tr>
            <tr><td>Copper (raw_copper)</td><td>POST /materials/entry</td><td>Creates <strong>one row per palette</strong>. A single delivery with 5 palettes creates 5 <code>raw_materials</code> rows, each with its own QR code (A1, A2...), lot number, and measured weight.</td></tr>
            <tr><td>Tin (raw_tin)</td><td>POST /materials/entry</td><td>Creates <strong>one row</strong>. Single weight entry. Lot number auto-generated as TIN-{sequence}.</td></tr>
            <tr><td>Plastic, Catalyst, Dye, Antirodent</td><td>POST /materials/lot-entry</td><td>Creates <strong>one row per lot</strong>. Each lot has its own test photos, weight, and quantity. Material name resolved from <code>supplier_materials</code> table.</td></tr>
            <tr><td>Palette</td><td>POST /materials/palette-entry</td><td>Creates <strong>one row per palette type</strong>. QR prefix I. Lot auto-generated as PALET-{sequence}.</td></tr>
            <tr><td>Reel</td><td>POST /materials/reel-entry</td><td>Creates <strong>one row per reel type</strong>. QR prefix H. Lot auto-generated as REEL-{sequence}.</td></tr>
        </table>

        <h3>4.4 Order Group Codes</h3>
        <p>When creating material orders, the system generates a group code (R1, R2, R3...) by finding the highest existing R-number and incrementing:</p>

        <pre><span class="keyword">def</span> generate_order_group_code(db: Session) -&gt; str:
    <span class="comment"># Get highest R number from existing codes</span>
    result = db.query(func.max(MaterialOrder.order_group_code)).filter(
        MaterialOrder.order_group_code.isnot(None),
        MaterialOrder.order_group_code.like(<span class="string">'R%'</span>)
    ).scalar()

    <span class="keyword">if</span> result:
        match = re.search(r<span class="string">'R(\d+)'</span>, result)
        <span class="keyword">if</span> match:
            <span class="keyword">return</span> f<span class="string">"R{int(match.group(1)) + 1}"</span>
    <span class="keyword">return</span> <span class="string">"R1"</span></pre>

        <p>Orders from the same shipment share a group code. This allows the system to display grouped orders in the UI and link multiple material entries to the same delivery event.</p>

        <h3>4.5 Date Change Tracking</h3>
        <p>When an order&rsquo;s expected date is modified, the update endpoint automatically records the change:</p>

        <pre><span class="comment"># If date actually changed and reason is provided, record it</span>
<span class="keyword">if</span> old_expected_date != new_expected_date:
    <span class="keyword">if</span> <span class="string">'date_change_reason'</span> <span class="keyword">in</span> data:
        date_change = MaterialOrderDateChange(
            order_id=order.id,
            old_date=old_expected_date,
            new_date=new_expected_date,
            reason_type=data[<span class="string">'date_change_reason'</span>],         <span class="comment"># supplier | solen | other</span>
            reason_detail=data.get(<span class="string">'date_change_detail'</span>),  <span class="comment"># free text</span>
            changed_by=current_user.id
        )
        db.add(date_change)</pre>

        <p>Three reason categories: <code>supplier</code> (delay caused by supplier), <code>solen</code> (delay caused by Solen internal), <code>other</code> (requires manual explanation). This creates an accountability trail for procurement performance analysis.</p>

        <h3>4.6 The Material Calculator Service</h3>
        <p>The <code>material_calculator.py</code> (478 lines) is a pure calculation service with no database dependencies. It provides:</p>

        <div class="arch-grid">
            <div class="arch-box">
                <h4>Copper Calculation</h4>
                <p><code>calculate_copper(wire_groups, length_meters, bunching_stages)</code><br>
                Takes wire diameter&rarr;count map (e.g., {0.30: 73} for 6mm&sup2;), applies per-wire weight from constants, multiplies by length, and applies compound twist factor for multi-stage bunching. Returns total kg.</p>
            </div>
            <div class="arch-box">
                <h4>Tin Calculation</h4>
                <p><code>calculate_tin(copper_kg)</code><br>
                Simple percentage: copper_kg &times; TIN_COATING_FACTOR (~0.7%). Tin coating is ~4&mu;m thick on 1.8mm wire.</p>
            </div>
            <div class="arch-box">
                <h4>Plastic Calculation</h4>
                <p><code>calculate_plastic_weight(inner_dia, thickness, density, length, is_first_layer, num_cables)</code><br>
                Cylindrical volume: &pi; &times; (R&sup2; &minus; r&sup2;) &times; length. First layer on copper gets 14% overfill for bumpy surface. Twin cables multiply by num_cables. Volume &times; density = weight.</p>
            </div>
            <div class="arch-box">
                <h4>Layer Calculation</h4>
                <p><code>calculate_layer(...)</code><br>
                Complete layer with all material alternatives. Calculates plastic + catalyst + dye for each alternative selection. Returns max values across all options for worst-case procurement planning.</p>
            </div>
        </div>

        <h3>4.7 Permission System</h3>
        <p>The module uses a hybrid permission approach:</p>
        <ul>
            <li><strong>Role-based:</strong> Material entry requires <code>lab_user</code> or <code>super_admin</code>. Material updates require <code>super_admin</code>. Hard deletes require <code>super_admin</code>.</li>
            <li><strong>Smart permission check:</strong> Supplier routes use <code>check_permission_smart()</code> which works with both the old role-based system and the new ultra-granular page-button permission system simultaneously.</li>
            <li><strong>Frontend registration:</strong> Each page registers its buttons with the permission system via <code>registerPageButtons()</code>, declaring exactly which actions exist (e.g., <code>add_copper</code>, <code>add_tin</code>, <code>upload_delivery_photo</code>, <code>print_qr_modal</code>).</li>
        </ul>

        <h3>4.8 WebSocket Integration</h3>
        <p>Three entity types broadcast real-time updates:</p>
        <pre><span class="comment"># After material creation</span>
<span class="keyword">await</span> broadcast_update(<span class="string">"materials"</span>, <span class="string">"create"</span>, {<span class="string">"id"</span>: material.id, <span class="string">"qr_code"</span>: material.qr_code})

<span class="comment"># After material update</span>
<span class="keyword">await</span> broadcast_update(<span class="string">"materials"</span>, <span class="string">"update"</span>, {<span class="string">"id"</span>: material.id, <span class="string">"qr_code"</span>: material.qr_code})

<span class="comment"># After material deletion</span>
<span class="keyword">await</span> broadcast_update(<span class="string">"materials"</span>, <span class="string">"delete"</span>, {<span class="string">"id"</span>: material_id, <span class="string">"qr_code"</span>: qr_code})

<span class="comment"># Suppliers also broadcast</span>
<span class="keyword">await</span> broadcast_update(<span class="string">"suppliers"</span>, <span class="string">"create"</span>, {<span class="string">"id"</span>: new_supplier.id, <span class="string">"name"</span>: new_supplier.name})</pre>

        <h3>4.9 Print Queue Integration</h3>
        <p>Material QR code printing is <strong>non-blocking</strong>. The <code>POST /materials/print/{material_id}</code> endpoint forwards to the print queue system rather than blocking the HTTP request while waiting for the printer. The system generates a preview image (base64) via <code>GET /materials/print/preview/{material_id}</code> and allows printer IP configuration via <code>POST /materials/print/update-printer-ip</code>.</p>

        <!-- ============================================ -->
        <h2 id="sec-5">5. THE FRONTEND</h2>
        <!-- ============================================ -->

        <p>4 React pages built with Ant Design Pro, totaling ~5,100 lines of TypeScript. All pages are dark-mode aware with conditional styling.</p>

        <h3>5.1 Page Map</h3>

        <table>
            <tr><th>Route</th><th>Component</th><th>Lines</th><th>Purpose</th></tr>
            <tr><td>/hammadde/hammadde-girisi</td><td>Lab/MaterialEntry</td><td>1,930</td><td>Material entry with 8 material type cards, photo uploads, order linking</td></tr>
            <tr><td>/hammadde/hammaddeler-listesi</td><td>Hammadde/HammaddelerListesi</td><td>1,153</td><td>ProTable with lazy photo thumbnails, CRUD, print, status management</td></tr>
            <tr><td>/hammadde/hammadde-siparis</td><td>Hammadde/HammaddeSiparis</td><td>1,237</td><td>Order tracking with date-change history, grouping, ratings</td></tr>
            <tr><td>/hammadde/tedarikci-yonetimi</td><td>Lab/SupplierManagement</td><td>761</td><td>Supplier CRUD with nested material types, search, real-time updates</td></tr>
        </table>

        <h3>5.2 Key Frontend Patterns</h3>

        <div class="arch-grid">
            <div class="arch-box">
                <h4>Card-Based Material Selection</h4>
                <p>Material Entry uses 8 colored cards (copper=orange, tin=cyan, plastic=purple, etc.) as the primary navigation. Each card type opens a different modal form with type-specific fields. Colors are theme-aware &mdash; muted in dark mode using rgba with 0.12 opacity.</p>
            </div>
            <div class="arch-box">
                <h4>Lazy Photo Loading</h4>
                <p>The <code>LazyPhotoThumbnail</code> component loads photos one at a time via <code>GET /materials/photo/{id}</code>. On click, it loads ALL photos for that material and opens a gallery viewer with navigation. This pattern keeps the list page fast even with thousands of materials.</p>
            </div>
            <div class="arch-box">
                <h4>Order Linking UX</h4>
                <p>When entering materials, the user can optionally select a pending purchase order to link to. The system fetches pending orders grouped by supplier and expected date via <code>GET /material-orders/pending-by-type/{type}</code>, and auto-fills supplier info from the selected order.</p>
            </div>
            <div class="arch-box">
                <h4>Real-Time WebSocket Updates</h4>
                <p>Both Materials List and Supplier Management use the <code>useWebSocket</code> hook subscribing to <code>materials</code> and <code>suppliers</code> rooms respectively. On any create/update/delete event, the ProTable auto-reloads via <code>actionRef.current?.reload()</code>.</p>
            </div>
        </div>

        <h3>5.3 Material Types and Colors</h3>
        <table>
            <tr><th>Type</th><th>QR Prefix</th><th>Color</th><th>Entry Method</th></tr>
            <tr><td>Copper (Bak&#305;r)</td><td>A</td><td style="background:#fff7e6;">Orange</td><td>Multi-palette with form + measured weights</td></tr>
            <tr><td>Tin (Kalay)</td><td>B</td><td style="background:#e6fffb;">Cyan</td><td>Single weight entry</td></tr>
            <tr><td>Plastic (Plastik)</td><td>C</td><td style="background:#f9f0ff;">Purple</td><td>Lot-based with per-lot test photos</td></tr>
            <tr><td>Catalyst (Kataliz&ouml;r)</td><td>D</td><td style="background:#f6ffed;">Green</td><td>Lot-based with per-lot test photos</td></tr>
            <tr><td>Dye (Boya)</td><td>E</td><td style="background:#fff0f6;">Pink</td><td>Lot-based with per-lot test photos</td></tr>
            <tr><td>Antirodent</td><td>F</td><td style="background:#e6fffb;">Teal</td><td>Lot-based with per-lot test photos</td></tr>
            <tr><td>Palette (Palet)</td><td>I</td><td style="background:#fcffe6;">Lime</td><td>Quantity per palette type</td></tr>
            <tr><td>Reel (Makara)</td><td>H</td><td style="background:#fffbe6;">Gold</td><td>Quantity per reel type</td></tr>
        </table>

        <!-- ============================================ -->
        <h2 id="sec-6">6. THE SUBMODULES</h2>
        <!-- ============================================ -->

        <p>The Hammadde module consists of 4 submodules, each handling a different aspect of raw material management. The following sections will dive deep into each one.</p>

        <div class="submod-card">
            <div class="submod-num">6.1</div>
            <div class="submod-body">
                <h4>Tedarik&ccedil;i Y&ouml;netimi (Supplier Management)</h4>
                <p>Supplier company management with one-to-many material relationships. Create suppliers with nested material lists, each material type carrying its own properties (density, dimensions, reel type). Smart permission checking, real-time WebSocket updates, hard delete with FK dependency protection. The starting point &mdash; nothing can be ordered or entered without a registered supplier.</p>
                <div class="submod-tags">
                    <span class="submod-tag">761 LINES</span>
                    <span class="submod-tag">1:N MATERIALS</span>
                    <span class="submod-tag">SMART PERMISSIONS</span>
                    <span class="submod-tag">REAL-TIME</span>
                    <span class="submod-tag">FK PROTECTION</span>
                </div>
            </div>
        </div>

        <div class="submod-card">
            <div class="submod-num">6.2</div>
            <div class="submod-body">
                <h4>Hammadde Sipari&#351; (Material Orders)</h4>
                <p>Purchase order tracking with order group codes (R1, R2...), date change history with categorized reasons (supplier/solen/other), delivery quantity tracking, supplier rating after delivery (0.5&ndash;5 stars with half increments), and status lifecycle management.</p>
                <div class="submod-tags">
                    <span class="submod-tag">1,237 LINES</span>
                    <span class="submod-tag">ORDER GROUPS</span>
                    <span class="submod-tag">DATE TRACKING</span>
                    <span class="submod-tag">SUPPLIER RATING</span>
                    <span class="submod-tag">7 ENDPOINTS</span>
                </div>
            </div>
        </div>

        <div class="submod-card">
            <div class="submod-num">6.3</div>
            <div class="submod-body">
                <h4>Hammadde Giri&#351;i (Material Entry)</h4>
                <p>The 1,930-line entry page. 8 material type cards, multi-palette copper entry, lot-based chemical entry, photo uploads (delivery form + test reports, up to 3 each), QR code generation and printing, order linking for delivery tracking. The largest and most complex page in the module.</p>
                <div class="submod-tags">
                    <span class="submod-tag">1,930 LINES</span>
                    <span class="submod-tag">14 ENDPOINTS</span>
                    <span class="submod-tag">8 MATERIAL TYPES</span>
                    <span class="submod-tag">QR CODES</span>
                    <span class="submod-tag">PHOTO UPLOAD</span>
                </div>
            </div>
        </div>

        <div class="submod-card">
            <div class="submod-num">6.4</div>
            <div class="submod-body">
                <h4>Hammaddeler Listesi (Materials List)</h4>
                <p>Full inventory view with ProTable. Lazy-loaded photo thumbnails, material status management (received/approved/in_use/consumed/rejected), edit with QR code modification, hard delete with dependency checks, remaining weight tracking, and QR code print queue integration.</p>
                <div class="submod-tags">
                    <span class="submod-tag">1,153 LINES</span>
                    <span class="submod-tag">PROTABLE</span>
                    <span class="submod-tag">LAZY PHOTOS</span>
                    <span class="submod-tag">REAL-TIME</span>
                    <span class="submod-tag">PRINT QUEUE</span>
                </div>
            </div>
        </div>

        <!-- ============================================ -->
        <h2 id="sec-6-1">6.1 TEDARİKÇİ YÖNETİMİ (SUPPLIER MANAGEMENT)</h2>
        <!-- ============================================ -->

        <p>The starting point of the entire Hammadde module. Before any material can be ordered or entered into the system, a supplier must exist. This page manages supplier companies and the specific materials each one provides.</p>

        <h3>6.1.1 What It Does</h3>
        <p>Tedarik&ccedil;i Y&ouml;netimi manages a <strong>one-to-many relationship</strong>: one supplier company can provide multiple material types. A single supplier like &ldquo;ORMETSAN&rdquo; might provide both copper wire rod and tin ingots, while &ldquo;BETEK&rdquo; might provide 3 different plastic compounds, 2 catalysts, and a dye &mdash; all registered as separate material entries under the same company.</p>

        <p>The page provides:</p>
        <ul>
            <li>ProTable with client-side search across all fields (including Turkish material type names)</li>
            <li>Create/Edit modal with dynamic conditional fields based on material type</li>
            <li>Material type grouping in the table with count badges and detail tooltips</li>
            <li>Soft delete (active/inactive toggle) and hard delete with FK dependency protection</li>
            <li>Real-time WebSocket updates across all connected clients</li>
        </ul>

        <h3>6.1.2 API Contract</h3>

        <table>
            <tr><th>Method</th><th>Path</th><th>Function</th><th>Permission</th></tr>
            <tr><td>POST</td><td>/api/suppliers/create</td><td>create_supplier</td><td>Smart: lab_user OR hammadde.tedarikci-yonetimi.create_supplier</td></tr>
            <tr><td>GET</td><td>/api/suppliers/list</td><td>get_suppliers</td><td>Any authenticated user</td></tr>
            <tr><td>GET</td><td>/api/suppliers/by-material/{type}</td><td>get_suppliers_by_material</td><td>Any authenticated user</td></tr>
            <tr><td>GET</td><td>/api/suppliers/materials-list</td><td>get_supplier_materials_list</td><td>Any authenticated user</td></tr>
            <tr><td>GET</td><td>/api/suppliers/{id}</td><td>get_supplier</td><td>Any authenticated user</td></tr>
            <tr><td>PUT</td><td>/api/suppliers/{id}</td><td>update_supplier</td><td>Any authenticated user</td></tr>
            <tr><td>PUT</td><td>/api/suppliers/{id}/toggle-status</td><td>toggle_supplier_status</td><td>Smart: super_admin OR deactivate_supplier</td></tr>
            <tr><td>DELETE</td><td>/api/suppliers/{id}/hard-delete</td><td>hard_delete_supplier</td><td>Smart: super_admin OR hard_delete_supplier</td></tr>
        </table>

        <h3>6.1.3 The Conditional Form Logic</h3>
        <p>The create/edit modal contains a dynamic materials section. Each material card shows <strong>different fields based on the selected material type</strong>:</p>

        <table>
            <tr><th>Material Type</th><th>Fields Shown</th><th>Example</th></tr>
            <tr><td>Copper, Tin</td><td><em>No extra fields</em> &mdash; &ldquo;Bu malzeme i&ccedil;in ek bilgi gerekmez&rdquo;</td><td>&mdash;</td></tr>
            <tr><td>Plastic, Catalyst, Dye, Antirodent</td><td>material_name + density (g/cm&sup3;)</td><td>HF-500, 1.42 g/cm&sup3;</td></tr>
            <tr><td>Palette</td><td>material_name + boyut (dimensions)</td><td>Euro Palet, 120x80x15 cm</td></tr>
            <tr><td>Reel</td><td>material_name + boyut + reel_type</td><td>300mm Makara, 300x150 mm, Yaz&#305;l&#305;</td></tr>
        </table>

        <p>When the material type dropdown changes, all conditional fields are <strong>cleared</strong>:</p>

        <pre><span class="keyword">const</span> updateMaterial = (index: number, field: keyof MaterialItem, value: any) =&gt; {
    <span class="keyword">const</span> newMaterials = [...materials];
    newMaterials[index] = { ...newMaterials[index], [field]: value };

    <span class="comment">// Clear conditional fields when type changes</span>
    <span class="keyword">if</span> (field === <span class="string">'material_type'</span>) {
        newMaterials[index].material_name = <span class="keyword">undefined</span>;
        newMaterials[index].density = <span class="keyword">undefined</span>;
        newMaterials[index].boyut = <span class="keyword">undefined</span>;
        newMaterials[index].reel_type = <span class="keyword">undefined</span>;
    }

    setMaterials(newMaterials);
};</pre>

        <p>Users can add unlimited materials (via &ldquo;Malzeme Ekle&rdquo; dashed button) and remove any except the last one (minimum 1 material required). New materials default to <code>copper</code> for the first, <code>plastic</code> for subsequent additions.</p>

        <h3>6.1.4 Backend Validation Chain</h3>
        <p>Three Pydantic validators fire before data reaches the database:</p>

        <h4>Name Validator</h4>
        <pre><span class="decorator">@validator</span>(<span class="string">'name'</span>)
<span class="keyword">def</span> validate_name(cls, v):
    <span class="keyword">if</span> <span class="keyword">not</span> v <span class="keyword">or</span> <span class="keyword">not</span> v.strip():
        <span class="keyword">raise</span> ValueError(<span class="string">'Tedarik&ccedil;i ad&#305; bo&scedil; olamaz'</span>)
    <span class="keyword">if</span> any(char <span class="keyword">in</span> v <span class="keyword">for</span> char <span class="keyword">in</span> [<span class="string">'@'</span>, <span class="string">'#'</span>, <span class="string">'$'</span>, <span class="string">'%'</span>, <span class="string">'^'</span>, <span class="string">'&amp;'</span>, <span class="string">'*'</span>]):
        <span class="keyword">raise</span> ValueError(<span class="string">'Tedarik&ccedil;i ad&#305; &ouml;zel karakterler i&ccedil;eremez'</span>)
    <span class="keyword">return</span> v.strip().upper()  <span class="comment"># Always stored UPPERCASE</span></pre>

        <h4>Phone Validator</h4>
        <pre><span class="decorator">@validator</span>(<span class="string">'phone'</span>)
<span class="keyword">def</span> validate_phone(cls, v):
    <span class="comment"># Strip ALL non-digits: spaces, dashes, parens, plus sign, dots</span>
    clean = v.replace(<span class="string">' '</span>,<span class="string">''</span>).replace(<span class="string">'-'</span>,<span class="string">''</span>).replace(<span class="string">'('</span>,<span class="string">''</span>).replace(<span class="string">')'</span>,<span class="string">''</span>).replace(<span class="string">'+'</span>,<span class="string">''</span>).replace(<span class="string">'.'</span>,<span class="string">''</span>)

    <span class="comment"># Remove +90 country code → 0xxx</span>
    <span class="keyword">if</span> clean.startswith(<span class="string">'90'</span>) <span class="keyword">and</span> len(clean) &gt; 10:
        clean = <span class="string">'0'</span> + clean[2:]    <span class="comment"># +90 212 → 0212</span>

    <span class="comment"># Auto-format: "0212 555 1234"</span>
    <span class="keyword">if</span> len(clean) == 10:
        <span class="keyword">return</span> f<span class="string">"{clean[:4]} {clean[4:7]} {clean[7:]}"</span>
    <span class="keyword">elif</span> len(clean) == 11:       <span class="comment"># Mobile: 05xx xxx xxxx</span>
        <span class="keyword">return</span> f<span class="string">"{clean[:4]} {clean[4:7]} {clean[7:]}"</span></pre>

        <h4>Email Validator</h4>
        <p>Standard regex check: <code>^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$</code></p>

        <div class="finding">
            <p style="margin-bottom: 0;"><strong>Duplicate protection:</strong> Before creating, the backend checks <code>Supplier.name == supplier_data.name.upper()</code>. Since names are always stored uppercase, &ldquo;ormetsan&rdquo;, &ldquo;ORMETSAN&rdquo;, and &ldquo;Ormetsan&rdquo; are all treated as the same supplier. Returns 400: &ldquo;Bu tedarik&ccedil;i zaten kay&#305;tl&#305;&rdquo;.</p>
        </div>

        <h3>6.1.5 The Update Strategy: Delete-and-Recreate</h3>
        <p>When updating a supplier&rsquo;s materials, the backend does <strong>not</strong> patch individual records. Instead, it deletes ALL existing <code>supplier_materials</code> rows and creates fresh ones:</p>

        <pre><span class="comment"># Update materials if provided</span>
<span class="keyword">if</span> supplier_data.materials <span class="keyword">is not</span> None:
    <span class="comment"># Delete ALL old materials</span>
    db.query(SupplierMaterial).filter(
        SupplierMaterial.supplier_id == supplier_id
    ).delete()

    <span class="comment"># Create new materials from scratch</span>
    <span class="keyword">for</span> material_data <span class="keyword">in</span> supplier_data.materials:
        supplier_material = SupplierMaterial(
            supplier_id=supplier.id,
            material_type=material_data.material_type.value,
            material_name=material_data.material_name,
            density=material_data.density,
            boyut=material_data.boyut,
            reel_type=material_data.reel_type,
            is_active=True
        )
        db.add(supplier_material)</pre>

        <div class="warning">
            <p style="margin-bottom: 0;"><strong>Why delete-and-recreate?</strong> This simplifies the logic enormously. The alternative &mdash; diffing existing records, updating changed ones, deleting removed ones, inserting new ones &mdash; would require tracking material IDs on the frontend and handling complex merge logic. Since supplier_materials has no inbound foreign keys from other tables (material_orders links to supplier_material_id, but orders reference a specific material entry), this approach is safe and deterministic.</p>
        </div>

        <h3>6.1.6 Hard Delete with FK Protection</h3>
        <p>Before permanently deleting a supplier, the backend checks for dependent raw materials:</p>

        <pre><span class="comment"># Check if supplier has raw materials (would block due to FK)</span>
has_materials = db.query(RawMaterial).filter(
    RawMaterial.supplier_id == supplier_id
).count()

<span class="keyword">if</span> has_materials &gt; 0:
    <span class="keyword">raise</span> HTTPException(
        status_code=400,
        detail=f<span class="string">"Bu tedarik&ccedil;iye ait {has_materials} hammadde kayd&#305; var. &Ouml;nce hammaddeleri silin."</span>
    )</pre>

        <p>If the check passes, deletion order is: <code>supplier_materials</code> first (cascade), then the <code>supplier</code> itself. A WebSocket broadcast follows immediately.</p>

        <h3>6.1.7 Client-Side Search with Turkish Mappings</h3>
        <p>The search bar filters across <strong>all fields</strong> including nested materials, with Turkish translations:</p>

        <pre><span class="keyword">const</span> materialTurkish: Record&lt;string, string&gt; = {
    copper: <span class="string">'bak&#305;r'</span>,    tin: <span class="string">'kalay'</span>,
    plastic: <span class="string">'plastik'</span>,  catalyst: <span class="string">'kataliz&ouml;r'</span>,
    dye: <span class="string">'boya'</span>,        antirodent: <span class="string">'antirodent'</span>,
    palette: <span class="string">'palet'</span>,    reel: <span class="string">'makara'</span>,
};

<span class="comment">// Search checks: name, contact_person, phone, email,</span>
<span class="comment">// tax_number, address, status (aktif/pasif), id,</span>
<span class="comment">// material_type (EN + TR), material_name</span></pre>

        <p>Typing &ldquo;bak&#305;r&rdquo; finds all suppliers providing copper. Typing &ldquo;HF-500&rdquo; finds the supplier who provides that specific plastic. Typing &ldquo;pasif&rdquo; shows only deactivated suppliers.</p>

        <h3>6.1.8 Materials Column: Grouping and Tooltips</h3>
        <p>The table&rsquo;s &ldquo;Malzemeler&rdquo; column groups materials by type and shows counts:</p>
        <ul>
            <li>If a supplier provides 1 plastic &rarr; shows <code>Plastik</code> tag</li>
            <li>If a supplier provides 3 plastics &rarr; shows <code>Plastik (3)</code> tag</li>
            <li>Hovering any tag shows a tooltip with all material details: name, density, dimensions</li>
            <li>Each material type gets a consistent color: copper=orange, tin=blue, plastic=purple, catalyst=green, dye=magenta, antirodent=cyan, palette=lime, reel=gold</li>
        </ul>

        <h3>6.1.9 The Unique Specs Endpoint</h3>
        <p>The <code>GET /suppliers/materials-list</code> endpoint serves a special purpose: it returns <strong>deduplicated material specifications</strong> across all suppliers. If 3 different suppliers all provide &ldquo;HF-500&rdquo; plastic at 1.42 g/cm&sup3;, the endpoint returns it once. Deduplication key: <code>material_name|boyut|reel_type</code>. This is used by other pages (Material Entry, Material Orders) to show dropdown options without duplicates.</p>

        <h3>6.1.10 Permission Architecture</h3>
        <p>The page uses a hybrid permission model with 8 registered buttons:</p>

        <pre><span class="comment">// Frontend registers ALL available actions</span>
registerPageButtons({
    pageId: <span class="string">'hammadde.tedarikci-yonetimi'</span>,
    buttons: [
        { id: <span class="string">'access_page'</span>,          label: <span class="string">'Sayfaya Eri&scedil;im'</span> },
        { id: <span class="string">'view_table'</span>,           label: <span class="string">'Tablo G&ouml;r&uuml;nt&uuml;le'</span> },
        { id: <span class="string">'create_supplier'</span>,      label: <span class="string">'Yeni Tedarik&ccedil;i'</span> },
        { id: <span class="string">'edit_supplier'</span>,        label: <span class="string">'D&uuml;zenle'</span> },
        { id: <span class="string">'add_material'</span>,         label: <span class="string">'Malzeme Ekle'</span> },
        { id: <span class="string">'remove_material'</span>,      label: <span class="string">'Malzeme Kald&#305;r'</span> },
        { id: <span class="string">'deactivate_supplier'</span>,  label: <span class="string">'Pasifle&scedil;tir'</span> },
        { id: <span class="string">'hard_delete_supplier'</span>, label: <span class="string">'Kal&#305;c&#305; Sil'</span>, critical: true }
    ]
});</pre>

        <p>The backend uses <code>check_permission_smart()</code> which checks three layers in order: (1) super_admin always passes, (2) old role-based check (user_type in required list), (3) new ultra-granular page.button permission. If any layer passes, the action is allowed. This ensures backward compatibility during the transition from role-based to button-level permissions.</p>

        <h3>6.1.11 Real-Time Updates</h3>
        <p>Three supplier operations broadcast WebSocket events:</p>
        <ul>
            <li><code>broadcast_update("suppliers", "create", {id, name})</code> &mdash; after successful creation</li>
            <li><code>broadcast_update("suppliers", "update", {id, name})</code> &mdash; after update or status toggle</li>
            <li><code>broadcast_update("suppliers", "delete", {id, name})</code> &mdash; after hard delete</li>
        </ul>
        <p>The frontend subscribes to rooms <code>['suppliers', 'all']</code> and calls <code>actionRef.current?.reload()</code> on any event, triggering a full table refresh.</p>

        <h3>6.1.12 Eager Loading for Performance</h3>
        <p>The list endpoint uses SQLAlchemy&rsquo;s <code>joinedload</code> to fetch suppliers with their materials in a single query:</p>

        <pre>query = db.query(Supplier).options(
    joinedload(Supplier.materials_provided)
)</pre>

        <p>Without this, listing 50 suppliers would trigger 50 additional queries to fetch each supplier&rsquo;s materials (the N+1 problem). With eager loading, it&rsquo;s a single JOIN query.</p>

        <h3>6.1.13 Data Cleaning Before Submit</h3>
        <p>The frontend cleans the materials array before sending to the backend, stripping <code>undefined</code> values that Pydantic would reject:</p>

        <pre><span class="keyword">const</span> cleanedMaterials = materials.map(mat =&gt; {
    <span class="keyword">const</span> cleaned: any = { material_type: mat.material_type };
    <span class="keyword">if</span> (mat.material_name !== <span class="keyword">undefined</span> &amp;&amp; mat.material_name !== <span class="string">''</span>)
        cleaned.material_name = mat.material_name;
    <span class="keyword">if</span> (mat.density !== <span class="keyword">undefined</span> &amp;&amp; mat.density !== <span class="keyword">null</span>)
        cleaned.density = mat.density;
    <span class="keyword">if</span> (mat.boyut !== <span class="keyword">undefined</span> &amp;&amp; mat.boyut !== <span class="string">''</span>)
        cleaned.boyut = mat.boyut;
    <span class="keyword">if</span> (mat.reel_type !== <span class="keyword">undefined</span> &amp;&amp; mat.reel_type !== <span class="string">''</span>)
        cleaned.reel_type = mat.reel_type;
    <span class="keyword">return</span> cleaned;
});</pre>

        <div class="discovery">
            <p style="margin-bottom: 0;"><strong>Why this matters:</strong> Without cleaning, a copper material would be sent as <code>{"material_type": "copper", "material_name": undefined, "density": undefined, "boyut": undefined, "reel_type": undefined}</code>. Pydantic would accept these as <code>None</code>, but JSON.stringify drops <code>undefined</code> values entirely. The explicit check ensures only meaningful data is sent, keeping the API payload clean and predictable.</p>
        </div>

        <h3>6.1.14 How Supplier Data Is Used Across the System</h3>
        <p>Tedarik&ccedil;i Y&ouml;netimi is not a standalone page. The data it creates is consumed by <strong>every other submodule</strong> in Hammadde and beyond. Here is the complete map of where supplier data flows:</p>

        <h4>Material Entry (Hammadde Giri&#351;i) &mdash; Supplier Selection</h4>
        <p>When a user clicks any material card (copper, tin, plastic, etc.), the entry page calls <code>GET /suppliers/list?active_only=true</code> and filters locally by checking each supplier&rsquo;s <code>materials_provided</code> array. Only suppliers who have that material type active in their <code>supplier_materials</code> are shown in the dropdown. This means: if you register a supplier with only &ldquo;copper&rdquo; and &ldquo;tin&rdquo;, they will <strong>never appear</strong> in the plastic entry form.</p>

        <pre><span class="comment">// Material Entry: filter suppliers by material type</span>
<span class="keyword">const</span> filterSuppliers = (materialType: string) =&gt; {
    <span class="keyword">const</span> filtered = suppliers.filter(supplier =&gt; {
        <span class="keyword">const</span> materials = supplier.materials_provided || [];
        <span class="keyword">return</span> materials.some(
            (mat: any) =&gt; mat.material_type === materialType &amp;&amp; mat.is_active
        );
    });
    setFilteredSuppliers(filtered);
};</pre>

        <h4>Material Entry &mdash; Material Name Resolution</h4>
        <p>For lot-based entries (plastic, catalyst, dye, antirodent), when a lot is created, the backend looks up the <code>supplier_material_id</code> to resolve the specific <code>material_name</code>. This name (e.g., &ldquo;HF-500&rdquo;, &ldquo;CAT-203&rdquo;) is stored directly in the <code>raw_materials.material_name</code> column. For palettes and reels, it also appends the <code>boyut</code> dimension (e.g., &ldquo;Euro Palet - 120x80x15 cm&rdquo;).</p>

        <pre><span class="comment"># Lot entry: resolve material name from SupplierMaterial</span>
<span class="keyword">if</span> material_type_id:
    supplier_material = db.query(SupplierMaterial).filter(
        SupplierMaterial.id == material_type_id
    ).first()
    <span class="keyword">if</span> supplier_material:
        material_name = supplier_material.material_name
        <span class="keyword">if</span> supplier_material.boyut:
            material_name = f<span class="string">"{material_name} - {supplier_material.boyut}"</span></pre>

        <h4>Material Orders (Hammadde Sipari&#351;) &mdash; Supplier + Material Selection</h4>
        <p>When creating a purchase order, the user first selects a supplier, then sees only the materials that supplier provides. The order stores both <code>supplier_id</code> (who) and <code>supplier_material_id</code> (what exactly). This link is critical: when a delivery arrives and is entered through Material Entry, the system uses <code>supplier_material_id</code> to match incoming materials to their pending orders.</p>

        <h4>Material Orders &mdash; Pending Order Groups for Entry Linking</h4>
        <p>The <code>GET /material-orders/pending-by-type/{material_type}</code> endpoint returns pending orders grouped by <code>supplier_id + expected_date</code>. Material Entry uses this to show a &ldquo;Link to Order&rdquo; option. When the user selects an order group, the system builds an <code>order_map</code> keyed by <code>supplier_material_id</code>, so each lot in the entry can be automatically linked to its corresponding order line.</p>

        <h4>Material Calculator &mdash; Density from Supplier Materials</h4>
        <p>The <code>density</code> field stored in <code>supplier_materials</code> for plastics, catalysts, dyes, and antirodent compounds is used by the Material Calculator service. When the Sipari&#351; module calculates plastic weight for an order (<code>volume &times; density = kg</code>), the density comes from the supplier&rsquo;s material specification registered here.</p>

        <h4>Unique Specs for Dropdowns</h4>
        <p>The <code>GET /suppliers/materials-list</code> endpoint deduplicates material specs across all suppliers and returns unique entries. This feeds dropdown menus in Material Orders and Material Entry where users select <em>what</em> to order or enter &mdash; without seeing the same &ldquo;HF-500&rdquo; three times from three different suppliers.</p>

        <div class="insight">
            <p style="margin-bottom: 0;"><strong>The dependency chain:</strong> Supplier &rarr; supplier_materials (what they sell) &rarr; material_orders (what we ordered, referencing supplier_material_id) &rarr; raw_materials (what arrived, linked to order via material_order_id, with material_name resolved from supplier_materials). Remove a supplier, and this entire chain breaks. That is why FK protection exists on hard delete, and why soft delete (active/inactive) is the preferred approach.</p>
        </div>


        <!-- ============================================= -->
        <!--  6.2  HAMMADDE SİPARİŞ (Material Orders)     -->
        <!-- ============================================= -->

        <h2 id="sec-6-2">6.2 &mdash; Hammadde Sipari&#351; (Material Orders)</h2>

        <h3>6.2.1 &mdash; Purpose and Business Context</h3>
        <p>This is <strong>not</strong> an official purchase order system. It is an <em>internal tracking tool</em> that lets Solen record what raw materials they have ordered from which supplier, when they expect delivery, and what actually arrived. Its purpose is to give the purchasing and warehouse teams a clear picture of what is coming, what is late, and how well each supplier is performing.</p>
        <p>The module sits between Supplier Management (where suppliers and their product catalogs are defined) and Material Entry (where physical deliveries are received). Orders created here become &ldquo;linkable targets&rdquo; for Material Entry &mdash; when a truck arrives, the operator can connect the incoming material to its corresponding order, which automatically increments the delivered quantity and provides full traceability.</p>

        <h3>6.2.2 &mdash; Order Lifecycle</h3>
        <p>Every order follows a four-state lifecycle:</p>
        <div class="stat-grid" style="grid-template-columns: repeat(4, 1fr);">
            <div class="stat-card" style="border-left: 4px solid #fa8c16;">
                <div class="stat-value" style="font-size: 1.1rem;">Beklemede</div>
                <div class="stat-label">Pending &mdash; order placed, waiting for shipment</div>
            </div>
            <div class="stat-card" style="border-left: 4px solid #1890ff;">
                <div class="stat-value" style="font-size: 1.1rem;">Yolda</div>
                <div class="stat-label">Shipped &mdash; supplier confirmed dispatch</div>
            </div>
            <div class="stat-card" style="border-left: 4px solid #52c41a;">
                <div class="stat-value" style="font-size: 1.1rem;">Teslim Al&#305;nd&#305;</div>
                <div class="stat-label">Delivered &mdash; material arrived at factory</div>
            </div>
            <div class="stat-card" style="border-left: 4px solid #d9d9d9;">
                <div class="stat-value" style="font-size: 1.1rem;">&#304;ptal</div>
                <div class="stat-label">Cancelled &mdash; order abandoned</div>
            </div>
        </div>
        <p>Status transitions can happen two ways. First, the status column in the table is an inline dropdown selector &mdash; the user clicks the current status tag and picks a new one. Second, and more importantly, <strong>status is automatically set to &ldquo;Delivered&rdquo; by the Material Entry module</strong> when incoming materials are linked to an order. When a delivery is saved through Material Entry, the backend automatically updates the order&rsquo;s status to delivered, stamps today&rsquo;s date as the delivery date, and increments the delivered quantity. This means the most common status transition (pending &rarr; delivered) happens automatically as part of the material receiving workflow, not through manual interaction on this page.</p>

        <h3>6.2.3 &mdash; Order Group Codes (Shipment Grouping)</h3>
        <p>A single shipment from a supplier often contains multiple distinct materials. For example, one truck from Supplier X might carry 5 tons of HF-500 plastic granules <em>and</em> 2 tons of catalyst. Instead of treating these as completely separate orders, the system groups them under a shared <strong>Order Group Code</strong>.</p>
        <p>Group codes follow the pattern <strong>R1, R2, R3, R4&hellip;</strong> (the &ldquo;R&rdquo; prefix followed by a sequential number). When a user creates a new order with multiple line items, the backend generates one group code and assigns it to every order row in that batch. Even a single-item order gets a group code, ensuring consistency.</p>
        <p>The generation logic finds the highest existing R-number in the database and increments by one. This is a simple sequential counter, not a UUID &mdash; the codes are meant to be human-readable and easy to communicate verbally (&ldquo;Shipment R47 is arriving tomorrow&rdquo;).</p>
        <p>In the table, the group code appears as the first column (fixed left), displayed as a blue tag. It serves as a visual grouping mechanism &mdash; when users see multiple rows with &ldquo;R12&rdquo;, they immediately understand these items are from the same shipment.</p>

        <h3>6.2.4 &mdash; Creating an Order (The Multi-Step Form Flow)</h3>
        <p>The order creation follows a cascading selection flow that mirrors the supplier data hierarchy:</p>
        <ol>
            <li><strong>Select Material Type</strong> &mdash; the user picks from 8 types (copper, tin, plastic, catalyst, dye, antirodent, palette, reel). This is the first filter.</li>
            <li><strong>Select Supplier</strong> &mdash; the supplier dropdown is <em>not</em> a full list. It shows only suppliers who provide active materials of the selected type. If you pick &ldquo;Copper&rdquo;, you only see copper suppliers. This filtering happens client-side by checking each supplier&rsquo;s <code>materials_provided</code> array.</li>
            <li><strong>Add Products and Quantities</strong> &mdash; once a supplier is selected, the user sees their specific product catalog for that material type. Each product is a collapsible panel where the user picks the exact product and enters a quantity. The unit automatically adapts: palettes and reels use &ldquo;adet&rdquo; (pieces), everything else uses &ldquo;kg&rdquo;.</li>
            <li><strong>Multiple Items</strong> &mdash; the user can add more product panels with a &ldquo;+&rdquo; button. Each panel represents a separate line item, but all items will share the same group code when saved. The &ldquo;+&rdquo; button is disabled until a supplier is selected.</li>
            <li><strong>Set Dates</strong> &mdash; two dates are required: the order date (defaults to today) and the expected delivery date.</li>
            <li><strong>Optional Notes</strong> &mdash; free-text field for any additional context.</li>
        </ol>
        <p>On save, the frontend sends all items in a single API call. The backend generates one group code and creates one database row per item, all sharing that code. This is a single transaction &mdash; either all items are created or none are.</p>

        <h3>6.2.5 &mdash; Editing an Order</h3>
        <p>Edit mode works differently from creation. When editing, the user operates on a <strong>single order row</strong>, not a group. The form loads with the existing values, and the user can change the supplier, material, quantity, dates, and notes. The multi-item &ldquo;+&rdquo; functionality is not available in edit mode &mdash; you edit one row at a time.</p>
        <p>The most important behavior in edit mode is <strong>date change tracking</strong>, covered in detail below.</p>

        <h3>6.2.6 &mdash; The Date Change Tracking System</h3>
        <p>This is one of the most sophisticated features in the module. In real-world procurement, expected delivery dates shift constantly &mdash; suppliers delay, Solen requests postponement, logistics issues arise. The system does not just silently overwrite the date; it requires the user to explain <em>why</em> the date changed and stores a complete audit trail.</p>

        <h4>How It Works</h4>
        <p>When a user opens an existing order for editing, the system records the original expected date. If the user changes this date in the date picker, something unusual happens: the date picker does not close. Instead, a <strong>side panel</strong> slides into the right side of the calendar popup. This panel contains:</p>
        <ul>
            <li><strong>The new selected date</strong> displayed prominently</li>
            <li><strong>A reason selector</strong> (required) with three options:
                <ul>
                    <li><em>Tedarik&ccedil;i kaynakl&#305;</em> &mdash; delay caused by the supplier</li>
                    <li><em>Solen kaynakl&#305;</em> &mdash; delay caused by Solen (e.g., postponed due to schedule)</li>
                    <li><em>Di&#287;er</em> &mdash; other reason (opens a free-text field)</li>
                </ul>
            </li>
            <li><strong>Confirm / Cancel buttons</strong> &mdash; the user must explicitly confirm the date change after selecting a reason</li>
        </ul>
        <p>If the user selects &ldquo;Di&#287;er&rdquo; (Other), a text area appears for a manual explanation, and this explanation is also required. The user cannot save the order without completing this reason flow.</p>
        <p>If the user changes their mind and picks the original date again, the side panel disappears and the reason fields reset automatically.</p>

        <h4>Backend Storage</h4>
        <p>When the order is saved with a changed date, the backend creates a new row in the <code>material_order_date_changes</code> table with: the old date, the new date, the reason type, the optional detail text, who made the change, and a timestamp. This table uses <code>CASCADE</code> delete &mdash; if the parent order is deleted, its date change history goes with it.</p>

        <h4>Viewing the History</h4>
        <p>Every order row in the table has a clock icon button (Tarih Ge&ccedil;mi&#351;i / Date History). Clicking it opens a modal that shows every date change that ever happened to that order, displayed as a vertical timeline. Each entry shows:</p>
        <ul>
            <li>The old date (struck through) with an arrow pointing to the new date</li>
            <li>The reason as a colored tag</li>
            <li>Any detail text in italics</li>
            <li>When the change happened and who made it (shown in a right-aligned secondary column)</li>
        </ul>
        <p>Timestamps in this modal are converted to Turkey timezone (Europe/Istanbul) for accurate local display.</p>

        <h3>6.2.7 &mdash; Delivery Tracking (Ordered vs. Delivered)</h3>
        <p>Each order tracks two quantities: <strong>ordered quantity</strong> (what was requested) and <strong>delivered quantity</strong> (what actually arrived). The delivered quantity is <em>not</em> manually updated on this page. It is incremented automatically by the Material Entry module when incoming materials are linked to an order.</p>
        <p>In the table, both quantities are displayed side by side. The delivered column uses color coding to communicate status at a glance:</p>
        <ul>
            <li><strong>No color</strong> &mdash; nothing delivered yet (0)</li>
            <li><strong>Yellow/warning</strong> &mdash; partially delivered (some material arrived, but less than ordered)</li>
            <li><strong>Green</strong> &mdash; fully delivered (delivered &ge; ordered)</li>
        </ul>

        <h3>6.2.8 &mdash; The Rating System</h3>
        <p>Once an order reaches &ldquo;Delivered&rdquo; status, a star icon appears in the actions column. This enables a <strong>supplier delivery rating</strong> system. The user can rate the delivery on a 0.5&ndash;5 star scale (half-star increments) and optionally add a text note explaining the rating.</p>
        <p>The rating modal shows the order context (group code, supplier name, material, delivered quantity) so the user knows exactly what they are rating. The rating and note are stored directly on the order record.</p>
        <p>This rating data contributes to supplier performance tracking &mdash; over time, Solen can see which suppliers consistently deliver on time and in good condition, and which ones have recurring issues.</p>

        <div class="insight">
            <p style="margin-bottom: 0;"><strong>Business logic:</strong> The rating button only appears for &ldquo;delivered&rdquo; orders. You cannot rate a pending order because there is nothing to evaluate yet. If the order already has a rating, the star icon appears filled and yellow, showing the existing score in a tooltip on hover.</p>
        </div>

        <h3>6.2.9 &mdash; Client-Side Search and Localization</h3>
        <p>The table includes a search bar that filters orders across <em>all visible columns</em> using client-side filtering. What makes this non-trivial is that the data is stored in English (e.g., &ldquo;copper&rdquo;, &ldquo;pending&rdquo;) but the users search in Turkish. The search system maintains two translation maps:</p>
        <ul>
            <li><strong>Material types:</strong> copper&rarr;bak&#305;r, tin&rarr;kalay, plastic&rarr;plastik, catalyst&rarr;kataliz&ouml;r, dye&rarr;boya, palette&rarr;palet, reel&rarr;makara</li>
            <li><strong>Statuses:</strong> pending&rarr;beklemede, delivered&rarr;teslim al&#305;nd&#305;</li>
        </ul>
        <p>When the user types &ldquo;bak&#305;r&rdquo;, the filter matches any row where <code>material_type === 'copper'</code>. It also searches dates in DD.MM.YYYY format (not ISO), so searching &ldquo;15.03&rdquo; finds orders expected on March 15. The search covers: group code, supplier name, material name, material type (both EN and TR), status (both EN and TR), quantities, dates (both raw and formatted), and notes.</p>

        <h3>6.2.10 &mdash; Table Layout and Columns</h3>
        <p>The ProTable displays 11 columns with a scrollable layout:</p>
        <table style="width: 100%; border-collapse: collapse; margin: 16px 0;">
            <thead>
                <tr style="background: var(--bg-secondary);">
                    <th style="padding: 8px; text-align: left; border-bottom: 2px solid var(--border-color);">Column</th>
                    <th style="padding: 8px; text-align: left; border-bottom: 2px solid var(--border-color);">Description</th>
                    <th style="padding: 8px; text-align: left; border-bottom: 2px solid var(--border-color);">Behavior</th>
                </tr>
            </thead>
            <tbody>
                <tr><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Sipari&#351; No</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Order group code (R1, R2&hellip;)</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Fixed left, blue tag</td></tr>
                <tr><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Malzeme</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Material type</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Colored tag matching type</td></tr>
                <tr><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">&Uuml;r&uuml;n</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Specific product name from supplier catalog</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Blue tag</td></tr>
                <tr><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Tedarik&ccedil;i</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Supplier name</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Blue tag</td></tr>
                <tr><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Sipari&#351; Miktar&#305;</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Ordered quantity + unit</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Turkish number formatting</td></tr>
                <tr><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Gelen Miktar</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Delivered quantity + unit</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Green when complete, yellow when partial</td></tr>
                <tr><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Sipari&#351; Tarihi</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">When order was placed</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">DD.MM.YYYY format</td></tr>
                <tr><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Beklenen Tarih</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Expected delivery date</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);"><strong>Red if overdue</strong> (past today)</td></tr>
                <tr><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Geli&#351; Tarihi</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Actual delivery date</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Green text, or &ldquo;-&rdquo; if not delivered</td></tr>
                <tr><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Durum</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Order status</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);"><strong>Inline dropdown</strong> &mdash; clickable to change</td></tr>
                <tr><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">&#304;&#351;lem</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Action buttons</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Fixed right: history, rating, edit, delete</td></tr>
            </tbody>
        </table>
        <p>The expected date column deserves special attention: it compares the date against today and renders it in <strong>red</strong> if the date is in the past. This gives instant visual feedback about overdue orders without any manual flagging.</p>

        <h3>6.2.11 &mdash; API Endpoints</h3>
        <table style="width: 100%; border-collapse: collapse; margin: 16px 0;">
            <thead>
                <tr style="background: var(--bg-secondary);">
                    <th style="padding: 8px; text-align: left; border-bottom: 2px solid var(--border-color);">Method</th>
                    <th style="padding: 8px; text-align: left; border-bottom: 2px solid var(--border-color);">Endpoint</th>
                    <th style="padding: 8px; text-align: left; border-bottom: 2px solid var(--border-color);">Purpose</th>
                </tr>
            </thead>
            <tbody>
                <tr><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);"><code>GET</code></td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);"><code>/material-orders/list</code></td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Fetch all orders, sorted by expected date ascending. Optional filters: status, material type. Returns enriched data with supplier name and material name resolved from related tables.</td></tr>
                <tr><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);"><code>GET</code></td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);"><code>/material-orders/pending-by-type/{type}</code></td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Returns pending orders grouped by supplier + expected date. Consumed by Material Entry to let operators link deliveries to orders. Not used by the Orders page itself.</td></tr>
                <tr><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);"><code>POST</code></td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);"><code>/material-orders/create</code></td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Creates one or more order rows with a shared group code. Accepts an <code>items</code> array; generates a new R-code; auto-determines unit (kg vs adet) from material type.</td></tr>
                <tr><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);"><code>PUT</code></td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);"><code>/material-orders/update/{id}</code></td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Updates a single order. Handles status changes (auto-stamps delivered_date), date changes with audit trail recording, and quantity/notes updates.</td></tr>
                <tr><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);"><code>GET</code></td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);"><code>/material-orders/date-changes/{id}</code></td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Fetches the complete date change history for one order. Returns all changes sorted newest-first, with the username of who made each change.</td></tr>
                <tr><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);"><code>PUT</code></td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);"><code>/material-orders/rate/{id}</code></td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Saves a 0.5&ndash;5 star rating and optional note. Validates the range on the backend. Only meaningful for delivered orders (enforced on frontend by showing the button conditionally).</td></tr>
                <tr><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);"><code>DELETE</code></td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);"><code>/material-orders/delete/{id}</code></td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Hard-deletes an order. The CASCADE relationship automatically removes associated date change history records.</td></tr>
            </tbody>
        </table>

        <h3>6.2.12 &mdash; Database Schema</h3>
        <p>The module uses two tables:</p>
        <p><strong><code>material_orders</code></strong> &mdash; the main order tracking table. Each row represents one material line in a purchase order. Key fields:</p>
        <ul>
            <li><code>order_group_code</code> (indexed) &mdash; groups multiple items from the same shipment (R1, R2&hellip;)</li>
            <li><code>supplier_id</code> &rarr; FK to <code>suppliers</code></li>
            <li><code>supplier_material_id</code> &rarr; FK to <code>supplier_materials</code> &mdash; the specific product ordered</li>
            <li><code>quantity</code> / <code>delivered_quantity</code> &mdash; ordered vs. actually received</li>
            <li><code>unit</code> &mdash; auto-determined: &ldquo;adet&rdquo; for palette/reel, &ldquo;kg&rdquo; for everything else</li>
            <li><code>order_date</code> / <code>expected_date</code> / <code>delivered_date</code> &mdash; the three date milestones</li>
            <li><code>status</code> &mdash; pending / shipped / delivered / cancelled</li>
            <li><code>rating</code> / <code>rating_note</code> &mdash; post-delivery evaluation</li>
            <li><code>created_by</code> &rarr; FK to <code>users</code> &mdash; audit trail for who created the order</li>
        </ul>

        <p><strong><code>material_order_date_changes</code></strong> &mdash; the audit trail for expected date modifications. Each row captures one change event:</p>
        <ul>
            <li><code>order_id</code> &rarr; FK to <code>material_orders</code> with <code>CASCADE</code> delete</li>
            <li><code>old_date</code> / <code>new_date</code> &mdash; what changed</li>
            <li><code>reason_type</code> &mdash; supplier, solen, or other</li>
            <li><code>reason_detail</code> &mdash; free text (only for &ldquo;other&rdquo; type)</li>
            <li><code>changed_by</code> &rarr; FK to <code>users</code></li>
        </ul>

        <h3>6.2.13 &mdash; How Material Orders Connect to Material Entry</h3>
        <p>This is the most critical downstream connection. The <code>pending-by-type</code> endpoint exists specifically for Material Entry. When an operator starts entering a delivery of, say, copper wire, the Material Entry page calls this endpoint with <code>material_type=copper</code>. The response comes back as groups organized by supplier + expected date, showing each pending order line with its product name and quantity.</p>
        <p>The operator selects the matching order group, and the system builds an internal <code>order_map</code> keyed by <code>supplier_material_id</code>. As each lot is entered, it is automatically linked to the correct order line. This link is stored in the <code>raw_materials.material_order_id</code> field.</p>
        <p>When a material entry is saved with an order link, the backend increments the order&rsquo;s <code>delivered_quantity</code>. This happens in the material entry routes, not in the order routes &mdash; the order module is passive in this regard. It creates the tracking records; the entry module updates them on delivery.</p>

        <div class="insight">
            <p style="margin-bottom: 0;"><strong>The default sort order tells a story:</strong> orders are sorted by <code>expected_date ASC</code> &mdash; the soonest deliveries appear first. Combined with the red overdue highlighting, the table naturally pushes the most urgent items to the top. A warehouse manager opening this page immediately sees what is late and what is coming next.</p>
        </div>

        <h3>6.2.14 &mdash; How Material Orders Feed the Stock Projection System (Projeksiyon)</h3>
        <p>This is arguably the most important downstream consumer of Material Orders data, and it operates at a completely different abstraction level than the order page itself.</p>
        <p>The <strong>Projeksiyon</strong> (Stock Projection) system provides a weekly forecast of raw material availability across the entire factory. It answers the question: &ldquo;Week by week, will we have enough of each material, or will we run short?&rdquo; To answer this, it needs two data streams:</p>
        <ul>
            <li><strong>MINUS (&#304;htiya&ccedil;)</strong> &mdash; how much material will production <em>consume</em> each week. This comes from Work Cards (production plans) &mdash; KC cards for copper, KL cards for tin, EX cards for plastics/catalyst/dye/antirodent, Aktarma cards for reels, Paletleme cards for palettes.</li>
            <li><strong>PLUS (Gelen)</strong> &mdash; how much material is <em>arriving</em> each week. <strong>This comes entirely from Material Orders.</strong></li>
        </ul>
        <p>The Projeksiyon service reads every non-cancelled material order and places it into the correct week based on a critical decision: if the order has been delivered, it uses the <code>delivered_date</code> (actual arrival). If it is still pending or shipped, it uses the <code>expected_date</code> (planned arrival). Similarly, for delivered orders it uses <code>delivered_quantity</code> (what actually came), and for pending orders it uses <code>quantity</code> (what was ordered).</p>
        <p>This means that every change a user makes in the Material Orders page directly affects the projection:</p>
        <ul>
            <li><strong>Creating a new order</strong> &rarr; adds a PLUS entry to the expected week</li>
            <li><strong>Changing the expected date</strong> &rarr; moves that PLUS from one week to another (which is why date change tracking matters so much &mdash; it shifts the projection)</li>
            <li><strong>Changing the quantity</strong> &rarr; increases or decreases the PLUS for that week</li>
            <li><strong>Cancelling an order</strong> &rarr; removes the PLUS entirely (cancelled orders are excluded)</li>
            <li><strong>Order becoming delivered</strong> &rarr; the PLUS switches from expected_date/quantity to delivered_date/delivered_quantity, reflecting reality</li>
        </ul>

        <p>The projection is described in the codebase comments as a &ldquo;permanent plan&rdquo;, but the implementation tells a more nuanced story. It does <strong>not</strong> change when production completes (finished work cards still count as planned consumption). However, it <strong>does</strong> react to material deliveries: when Material Entry marks an order as delivered, the projeksiyon switches from using <code>expected_date</code> + <code>quantity</code> (the plan) to <code>delivered_date</code> + <code>delivered_quantity</code> (the actual). This means the PLUS entry can shift to a different week if the delivery arrived on a different date than expected, and the amount can change if the delivered quantity differs from the ordered quantity. So the projection is a living view that blends planned and actual data &mdash; pending orders show what <em>should</em> come, delivered orders show what <em>actually</em> came.</p>

        <p>The service also resolves each order down to its <strong>specific material name</strong> via the <code>supplier_material</code> relationship. So the projection does not just show &ldquo;+500 kg plastic in Week 12&rdquo; &mdash; it shows &ldquo;+500 kg HFX-500P in Week 12&rdquo;. This per-material granularity allows the projection to detect shortages at the individual material level, not just the category level.</p>

        <p>The projection calculates a <strong>cumulative balance</strong> across all weeks. If Week 10 has +500 kg copper arriving but Week 11 needs -800 kg for production, the cumulative goes negative, flagging a shortage. The frontend highlights these shortages visually. Without Material Orders providing the PLUS side, the entire projection would show only consumption with no incoming &mdash; making it useless for planning.</p>

        <div class="insight">
            <p style="margin-bottom: 0;"><strong>The dual role of Material Orders:</strong> On the surface, this module is a simple tracking table. But underneath, it is one of the two foundational data sources for the factory&rsquo;s stock projection system. Every order, every date change, every quantity update ripples through the weekly projection and affects shortage detection across the entire planning horizon. This is why accurate order entry and diligent date change tracking are not administrative overhead &mdash; they are critical inputs to the factory&rsquo;s production planning accuracy.</p>
        </div>

        <h3>6.2.15 &mdash; Delete Behavior</h3>
        <p>Orders can be hard-deleted through a confirmation dialog. There is no soft-delete / archive mechanism. The CASCADE relationship on <code>material_order_date_changes</code> ensures that deleting an order also removes its date change history. However, if a <code>raw_material</code> entry is already linked to this order via <code>material_order_id</code>, that link will become a dangling reference (the foreign key on raw_materials is nullable, so it will not cause a constraint violation, but the traceability chain is broken).</p>

        <h3>6.2.16 &mdash; What This Module Does NOT Do</h3>
        <ul>
            <li>It does <strong>not</strong> generate official purchase orders or invoices</li>
            <li>It does <strong>not</strong> manage pricing or costs &mdash; there are no price fields</li>
            <li>It does <strong>not</strong> send notifications or emails to suppliers</li>
            <li>It does <strong>not</strong> use WebSocket &mdash; the table refreshes on explicit user actions (save, delete, status change)</li>
            <li>It does <strong>not</strong> use the permission system &mdash; any authenticated user can access all features</li>
            <li>It does <strong>not</strong> handle pricing, invoicing, or financial tracking of any kind</li>
        </ul>


        <!-- ============================================= -->
        <!--  6.3  HAMMADDE GİRİŞİ (Material Entry)       -->
        <!-- ============================================= -->

        <h2 id="sec-6-3">6.3 &mdash; Hammadde Giri&#351;i (Material Entry)</h2>

        <h3>6.3.1 &mdash; Purpose and Business Context</h3>
        <p>This is where physical reality meets the digital system. When a truck arrives at Solen&rsquo;s factory with raw materials, the warehouse operator uses this module to register what came in. Every kilogram of copper, every barrel of plastic, every pallet &mdash; it all enters the system through this single page.</p>
        <p>The module does not just record inventory; it is the <strong>bridge</strong> between three other systems. It consumes data from Supplier Management (who delivered), links deliveries to Material Orders (what was expected), generates the QR codes and database records that appear in Hammaddeler Listesi (the inventory), and indirectly updates the Projeksiyon (stock projection) by changing order status and delivered quantities.</p>
        <p>The page lives under <code>/hammadde/hammadde-girisi</code> in the menu, but its frontend component is actually located at <code>Lab/MaterialEntry</code> &mdash; reflecting that material entry is a lab/warehouse operation.</p>

        <h3>6.3.2 &mdash; The Landing Page: Eight Material Cards</h3>
        <p>When the user opens the page, they see a grid of <strong>8 clickable cards</strong>, one for each raw material type the factory handles:</p>
        <div class="stat-grid" style="grid-template-columns: repeat(4, 1fr);">
            <div class="stat-card" style="border-left: 4px solid #fa8c16;">
                <div class="stat-value" style="font-size: 1rem;">Bak&#305;r (A)</div>
                <div class="stat-label">Copper wire rod &mdash; Filma&#351;in</div>
            </div>
            <div class="stat-card" style="border-left: 4px solid #13c2c2;">
                <div class="stat-value" style="font-size: 1rem;">Kalay (B)</div>
                <div class="stat-label">Tin &mdash; single weight entry</div>
            </div>
            <div class="stat-card" style="border-left: 4px solid #722ed1;">
                <div class="stat-value" style="font-size: 1rem;">Plastik (C)</div>
                <div class="stat-label">Plastic granules &mdash; lot-based</div>
            </div>
            <div class="stat-card" style="border-left: 4px solid #eb2f96;">
                <div class="stat-value" style="font-size: 1rem;">Kataliz&ouml;r (D)</div>
                <div class="stat-label">Catalyst &mdash; lot-based</div>
            </div>
            <div class="stat-card" style="border-left: 4px solid #f5222d;">
                <div class="stat-value" style="font-size: 1rem;">Boya (E)</div>
                <div class="stat-label">Dye &mdash; lot-based</div>
            </div>
            <div class="stat-card" style="border-left: 4px solid #2f54eb;">
                <div class="stat-value" style="font-size: 1rem;">Antirodent (F)</div>
                <div class="stat-label">Rodent repellent &mdash; lot-based</div>
            </div>
            <div class="stat-card" style="border-left: 4px solid #a0d911;">
                <div class="stat-value" style="font-size: 1rem;">Palet (I)</div>
                <div class="stat-label">Wooden palettes &mdash; count-based</div>
            </div>
            <div class="stat-card" style="border-left: 4px solid #faad14;">
                <div class="stat-value" style="font-size: 1rem;">Makara (H)</div>
                <div class="stat-label">Cable reels &mdash; count-based</div>
            </div>
        </div>
        <p>Each card has a unique background color that adapts to dark/light theme, a large icon, and the material name. The letter in parentheses is the QR code prefix for that material type. Clicking any card does <strong>not</strong> immediately open the entry form &mdash; it triggers the Order Selection flow first.</p>

        <h3>6.3.3 &mdash; The Two-Step Entry Flow</h3>
        <p>This is a critical design decision. Material entry follows a two-step process:</p>
        <ol>
            <li><strong>Step 1: Order Selection Modal</strong> &mdash; When the user clicks a material card, the system immediately fetches pending orders for that material type from <code>GET /material-orders/pending-by-type/{type}</code>. A modal appears showing:
                <ul>
                    <li>A list of pending order groups, each showing the supplier name, the material names in that shipment, the total quantity, and the expected date</li>
                    <li>A &ldquo;Manuel Giri&#351;&rdquo; (Manual Entry) button at the bottom for deliveries that have no corresponding order</li>
                </ul>
            </li>
            <li><strong>Step 2: Entry Form</strong> &mdash; The user either picks an order group (which pre-fills supplier, material types, and quantities) or clicks Manual Entry (which opens a blank form). The entry form is a dynamic modal that changes its entire structure based on the material type.</li>
        </ol>
        <p>This two-step flow serves a critical purpose: it encourages operators to link deliveries to orders, which keeps the tracking chain intact. If orders exist, they are displayed prominently. Manual entry exists as a fallback, not the default.</p>

        <h3>6.3.4 &mdash; Order Pre-filling Logic</h3>
        <p>When the user selects an order group in Step 1, the following happens automatically:</p>
        <ul>
            <li>The <strong>supplier</strong> field is auto-filled and <strong>disabled</strong> &mdash; you cannot change the supplier when entering against an order</li>
            <li>For <strong>lot-based materials</strong> (plastic, catalyst, dye, antirodent): the system pre-creates one lot panel per order line item, with the <code>material_type_id</code> (specific product) already selected from the order&rsquo;s <code>supplier_material_id</code></li>
            <li>For <strong>palettes and reels</strong>: the system pre-creates one type panel per order line item, with the palette/reel type and quantity pre-filled from the order</li>
            <li>For <strong>copper and tin</strong>: the supplier is pre-filled; the rest (palette weights, lot numbers) must be entered manually since orders track total kg, not per-palette details</li>
        </ul>
        <p>The order group also carries the <code>order_ids</code> array, which is sent to the backend on save so the system knows which orders to mark as delivered.</p>

        <h3>6.3.5 &mdash; Four Form Archetypes</h3>
        <p>The entry form is not one form. It is <strong>four completely different form structures</strong> that render conditionally based on which material type was selected. They all share two common fields (supplier and received-by person) and a common photo section, but everything in between is unique.</p>

        <h4>Archetype 1: Copper (Multi-Palette)</h4>
        <p>Copper arrives in large palettes (Filma&#351;in &mdash; wire rod coils on palettes). A single delivery may contain multiple palettes, each with its own weight. The form presents a dynamic list of <strong>collapsible palette panels</strong>:</p>
        <ul>
            <li>Each panel contains: <strong>Lot Number</strong> (with keyboard toggle), <strong>Form Weight</strong> (weight on the supplier&rsquo;s delivery form), <strong>Measured Weight</strong> (actual weight measured at Solen), and <strong>Status</strong> (received or rejected)</li>
            <li>The user can add more palettes with a &ldquo;+&rdquo; button and remove any panel except the last one</li>
            <li>The form starts with one empty palette panel</li>
            <li>On save, the backend creates <strong>one <code>raw_materials</code> row per palette</strong>, each with its own QR code (A1, A2, A3&hellip;)</li>
            <li>Both form_weight and measured_weight are stored &mdash; the difference helps identify discrepancies between what the supplier claims and what actually arrived</li>
            <li><code>remaining_weight</code> is initialized to <code>measured_weight</code> and is decremented by production later</li>
        </ul>

        <h4>Archetype 2: Tin (Single Entry)</h4>
        <p>Tin is the simplest entry type. A single delivery is one weight measurement:</p>
        <ul>
            <li>The form shows just two fields: <strong>Net Weight (kg)</strong> and <strong>Status</strong></li>
            <li>One row in <code>raw_materials</code>, one QR code (B1, B2&hellip;)</li>
            <li>The lot number is auto-generated as <code>TIN-{sequence}</code></li>
            <li><code>remaining_weight</code> is initialized to the entered weight</li>
        </ul>

        <h4>Archetype 3: Lot-Based (Plastic, Catalyst, Dye, Antirodent)</h4>
        <p>These four material types share the same form structure because they all arrive in lots (batches from a production run at the supplier). The form presents a dynamic list of <strong>collapsible lot panels</strong>:</p>
        <ul>
            <li>Each panel contains: <strong>Material Type</strong> (dropdown of specific products from the supplier&rsquo;s catalog, e.g., &ldquo;HFX-500P&rdquo;), <strong>Lot Number</strong> (with keyboard toggle), <strong>Form Weight</strong>, <strong>Measured Weight</strong>, <strong>Quantity</strong> (number of labels to print &mdash; how many containers in this lot), <strong>Status</strong>, and <strong>Test/Damage Photos</strong> (per-lot, up to 3)</li>
            <li>The Material Type dropdown is <strong>context-sensitive</strong>: if the entry is linked to an order, it only shows materials from that order&rsquo;s line items. If manual, it shows all of the supplier&rsquo;s materials for that type</li>
            <li>On save, the backend creates <strong>one row per lot</strong> with its own QR code (C1/D1/E1/F1&hellip;)</li>
            <li>The backend resolves the specific <code>material_name</code> from <code>SupplierMaterial</code> and appends the <code>boyut</code> (size) if present, creating names like &ldquo;HFX-500P - 2mm&rdquo;</li>
        </ul>

        <h4>Archetype 4: Count-Based (Palette, Reel)</h4>
        <p>Palettes and reels are counted items, not weighed. The form presents <strong>collapsible type panels</strong>:</p>
        <ul>
            <li>Each panel contains: <strong>Type</strong> (dropdown from supplier&rsquo;s catalog, e.g., &ldquo;Euro Palet - 120 cm&rdquo; or &ldquo;500m Makara - 40 cm - Plastik&rdquo;), <strong>Quantity</strong> (count), <strong>Status</strong>, and <strong>Damage Photos</strong> (per-type, up to 3)</li>
            <li>The type dropdown is populated from the supplier&rsquo;s <code>materials_provided</code> filtered by palette or reel type</li>
            <li>For reels, the display includes <code>material_name - boyut cm - reel_type</code> to show the full specification</li>
            <li>On save, the backend creates <strong>one row per type</strong> with QR code (I1/H1&hellip;). The lot number is auto-generated as <code>PALET-{seq}</code> or <code>REEL-{seq}</code></li>
            <li>The <code>weight</code> field is used to store the quantity (count), and <code>quantity</code> also stores the count &mdash; this is a dual-purpose field for backward compatibility</li>
        </ul>

        <h3>6.3.6 &mdash; The Lot Number Keyboard Toggle</h3>
        <p>This is a small but important UX feature. Lot numbers can be purely numeric (e.g., &ldquo;24081901&rdquo;) or alphanumeric (e.g., &ldquo;LOT-A24-081&rdquo;). On mobile devices, the input keyboard that appears depends on the <code>inputMode</code> attribute. The system defaults to <code>numeric</code> (number pad) but provides a toggle button inside the input field that switches between number pad and full keyboard. Each lot input tracks its own keyboard mode independently.</p>

        <h3>6.3.7 &mdash; The QR Code System</h3>
        <p>Every material entry generates a unique, deterministic QR code. The system uses a simple but effective scheme: a <strong>letter prefix</strong> identifying the material type, followed by a <strong>sequential number</strong> that increments per type.</p>
        <table style="width: 100%; border-collapse: collapse; margin: 16px 0;">
            <thead>
                <tr style="background: var(--bg-secondary);">
                    <th style="padding: 8px; text-align: left; border-bottom: 2px solid var(--border-color);">Prefix</th>
                    <th style="padding: 8px; text-align: left; border-bottom: 2px solid var(--border-color);">Material</th>
                    <th style="padding: 8px; text-align: left; border-bottom: 2px solid var(--border-color);">Examples</th>
                </tr>
            </thead>
            <tbody>
                <tr><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);"><strong>A</strong></td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Copper (Bak&#305;r)</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">A1, A2, A3&hellip;</td></tr>
                <tr><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);"><strong>B</strong></td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Tin (Kalay)</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">B1, B2, B3&hellip;</td></tr>
                <tr><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);"><strong>C</strong></td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Plastic (Plastik)</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">C1, C2, C3&hellip;</td></tr>
                <tr><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);"><strong>D</strong></td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Catalyst (Kataliz&ouml;r)</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">D1, D2, D3&hellip;</td></tr>
                <tr><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);"><strong>E</strong></td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Dye (Boya)</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">E1, E2, E3&hellip;</td></tr>
                <tr><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);"><strong>F</strong></td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Antirodent</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">F1, F2, F3&hellip;</td></tr>
                <tr><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);"><strong>I</strong></td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Palette (Palet)</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">I1, I2, I3&hellip;</td></tr>
                <tr><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);"><strong>H</strong></td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Reel (Makara)</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">H1, H2, H3&hellip;</td></tr>
            </tbody>
        </table>
        <p>The sequence number is determined by querying the highest existing <code>sequence_number</code> for that material type and incrementing by one. Each material type has its own counter &mdash; copper can be at A847 while tin is at B23. The QR code is stored in the <code>qr_code</code> column with a <strong>unique constraint</strong>, ensuring no duplicates.</p>
        <p>For copper entries with multiple palettes, the backend increments the sequence for each palette within the same transaction (A45, A46, A47 for a 3-palette entry).</p>

        <h3>6.3.8 &mdash; Photo Architecture</h3>
        <p>The photo system has two tiers:</p>
        <ul>
            <li><strong>Common delivery photos (&#304;rsaliye)</strong> &mdash; these are photos of the delivery document (waybill/invoice). They apply to the entire delivery, not individual items. Up to 3 photos, shared across all materials in the entry. Shown for all material types.</li>
            <li><strong>Per-item photos (Test/Hasar)</strong> &mdash; these are test reports or damage documentation for individual items:
                <ul>
                    <li>For <strong>copper and tin</strong>: a common &ldquo;Test Report Photo&rdquo; section (up to 3) appears alongside the delivery photos</li>
                    <li>For <strong>lot-based materials</strong>: each lot panel has its own &ldquo;Test/Hasar Foto&#287;raflar&#305;&rdquo; section (up to 3 per lot)</li>
                    <li>For <strong>palette and reel</strong>: each type panel has its own &ldquo;Hasar Foto&#287;raflar&#305;&rdquo; section (up to 3 per type)</li>
                </ul>
            </li>
        </ul>
        <p>Photos are converted to base64 on the frontend before submission. The backend stores them in the <code>material_photos</code> table (not on the material row itself) with a <code>photo_type</code> discriminator (&ldquo;delivery&rdquo; or &ldquo;test&rdquo;) and a <code>sequence</code> number. This separate table enables <strong>lazy loading</strong> &mdash; when listing materials, only photo IDs are returned; the actual base64 data is fetched on demand via <code>GET /materials/photo/{id}</code>.</p>

        <h3>6.3.9 &mdash; Order Linking and Automatic Delivery Updates</h3>
        <p>This is where Material Entry connects back to Material Orders and, through that, to the Projeksiyon system.</p>
        <p>When a delivery is linked to orders, the backend performs these additional steps after creating the material rows:</p>
        <ul>
            <li>For <strong>copper/tin</strong>: the first order ID from <code>material_order_ids</code> is used. The total delivered weight (sum of all palette weights for copper, or the single weight for tin) is added to the order&rsquo;s <code>delivered_quantity</code>. The order status is set to &ldquo;delivered&rdquo; and <code>delivered_date</code> is stamped with today.</li>
            <li>For <strong>lot-based materials</strong>: the system builds an <code>order_map</code> keyed by <code>supplier_material_id</code>. For each lot, it checks if the lot&rsquo;s <code>material_type_id</code> matches a key in the map, and if so, links that lot to the corresponding order. Each order&rsquo;s <code>delivered_quantity</code> is incremented by its specific lots&rsquo; weights.</li>
            <li>For <strong>palette/reel</strong>: same order_map logic, but using the palette/reel type ID to match against <code>supplier_material_id</code>. Delivered quantity increments by the item count.</li>
        </ul>
        <p>Every linked order gets <code>status = delivered</code>, <code>delivered_date = today</code>, and <code>delivered_quantity += amount</code>. This is the automatic status transition discussed in Section 6.2.</p>

        <h3>6.3.10 &mdash; The Success Modal and QR Printing</h3>
        <p>After a successful save, the system does not simply close the form. It shows a <strong>success modal</strong> that displays:</p>
        <ul>
            <li>A confirmation message with the generated QR codes listed (e.g., &ldquo;A45, A46, A47&rdquo;)</li>
            <li>Two buttons: <strong>OK</strong> (close and return) and <strong>Yazd&#305;r</strong> (Print) which triggers the QR label printing flow</li>
        </ul>
        <p>The print button calls <code>POST /materials/print/{material_id}</code> which routes to the print queue system. For lot-based entries with multiple lots, the system iterates through all created material IDs and prints each one sequentially.</p>
        <p>The save button text is contextual: for palette and reel entries it says &ldquo;Kaydet (QR Yok)&rdquo; (Save, no QR) because palettes and reels use physical identification rather than printed QR labels. For all other types it says &ldquo;Kaydet ve QR Kod Olu&#351;tur&rdquo; (Save and Generate QR Code).</p>

        <h3>6.3.11 &mdash; Supplier Filtering</h3>
        <p>When a material card is clicked and the entry form opens, the supplier dropdown does not show all suppliers. It is filtered to show only suppliers who have active materials of the selected type in their <code>materials_provided</code> catalog. This filtering happens client-side by checking each supplier&rsquo;s materials array. If no suppliers are found for a material type, the dropdown shows a helpful message: &ldquo;Bu malzeme i&ccedil;in tedarik&ccedil;i bulunamad&#305;. &Ouml;nce tedarik&ccedil;i ekleyin.&rdquo;</p>

        <h3>6.3.12 &mdash; Permission System</h3>
        <p>Material Entry registers <strong>13 page-level buttons</strong> with the ultra-granular permission system:</p>
        <ul>
            <li><code>access_page</code> &mdash; ability to see the page at all</li>
            <li><code>add_copper</code>, <code>add_tin</code>, <code>add_plastic</code>, <code>add_catalyst</code>, <code>add_dye</code>, <code>add_antirodent</code>, <code>add_palette</code>, <code>add_reel</code> &mdash; one permission per material card</li>
            <li><code>submit_form</code> &mdash; the save button</li>
            <li><code>upload_delivery_photo</code>, <code>upload_test_photo</code> &mdash; photo upload capabilities</li>
            <li><code>print_qr_modal</code> &mdash; the print button in the success modal</li>
        </ul>
        <p>The backend also enforces role-based access: only <code>lab_user</code> and <code>super_admin</code> user types can create material entries. Other user types receive a 403 Forbidden response.</p>

        <h3>6.3.13 &mdash; WebSocket Broadcasting</h3>
        <p>After creating material entries (copper/tin path), the backend broadcasts a WebSocket update for each created material with the event type &ldquo;materials:create&rdquo;, including the material ID, QR code, and type. This allows the Hammaddeler Listesi page to update in real-time without manual refresh when new materials are entered from another session.</p>
        <p>The update and hard-delete operations also broadcast &ldquo;materials:update&rdquo; and &ldquo;materials:delete&rdquo; events respectively.</p>

        <h3>6.3.14 &mdash; Material Update (Super Admin Only)</h3>
        <p>An existing material record can be updated through <code>PUT /materials/update/{id}</code>, but this is restricted to <strong>super_admin only</strong>. The updatable fields include: QR code (with uniqueness validation), lot number, weight, form weight, remaining weight, quantity, status, notes, and photos. This is used for corrections &mdash; if an operator entered the wrong weight, a super admin can fix it. The QR code is changeable but must remain unique across all materials.</p>

        <h3>6.3.15 &mdash; Material Deletion</h3>
        <p>Hard deletion is available through <code>DELETE /materials/{id}/hard-delete</code> (super admin only). Before deleting, the system checks:</p>
        <ul>
            <li>If the material status is &ldquo;in_use&rdquo;, deletion is <strong>blocked</strong> &mdash; you cannot remove material that is currently in production</li>
            <li>Related print jobs are deleted first</li>
            <li>Related photos are deleted (CASCADE would handle this, but the code does it explicitly)</li>
        </ul>
        <p>After deletion, a WebSocket broadcast notifies all connected clients.</p>

        <h3>6.3.16 &mdash; Material Status Lifecycle</h3>
        <p>Each material record has a status that tracks its journey through the factory:</p>
        <div class="stat-grid" style="grid-template-columns: repeat(5, 1fr);">
            <div class="stat-card" style="border-left: 4px solid #1890ff;">
                <div class="stat-value" style="font-size: 0.9rem;">received</div>
                <div class="stat-label">Just arrived, entered in system</div>
            </div>
            <div class="stat-card" style="border-left: 4px solid #52c41a;">
                <div class="stat-value" style="font-size: 0.9rem;">approved</div>
                <div class="stat-label">Passed quality check</div>
            </div>
            <div class="stat-card" style="border-left: 4px solid #faad14;">
                <div class="stat-value" style="font-size: 0.9rem;">in_use</div>
                <div class="stat-label">Currently in production</div>
            </div>
            <div class="stat-card" style="border-left: 4px solid #d9d9d9;">
                <div class="stat-value" style="font-size: 0.9rem;">consumed</div>
                <div class="stat-label">Fully used up</div>
            </div>
            <div class="stat-card" style="border-left: 4px solid #ff4d4f;">
                <div class="stat-value" style="font-size: 0.9rem;">rejected</div>
                <div class="stat-label">Failed quality, returned</div>
            </div>
        </div>
        <p>The entry form only offers two initial statuses: &ldquo;received&rdquo; (default) and &ldquo;rejected&rdquo;. The other statuses (approved, in_use, consumed) are set by downstream systems &mdash; quality control and production modules. There is also a <code>toggle-status</code> endpoint that flips the material&rsquo;s <code>is_active</code> flag for soft-disable.</p>

        <h3>6.3.17 &mdash; API Endpoints</h3>
        <table style="width: 100%; border-collapse: collapse; margin: 16px 0;">
            <thead>
                <tr style="background: var(--bg-secondary);">
                    <th style="padding: 8px; text-align: left; border-bottom: 2px solid var(--border-color);">Method</th>
                    <th style="padding: 8px; text-align: left; border-bottom: 2px solid var(--border-color);">Endpoint</th>
                    <th style="padding: 8px; text-align: left; border-bottom: 2px solid var(--border-color);">Purpose</th>
                </tr>
            </thead>
            <tbody>
                <tr><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);"><code>POST</code></td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);"><code>/materials/entry</code></td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Creates copper (multi-palette) or tin (single) entries. Generates QR codes, saves photos, links orders, broadcasts WebSocket.</td></tr>
                <tr><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);"><code>POST</code></td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);"><code>/materials/lot-entry</code></td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Creates lot-based entries (plastic, catalyst, dye, antirodent). One row per lot with material name resolved from SupplierMaterial. Builds order_map for per-lot linking.</td></tr>
                <tr><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);"><code>POST</code></td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);"><code>/materials/palette-entry</code></td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Creates palette entries. One row per palette type with I-prefix QR codes. Auto-generates PALET-{seq} lot numbers.</td></tr>
                <tr><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);"><code>POST</code></td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);"><code>/materials/reel-entry</code></td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Creates reel entries. One row per reel type with H-prefix QR codes. Material name includes boyut and reel_type. Auto-generates REEL-{seq} lot numbers.</td></tr>
                <tr><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);"><code>GET</code></td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);"><code>/materials/list</code></td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Returns all materials with supplier names, photo IDs (lazy), and order group codes. Used by Hammaddeler Listesi.</td></tr>
                <tr><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);"><code>GET</code></td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);"><code>/materials/photo/{id}</code></td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Returns single photo base64 data on demand (lazy loading).</td></tr>
                <tr><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);"><code>PUT</code></td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);"><code>/materials/update/{id}</code></td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Updates material fields including QR code (super admin only). Replaces all photos on update.</td></tr>
                <tr><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);"><code>DELETE</code></td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);"><code>/materials/{id}/hard-delete</code></td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Permanent deletion (super admin). Blocks if in_use. Cleans up photos and print jobs.</td></tr>
                <tr><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);"><code>PUT</code></td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);"><code>/materials/{id}/toggle-status</code></td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Toggles is_active flag for soft disable/enable.</td></tr>
                <tr><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);"><code>GET</code></td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);"><code>/materials/print/preview/{id}</code></td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Generates label preview image (base64) before printing.</td></tr>
                <tr><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);"><code>POST</code></td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);"><code>/materials/print/{id}</code></td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Sends QR label to print queue for physical printing.</td></tr>
                <tr><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);"><code>POST</code></td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);"><code>/materials/print/update-printer-ip</code></td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Updates printer IP/port (super admin). Tests connection after update.</td></tr>
                <tr><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);"><code>GET</code></td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);"><code>/materials/print/test-connection</code></td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Tests printer connectivity (lab user + super admin).</td></tr>
            </tbody>
        </table>

        <h3>6.3.18 &mdash; Database Schema: raw_materials</h3>
        <p>All 8 material types are stored in a single table. Key fields:</p>
        <ul>
            <li><code>material_type</code> &mdash; discriminator: raw_copper, raw_tin, raw_plastic, raw_catalyst, raw_dye, raw_antirodent, raw_palette, raw_reel</li>
            <li><code>material_name</code> &mdash; specific product name resolved from SupplierMaterial (e.g., &ldquo;HFX-500P - 2mm&rdquo;). NULL for copper and tin.</li>
            <li><code>sequence_number</code> &mdash; per-type incrementing counter used for QR code generation</li>
            <li><code>qr_code</code> &mdash; unique, deterministic identifier (A1, B5, C23, etc.)</li>
            <li><code>supplier_id</code> &rarr; FK to <code>suppliers</code></li>
            <li><code>material_order_id</code> &rarr; nullable FK to <code>material_orders</code> &mdash; the traceability link back to the purchase order</li>
            <li><code>lot_number</code> &mdash; user-entered for copper/lot-based, auto-generated for tin/palette/reel</li>
            <li><code>weight</code> &mdash; measured weight for weight-based materials, count for palettes/reels</li>
            <li><code>remaining_weight</code> &mdash; initialized to weight, decremented by production consumption</li>
            <li><code>form_weight</code> &mdash; weight on the supplier&rsquo;s delivery form (copper and lot-based only)</li>
            <li><code>quantity</code> &mdash; number of containers/labels for lot-based materials, count for palette/reel</li>
            <li><code>status</code> &mdash; received / approved / in_use / consumed / rejected</li>
            <li><code>entered_by</code> &rarr; FK to <code>users</code></li>
        </ul>

        <h3>6.3.19 &mdash; How Material Entry Connects to Everything</h3>
        <p>This is the most interconnected module in the Hammadde system. Here is every upstream and downstream connection:</p>
        <ul>
            <li><strong>Supplier Management (upstream)</strong> &mdash; provides the supplier list, material catalogs, and product names. The entry form&rsquo;s dropdowns are populated entirely from supplier data.</li>
            <li><strong>Material Orders (upstream + downstream)</strong> &mdash; provides pending orders for the Step 1 modal. On save, Material Entry writes back to orders: setting status to delivered, stamping the date, incrementing delivered quantity.</li>
            <li><strong>Projeksiyon (indirect downstream)</strong> &mdash; by changing order status from pending to delivered and setting delivered_date/delivered_quantity, Material Entry shifts the Projeksiyon from planned to actual data for those orders.</li>
            <li><strong>Hammaddeler Listesi (downstream)</strong> &mdash; every row created here appears immediately in the materials list. The list page consumes <code>/materials/list</code> and displays all entries with their QR codes, weights, statuses, and photos.</li>
            <li><strong>Production System (downstream)</strong> &mdash; production modules consume materials by referencing their QR codes, decrementing <code>remaining_weight</code>, and changing status to in_use/consumed.</li>
            <li><strong>Print Queue (downstream)</strong> &mdash; the success modal triggers label printing through the print queue system.</li>
        </ul>

        <div class="insight">
            <p style="margin-bottom: 0;"><strong>Why the form changes shape:</strong> Each material type has fundamentally different physical properties. Copper arrives on palettes that must be individually weighed. Tin is a single block. Plastics come in numbered lots that need individual tracking. Palettes and reels are counted, not weighed. A single generic form would either be too complex (showing irrelevant fields) or too simple (missing required data). The four-archetype approach ensures every material gets exactly the fields it needs &mdash; no more, no less.</p>
        </div>


        <!-- ============================================= -->
        <!--  6.4  HAMMADDELER LİSTESİ (Materials List)    -->
        <!-- ============================================= -->

        <h2 id="sec-6-4">6.4 &mdash; Hammaddeler Listesi (Materials List)</h2>

        <h3>6.4.1 &mdash; Purpose and Business Context</h3>
        <p>This is the <strong>inventory view</strong> of every raw material that has ever entered the factory. While Material Entry is about recording arrivals, this module is about seeing, searching, managing, and acting on the inventory. It is a read-heavy module &mdash; the primary use case is looking up materials by QR code, checking remaining weights, viewing photos, and reprinting labels. But it also provides editing and deletion capabilities for super admins.</p>
        <p>The page consumes the output of Material Entry: every row created through any of the four entry archetypes shows up here. It is the single source of truth for &ldquo;what raw materials do we have, and what state are they in?&rdquo;</p>

        <h3>6.4.2 &mdash; Real-Time Updates via WebSocket</h3>
        <p>Unlike Material Orders (which refreshes on user actions), this page subscribes to WebSocket rooms <code>materials</code> and <code>all</code>. When any user creates, updates, or deletes a material from any device or session, the table automatically reloads. This means if an operator enters a delivery through Material Entry on a tablet in the warehouse, a manager viewing the list on their desktop sees the new rows appear instantly without pressing refresh.</p>

        <h3>6.4.3 &mdash; The Table: 14 Columns</h3>
        <p>The ProTable displays a comprehensive view of every material record:</p>
        <table style="width: 100%; border-collapse: collapse; margin: 16px 0;">
            <thead>
                <tr style="background: var(--bg-secondary);">
                    <th style="padding: 8px; text-align: left; border-bottom: 2px solid var(--border-color);">Column</th>
                    <th style="padding: 8px; text-align: left; border-bottom: 2px solid var(--border-color);">Description</th>
                    <th style="padding: 8px; text-align: left; border-bottom: 2px solid var(--border-color);">Behavior</th>
                </tr>
            </thead>
            <tbody>
                <tr><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">QR Kod</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Unique identifier (A1, B5, C23&hellip;)</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Fixed left, blue tag</td></tr>
                <tr><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Sipari&#351; No</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Linked order group code (R1, R2&hellip;)</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Cyan tag, or &ldquo;-&rdquo; if no order link</td></tr>
                <tr><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Tip</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Material type</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Colored tag with Turkish name (Bak&#305;r, Kalay, Plastik&hellip;)</td></tr>
                <tr><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Malzeme Ad&#305;</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Specific product name</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Shows resolved name, defaults to &ldquo;Filma&#351;in&rdquo; for copper, &ldquo;Kalay K&uuml;l&ccedil;e&rdquo; for tin</td></tr>
                <tr><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Tedarik&ccedil;i</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Supplier name</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Plain text</td></tr>
                <tr><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Lot No</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Lot/batch number</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Shows &ldquo;&mdash;&rdquo; for palette/reel (not applicable)</td></tr>
                <tr><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Form Miktar</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Supplier&rsquo;s declared weight</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">kg or adet based on type</td></tr>
                <tr><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">&Ouml;l&ccedil;&uuml;len Miktar</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Actual measured weight</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">kg or adet based on type</td></tr>
                <tr><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Kalan</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Remaining weight after production</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);"><strong>Color-coded:</strong> yellow if &lt;95% of original, red if &lt;20%. &ldquo;&mdash;&rdquo; for palette/reel.</td></tr>
                <tr><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Giri&#351; Tarihi</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">When material was entered</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">DD.MM.YYYY Turkish locale</td></tr>
                <tr><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">&#304;rsaliye</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Delivery document photos</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Lazy-loaded thumbnail with &ldquo;+N&rdquo; badge if multiple</td></tr>
                <tr><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Test</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Test/damage photos</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Lazy-loaded thumbnail with &ldquo;+N&rdquo; badge if multiple</td></tr>
                <tr><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Durum</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Material status</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Colored tag: green=received, red=rejected, blue=available, yellow=in_use, grey=consumed</td></tr>
                <tr><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">&#304;&#351;lemler</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Action buttons</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Fixed right: print, edit, delete</td></tr>
            </tbody>
        </table>

        <h3>6.4.4 &mdash; The &ldquo;Kalan&rdquo; (Remaining Weight) Column</h3>
        <p>This is one of the most operationally important columns. It shows how much of the original material is still available after production has consumed portions of it. The color coding provides instant visual feedback:</p>
        <ul>
            <li><strong>No color</strong> &mdash; the remaining weight is close to the original (within 5% tolerance)</li>
            <li><strong>Yellow / bold</strong> &mdash; the material has been partially consumed (remaining is less than 95% of original)</li>
            <li><strong>Red / bold</strong> &mdash; the material is nearly depleted (remaining is less than 20% of original)</li>
        </ul>
        <p>For palette and reel materials, this column shows &ldquo;&mdash;&rdquo; because counted items do not have a remaining weight concept &mdash; they are either available or consumed as whole units.</p>
        <p>If <code>remaining_weight</code> is not set (older records), the system falls back to the original <code>weight</code> value for backward compatibility.</p>

        <h3>6.4.5 &mdash; Lazy Photo Loading System</h3>
        <p>The photo columns are the most technically interesting part of this page. With potentially thousands of materials and up to 6 photos each (3 delivery + 3 test), loading all photo data with the table would be catastrophically slow. The system uses a <strong>two-tier lazy loading</strong> approach:</p>
        <ol>
            <li><strong>Table load:</strong> the <code>/materials/list</code> endpoint returns only photo <em>IDs</em> (small integers), not photo data. This keeps the API response fast.</li>
            <li><strong>Thumbnail load:</strong> each photo cell renders a <code>LazyPhotoThumbnail</code> component that independently fetches the first photo&rsquo;s base64 data via <code>GET /materials/photo/{id}</code>. Only the first photo is loaded for the thumbnail.</li>
            <li><strong>Preview load:</strong> when the user clicks a thumbnail to preview, the component fetches all remaining photos in that group. This means if a material has 3 delivery photos, only the first is loaded initially; the other two load on click.</li>
        </ol>
        <p>The thumbnail shows as a 40x40 pixel image with rounded corners. If there are multiple photos, a blue badge appears at the bottom-right showing &ldquo;+N&rdquo; (e.g., &ldquo;+2&rdquo; for 3 photos). Clicking opens the full-size preview with left/right navigation and a page counter.</p>

        <h3>6.4.6 &mdash; Client-Side Search</h3>
        <p>The search bar filters across all loaded data on the client side. Like the Material Orders search, it supports bilingual matching with EN&rarr;TR translation maps for both material types and statuses. Searchable fields include: QR code, material name, material type (raw_copper&rarr;bak&#305;r, etc.), supplier name, lot number, order group code, status (received&rarr;teslim al&#305;nd&#305;, etc.), and all weight/quantity values as strings.</p>
        <p>The search is implemented as a <code>useMemo</code> that recomputes on every keystroke against the full <code>allMaterials</code> array. The table renders the filtered result via <code>dataSource={filteredData}</code>.</p>

        <h3>6.4.7 &mdash; The Edit Modal: Three Form Variants</h3>
        <p>The edit modal adapts its fields based on the material type being edited, using three variants:</p>
        <ul>
            <li><strong>Copper/Tin:</strong> QR code, lot number, form weight, measured weight, <strong>remaining weight</strong> (editable for corrections, with helper text explaining its purpose), status (4 options: received, available, in_use, consumed), photos, notes</li>
            <li><strong>Lot-based (plastic, catalyst, dye, antirodent):</strong> QR code, lot number, form weight, measured weight, <strong>quantity</strong> (label count), status (2 options: received, rejected), photos, notes</li>
            <li><strong>Palette/Reel:</strong> QR code, <strong>quantity (adet)</strong>, status (2 options: received, rejected) &mdash; the simplest form, no weights or lot numbers</li>
        </ul>
        <p>Every variant includes the QR code field with a warning: &ldquo;Dikkat: QR kodunu de&#287;i&#351;tirmek sistemdeki kay&#305;tlar&#305; etkileyebilir&rdquo; (Changing the QR code may affect system records).</p>
        <p>When opening the edit modal, photos are lazy-loaded: the system fetches each photo by ID from the API and converts them into Ant Design <code>UploadFile</code> objects for the upload component. This means the modal shows the existing photos and allows adding new ones or removing existing ones.</p>

        <h3>6.4.8 &mdash; Print with Printer Selection</h3>
        <p>The print button in the actions column opens a <strong>printer selection modal</strong> before printing. This modal shows:</p>
        <ul>
            <li>The material&rsquo;s QR code for confirmation</li>
            <li>The label count (for lot-based materials with <code>quantity &gt; 1</code>, multiple labels are printed)</li>
            <li>A dropdown of active printers fetched from <code>GET /printers/list?active_only=true</code>, showing each printer&rsquo;s name and location</li>
        </ul>
        <p>The print job is submitted to <code>POST /print-queue/queue/{material_id}?printer_id={id}</code>. The print button is <strong>disabled</strong> for palette and reel materials (they don&rsquo;t use QR labels), with a tooltip explaining why.</p>

        <h3>6.4.9 &mdash; Permission System</h3>
        <p>The page registers <strong>12 page-level buttons</strong>:</p>
        <ul>
            <li><code>access_page</code>, <code>view_table</code>, <code>view_photos</code>, <code>search_filter</code> &mdash; read capabilities</li>
            <li><code>print_qr</code> &mdash; printing</li>
            <li><code>edit_material</code> &mdash; open edit modal</li>
            <li><code>delete_material</code>, <code>hard_delete_material</code> (marked <em>critical</em>) &mdash; deletion</li>
            <li><code>update_qr_code</code>, <code>update_weight</code>, <code>update_status</code>, <code>update_photos</code> &mdash; granular edit field permissions</li>
        </ul>
        <p>The &ldquo;hard_delete_material&rdquo; permission is flagged as <code>critical: true</code>, signaling to administrators that this is a destructive, irreversible action.</p>

        <h3>6.4.10 &mdash; Table Localization</h3>
        <p>The ProTable toolbar buttons (reload, density, column settings) are localized to Turkish through a custom <code>ProConfigProvider</code> that maps internal message IDs to Turkish strings. This includes: &ldquo;Yenile&rdquo; (Reload), &ldquo;Sat&#305;r Yo&#287;unlu&#287;u&rdquo; (Row Density), &ldquo;Tablo Ayarlar&#305;&rdquo; (Table Settings), &ldquo;S&uuml;tun G&ouml;r&uuml;n&uuml;m&uuml;&rdquo; (Column Display), pin directions, and more. The Ant Design locale is also set to <code>trTR</code> for date/number formatting.</p>

        <h3>6.4.11 &mdash; How This Module Connects to the System</h3>
        <ul>
            <li><strong>Material Entry (upstream)</strong> &mdash; the sole data source. Every row in this table was created by one of the four entry endpoints.</li>
            <li><strong>Material Orders (indirect)</strong> &mdash; the &ldquo;Sipari&#351; No&rdquo; column shows the order group code, providing visual traceability from inventory back to the purchase order.</li>
            <li><strong>Production System (downstream)</strong> &mdash; production modules read from this inventory (via <code>/materials/list</code> or direct DB queries), select materials by QR code, and update <code>remaining_weight</code> and <code>status</code> as they consume materials. This page reflects those changes in real-time via WebSocket.</li>
            <li><strong>Print Queue (downstream)</strong> &mdash; the print action sends jobs to the print queue for physical label output.</li>
        </ul>

        <div class="insight">
            <p style="margin-bottom: 0;"><strong>The full traceability chain visible on one row:</strong> A single row in this table tells you: what it is (QR code + type + material name), where it came from (supplier + order group code), how much there was (form weight vs. measured weight), how much is left (remaining weight with color coding), what it looks like (delivery and test photos), and what its current state is (status). This is the complete lifecycle view of a raw material &mdash; from delivery to depletion &mdash; all in one row.</p>
        </div>


        <!-- ============================================= -->
        <!--  7.  CONCLUSION                               -->
        <!-- ============================================= -->

        <h2 id="sec-7" style="margin-top: 64px;">7. CONCLUSION</h2>

        <div class="abstract">
            <p style="margin-bottom: 0;"><strong>Hammadde is where the physical world meets the digital system.</strong> Every gram of copper, every tin ingot, every plastic lot, every palette and reel that enters the factory gate passes through this module. It assigns the identity (QR code), records the evidence (photos), tracks the quantity (weight), and maintains the state (status lifecycle). Without it, the production system has no materials to consume, the stock system has no inventory to report, and the projection system has no incoming data to forecast with.</p>
        </div>

        <h3>7.1 What This Document Covered</h3>

        <p>This deep dive analyzed the Hammadde module across four submodules, from supplier definitions through purchase tracking, material entry, and inventory viewing:</p>

        <table>
            <tr><th>Section</th><th>Submodule</th><th>Depth</th><th>Key Insight</th></tr>
            <tr><td>6.1</td><td>Tedarik&ccedil;i Y&ouml;netimi</td><td>Full</td><td>One-to-many supplier&rarr;materials with material-specific properties (density, boyut, reel_type); delete-and-recreate update strategy; consumed by Entry, Orders, and Calculator</td></tr>
            <tr><td>6.2</td><td>Hammadde Sipari&#351;</td><td>Full</td><td>Order group codes (R1, R2&hellip;) for shipment grouping; date change audit trail with mandatory reasons; automatic status updates by Material Entry; feeds Projeksiyon as the &ldquo;PLUS&rdquo; side</td></tr>
            <tr><td>6.3</td><td>Hammadde Giri&#351;i</td><td>Exhaustive</td><td>Four dynamic form archetypes (copper/tin/lot-based/count-based); deterministic QR codes (A&ndash;H prefixes); two-tier lazy photo loading; automatic order delivery updates</td></tr>
            <tr><td>6.4</td><td>Hammaddeler Listesi</td><td>Full</td><td>14-column inventory view with color-coded remaining weight; three edit form variants; lazy photo thumbnails with preview; real-time WebSocket updates</td></tr>
        </table>

        <h3>7.2 Architectural Principles</h3>

        <div class="arch-grid">
            <div class="arch-box">
                <h4>Physical-First Design</h4>
                <p>Each material type has fundamentally different physical properties. Rather than forcing a single generic form, the system uses four distinct archetypes &mdash; ensuring copper palettes are individually weighed, tin gets auto-generated lot numbers, plastics track lot counts for labels, and palettes/reels are simply counted. The UI adapts to the material, not the other way around.</p>
            </div>
            <div class="arch-box">
                <h4>Lazy Everything</h4>
                <p>Photos are stored separately and loaded on demand. The materials list returns only photo IDs, not base64 data. Thumbnails load one photo each; previews fetch the rest on click. This pattern keeps a table with thousands of rows and potentially tens of thousands of photos responsive.</p>
            </div>
            <div class="arch-box">
                <h4>Automatic Cascading</h4>
                <p>When a material delivery is recorded, the linked purchase order&rsquo;s delivered_quantity, status, and delivered_date update automatically. This cascades further into Projeksiyon, which switches from planned to actual data. One action in Material Entry ripples through Orders and into the projection system without manual intervention.</p>
            </div>
            <div class="arch-box">
                <h4>Deterministic Identity</h4>
                <p>QR codes follow a strict prefix+sequence pattern (A=copper, B=tin, C=plastic&hellip;). No UUIDs, no randomness. The sequence is per-type and auto-incrementing. This means QR codes are human-readable, sortable, and predictable &mdash; critical for a factory floor where operators scan labels with handheld devices.</p>
            </div>
        </div>

        <h3>7.3 The Numbers</h3>

        <div class="stat-grid">
            <div class="stat-box">
                <div class="value" style="color: var(--accent);">4</div>
                <div class="label">SUBMODULES</div>
            </div>
            <div class="stat-box">
                <div class="value" style="color: var(--turquoise);">~30</div>
                <div class="label">API ENDPOINTS</div>
            </div>
            <div class="stat-box">
                <div class="value">6</div>
                <div class="label">DATABASE TABLES</div>
            </div>
            <div class="stat-box">
                <div class="value" style="color: var(--positive);">~2,200</div>
                <div class="label">LINES BACKEND</div>
            </div>
            <div class="stat-box">
                <div class="value" style="color: var(--negative);">~5,100</div>
                <div class="label">LINES FRONTEND</div>
            </div>
            <div class="stat-box">
                <div class="value">8</div>
                <div class="label">MATERIAL TYPES</div>
            </div>
        </div>

        <h3>7.4 How Hammadde Feeds the Factory</h3>

        <div class="flow">
            <span class="flow-step">Tedarik&ccedil;i</span>
            <span class="flow-arrow">&rarr;</span>
            <span class="flow-step">Sipari&#351;</span>
            <span class="flow-arrow">&rarr;</span>
            <span class="flow-step">Hammadde Giri&#351;i</span>
            <span class="flow-arrow">&rarr;</span>
            <span class="flow-step">Hammaddeler Listesi</span>
            <span class="flow-arrow">&rarr;</span>
            <span class="flow-step">&Uuml;retim (Production)</span>
        </div>

        <p>Suppliers define what materials are available and their properties. Orders track what has been purchased and when it&rsquo;s arriving. Material Entry records the physical arrival &mdash; weighing, photographing, QR-coding, and linking back to the order. The Materials List becomes the living inventory that production consumes. As production uses materials, remaining weights drop, statuses change, and the cycle continues until the material is fully consumed.</p>

        <p>In parallel, every order feeds the <strong>Projeksiyon</strong> system with planned and actual delivery data, enabling the factory to forecast material availability weeks ahead.</p>

        <h3>7.5 Final Word</h3>

        <div class="abstract">
            <p style="margin-bottom: 0;">The Hammadde module transforms a chaotic physical process &mdash; trucks arriving with copper wire, tin blocks, plastic drums, and wooden palettes &mdash; into structured, traceable, searchable digital records. Every material gets an identity, a history, and a status. From the moment a supplier is defined to the moment the last gram of copper is consumed in production, this module provides the data trail. The four-archetype form design, the lazy photo architecture, the automatic order cascading, and the real-time WebSocket updates all serve one goal: making the gap between physical reality and digital record as small as possible. This document has traced that entire chain, from supplier definition to inventory depletion, through every API endpoint, every database column, every frontend interaction, and every cross-module connection.</p>
        </div>

    </main>
</body>
</html>
