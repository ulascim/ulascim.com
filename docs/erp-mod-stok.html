<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="icon" type="image/png" href="../favicon.png">
    <link rel="apple-touch-icon" href="../apple-touch-icon.png">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock &amp; Inventory Module | Cable Factory ERP</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --bg: #f3f3f3;
            --fg: #000000;
            --gray-100: #f3f4f6;
            --gray-300: #d1d5db;
            --positive: #16a34a;
            --negative: #dc2626;
            --accent: #2563eb;
            --turquoise: #00b5ad;
        }
        body { font-family: 'IBM Plex Mono', monospace; background: var(--bg); color: var(--fg); font-size: 12px; line-height: 1.3; }
        .nav { position: sticky; top: 0; z-index: 50; border-bottom: 2px solid var(--fg); background: var(--bg); }
        .nav-container { max-width: 1400px; margin: 0 auto; padding: 0 64px; height: 56px; display: flex; align-items: center; }
        .nav-left { display: flex; align-items: center; gap: 12px; }
        .nav-logo { font-size: 18px; font-weight: 700; letter-spacing: 2px; text-decoration: none; color: var(--fg); }
        .nav-right { margin-left: auto; }
        .nav-link-small { color: var(--fg); text-decoration: underline; font-size: 11px; }
        .nav-divider { color: var(--fg); font-size: 14px; font-weight: 300; }
        .report { max-width: 1400px; margin: 0 auto; padding: 24px 64px; }
        .report h1 { font-size: 28px; margin-bottom: 8px; letter-spacing: 2px; }
        .report h2 { font-size: 18px; margin-top: 36px; margin-bottom: 12px; border-bottom: 2px solid #000; padding-bottom: 4px; scroll-margin-top: 72px; }
        .report h3 { font-size: 14px; margin-top: 20px; margin-bottom: 8px; }
        .report h4 { font-size: 12px; margin-top: 14px; margin-bottom: 6px; }
        .report p { font-size: 13px; line-height: 1.6; margin-bottom: 12px; }
        .report ul { font-size: 13px; margin: 12px 0; padding-left: 20px; }
        .report li { margin-bottom: 6px; line-height: 1.5; }
        .report ol { font-size: 13px; margin: 12px 0; padding-left: 20px; }
        .report ol li { margin-bottom: 6px; line-height: 1.5; }
        .report .subtitle { font-size: 14px; color: #666; margin-bottom: 4px; }
        .report .authors { font-size: 12px; color: #888; margin-bottom: 32px; }
        .report code { background: #e5e5e0; padding: 1px 5px; font-size: 12px; }
        .report pre { background: #1a1a2e; color: #e0e0e0; padding: 16px; margin: 12px 0; overflow-x: auto; font-size: 12px; line-height: 1.5; border: 2px solid #000; }
        .report .abstract { background: #f5f5f0; padding: 16px; margin: 20px 0; border-left: 3px solid #000; }
        .report .finding { background: #fffbe6; padding: 12px; margin: 12px 0; border: 1px solid #e6d600; }
        .report .warning { background: #fee2e2; padding: 12px; margin: 12px 0; border: 1px solid #dc2626; }
        .report .discovery { background: #e6ffe6; padding: 12px; margin: 12px 0; border: 1px solid #0a0; }
        .report .insight { background: #eff6ff; padding: 12px; margin: 12px 0; border: 1px solid #2563eb; }
        .report .philosophy { background: #faf5ff; padding: 12px; margin: 12px 0; border: 1px solid #7c3aed; }
        .stat-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin: 16px 0; }
        .stat-grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin: 16px 0; }
        .stat-box { background: #f3f4f6; padding: 12px; text-align: center; border: 2px solid #000; }
        .stat-box .value { font-size: 24px; font-weight: bold; }
        .stat-box .label { font-size: 10px; color: #666; margin-top: 2px; }
        .report table { width: auto; border-collapse: collapse; border: 2px solid #000; margin: 16px 0; }
        .report tr:first-child { background: #f3f4f6; border-bottom: 2px solid #000; }
        .report th { padding: 4px 10px; text-align: left; font-size: 0.65rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.03em; white-space: nowrap; border-right: 2px solid #000; background: #f3f4f6; }
        .report th:last-child { border-right: none; }
        .report tr:not(:first-child) { border-bottom: 1px solid #d1d5db; }
        .report tr:last-child { border-bottom: none; }
        .report td { padding: 4px 10px; font-size: 0.75rem; border-right: 2px solid #000; }
        .report td:last-child { border-right: none; }
        .report tr:not(:first-child):hover { background: rgba(0,0,0,0.02); }
        .flow { display: flex; align-items: center; gap: 8px; margin: 16px 0; flex-wrap: wrap; }
        .flow-step { padding: 8px 14px; border: 2px solid #000; font-size: 12px; font-weight: 700; text-align: center; min-width: 100px; }
        .flow-arrow { font-size: 18px; font-weight: 700; }
        .flow-box { padding: 8px 14px; border: 2px solid #000; font-size: 12px; font-weight: 700; text-align: center; min-width: 100px; }
        .flow-box.done { background: #dcfce7; border-color: #16a34a; }
        .flow-box.active { background: #dbeafe; border-color: #2563eb; }
        .flow-box.pending { background: #f3f4f6; }
        .arch-box { background: #fff; border: 2px solid #000; padding: 16px; margin: 12px 0; }
        .arch-box h4 { font-size: 14px; margin-bottom: 8px; margin-top: 0; }
        .arch-box p { font-size: 12px; line-height: 1.5; }
        .arch-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 16px; margin: 16px 0; }
        .back-link { display: inline-block; font-size: 12px; color: #666; text-decoration: none; margin-bottom: 24px; padding: 8px 0; }
        .back-link:hover { color: #000; }
        .back-link::before { content: "\2190  "; }
        .good { color: #16a34a; font-weight: 700; }
        .bad { color: #dc2626; font-weight: 700; }
        .code-block { background: #1a1a2e; color: #e0e0e0; padding: 16px; margin: 12px 0; overflow-x: auto; font-size: 12px; line-height: 1.5; border: 2px solid #000; }

        .submod-card { background: #fff; border: 2px solid #000; padding: 16px; margin: 10px 0; display: flex; align-items: flex-start; gap: 16px; }
        .submod-num { background: #000; color: #fff; font-size: 13px; font-weight: 700; min-width: 36px; height: 36px; padding: 0 8px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        .submod-body { flex: 1; }
        .submod-body h4 { font-size: 14px; margin: 0 0 4px 0; }
        .submod-body p { font-size: 12px; color: #555; margin: 0 0 6px 0; line-height: 1.4; }
        .submod-tags { display: flex; gap: 6px; flex-wrap: wrap; }
        .submod-tag { font-size: 10px; padding: 2px 6px; background: #f3f4f6; border: 1px solid #d1d5db; }

        @media (max-width: 768px) {
            .report { padding: 16px; }
            .nav-container { padding: 0 16px; }
            .stat-grid, .stat-grid-3 { grid-template-columns: repeat(2, 1fr); }
            .flow { flex-direction: column; align-items: stretch; }
            .flow-arrow { transform: rotate(90deg); text-align: center; }
            .arch-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <nav class="nav">
        <div class="nav-container">
            <div class="nav-left">
                <a href="erp-system.html" class="nav-logo">ERP SYSTEM</a>
            </div>
            <div class="nav-right">
                <a href="erp-mod-stok-tr.html" class="nav-link-small">TR</a>
                <span class="nav-divider">|</span>
                <a href="erp-mod-stok.html" class="nav-link-small" style="font-weight: 700;">EN</a>
            </div>
        </div>
    </nav>

    <main class="report">
        <a href="erp-deep-dives.html" class="back-link">Back to Modules</a>
        <h1>STOCK &amp; INVENTORY &mdash; DUAL-LOGIC MATERIAL VISIBILITY</h1>
        <p class="subtitle">Two parallel systems answering two different questions: &ldquo;What do we have right now?&rdquo; and &ldquo;What will we have in the future?&rdquo; &mdash; the live inventory and the dynamic projection forecast, running side by side as a built-in double-check mechanism.</p>
        <p class="authors">February 2026 &bull; Solen Kablo &bull; Living Document</p>

        <div class="abstract">
            <p style="margin-bottom: 0;"><strong>The Stock &amp; Inventory module operates on a fundamental duality.</strong> Two of its three pages &mdash; &Uuml;r&uuml;n Stok and Hammadde Stok &mdash; show the physical reality of the factory at this exact moment: every basket of copper wire, every reel of extruded cable, every kilogram of raw plastic sitting in the warehouse. These change every time Production records an output or a material is consumed. The third page &mdash; Projeksiyon &mdash; ignores physical reality entirely and instead shows the <em>plan</em>: a week-by-week forecast of what materials will be needed (from work cards) versus what materials are coming in (from purchase orders). Projeksiyon dynamically reacts to plan changes &mdash; when a material order is delivered, it switches from the expected date/quantity to the actual delivered date/quantity, shifting the projection accordingly. It also updates when work cards are created, modified, or cancelled. This duality is intentional &mdash; it creates a built-in cross-verification mechanism where the live inventory validates the projection, and the projection warns about future shortages that the live inventory cannot yet see.</p>
        </div>

        <div class="stat-grid">
            <div class="stat-box">
                <div class="value" style="color: var(--accent);">3</div>
                <div class="label">SUBMODULES</div>
            </div>
            <div class="stat-box">
                <div class="value" style="color: var(--turquoise);">~14</div>
                <div class="label">API ENDPOINTS</div>
            </div>
            <div class="stat-box">
                <div class="value">2</div>
                <div class="label">DATABASE TABLES</div>
            </div>
            <div class="stat-box">
                <div class="value" style="color: var(--positive);">5800+</div>
                <div class="label">LINES OF CODE</div>
            </div>
        </div>

        <!-- TABLE OF CONTENTS -->
        <div style="background: #fff; border: 2px solid #000; padding: 20px 28px; margin: 24px 0;">
            <h3 style="margin: 0 0 12px 0; font-size: 14px; letter-spacing: 1px;">TABLE OF CONTENTS</h3>
            <div style="columns: 2; column-gap: 32px; font-size: 12px; line-height: 2;">
                <a href="#sec-1" style="text-decoration: none; color: var(--fg); display: block;"><strong>1.</strong> What Stock &amp; Inventory Does</a>
                <a href="#sec-2" style="text-decoration: none; color: var(--fg); display: block;"><strong>2.</strong> The Data Flow</a>
                <a href="#sec-3" style="text-decoration: none; color: var(--fg); display: block;"><strong>3.</strong> The Database Layer</a>
                <a href="#sec-4" style="text-decoration: none; color: var(--fg); display: block;"><strong>4.</strong> The Backend Architecture</a>
                <a href="#sec-5" style="text-decoration: none; color: var(--fg); display: block;"><strong>5.</strong> The Frontend</a>
                <a href="#sec-6" style="text-decoration: none; color: var(--fg); display: block;"><strong>6.</strong> The Submodules</a>
                <a href="#sec-6-1" style="text-decoration: none; color: #555; display: block; padding-left: 16px;">6.1 Projeksiyon (Stock Projection)</a>
                <a href="#sec-6-2" style="text-decoration: none; color: #555; display: block; padding-left: 16px;">6.2 Hammadde Stok (Raw Material Stock)</a>
                <a href="#sec-6-3" style="text-decoration: none; color: #555; display: block; padding-left: 16px;">6.3 &Uuml;r&uuml;n Stok (Product Stock)</a>
                <a href="#sec-7" style="text-decoration: none; color: var(--fg); display: block;"><strong>7.</strong> Conclusion</a>
            </div>
        </div>

        <!-- ============================================ -->
        <h2 id="sec-1">1. WHAT STOCK &amp; INVENTORY DOES</h2>
        <!-- ============================================ -->

        <p>The Stock &amp; Inventory module answers the two most fundamental questions in any manufacturing operation:</p>

        <ol>
            <li><strong>&ldquo;What do we have right now?&rdquo;</strong> &mdash; Answered by &Uuml;r&uuml;n Stok (finished/semi-finished goods) and Hammadde Stok (raw materials). These pages show the live, physical state of the factory&rsquo;s inventory at t=0. Every basket of drawn copper wire (X-coded), every reel of tinned wire (Y-coded), every kilogram of raw plastic &mdash; all visible with real-time weights, statuses, allocations, and full production traceability.</li>
            <li><strong>&ldquo;What will we have in the future?&rdquo;</strong> &mdash; Answered by Projeksiyon (Stock Projection). This page shows a week-by-week forecast across 8 material categories (copper, tin, plastic, catalyst, dye, antirodent, reels, palettes), calculating how much material will be consumed by planned work cards (MINUS) versus how much is arriving through purchase orders (PLUS), producing a running cumulative balance that reveals shortages weeks before they become critical.</li>
        </ol>

        <p>These two systems run on <strong>fundamentally different data sources</strong>:</p>

        <table>
            <tr><th>Aspect</th><th>Live Inventory (&Uuml;r&uuml;n + Hammadde Stok)</th><th>Projection (Projeksiyon)</th></tr>
            <tr><td><strong>Data source</strong></td><td><code>half_product_stock</code> table + <code>materials</code> table</td><td><code>work_cards</code> (MINUS) + <code>material_orders</code> (PLUS)</td></tr>
            <tr><td><strong>Time axis</strong></td><td>Now (t=0)</td><td>Weeks into the future (H01&ndash;H52+)</td></tr>
            <tr><td><strong>Changes when</strong></td><td>Production records output, materials consumed/received</td><td>Plan changes: work card created/modified/cancelled, material order delivered (switches to actual date &amp; quantity), order date/qty changed, order cancelled</td></tr>
            <tr><td><strong>Does NOT change when</strong></td><td>&mdash;</td><td>Production physically completes (completed work cards still counted in plan)</td></tr>
            <tr><td><strong>CRUD</strong></td><td>Full (view, edit weight/status, delete)</td><td>Read-only (projection is calculated, not edited)</td></tr>
        </table>

        <div class="insight">
            <p style="margin-bottom: 0;"><strong>The double-check mechanism:</strong> If Projeksiyon shows a copper surplus for week H15, but Hammadde Stok shows copper running low <em>now</em>, something is wrong &mdash; perhaps a material order was recorded but the physical delivery didn&rsquo;t happen. Conversely, if Hammadde Stok shows plenty of plastic but Projeksiyon projects a shortage in H20, it means current stock will be depleted by upcoming production. Neither system alone tells the complete story; together they form a comprehensive material visibility layer.</p>
        </div>

        <!-- ============================================ -->
        <h2 id="sec-2">2. THE DATA FLOW</h2>
        <!-- ============================================ -->

        <h3>2.1 Projeksiyon Data Flow</h3>
        <p>Projeksiyon computes its weekly forecast from two independent data sources, combined in the <code>ProjeksiyonService</code> (804 lines):</p>

        <div class="flow">
            <span class="flow-step">Work Cards (sevkiyat_week)</span>
            <span class="flow-arrow">&rarr;</span>
            <span class="flow-step">material_details JSON</span>
            <span class="flow-arrow">&rarr;</span>
            <span class="flow-step">MINUS per week per material</span>
        </div>
        <div class="flow">
            <span class="flow-step">Material Orders (expected_date)</span>
            <span class="flow-arrow">&rarr;</span>
            <span class="flow-step">quantity + material_type</span>
            <span class="flow-arrow">&rarr;</span>
            <span class="flow-step">PLUS per week per material</span>
        </div>
        <div class="flow">
            <span class="flow-step">PLUS &minus; MINUS</span>
            <span class="flow-arrow">&rarr;</span>
            <span class="flow-step">Weekly change</span>
            <span class="flow-arrow">&rarr;</span>
            <span class="flow-step">Running cumulative</span>
            <span class="flow-arrow">&rarr;</span>
            <span class="flow-step">Shortage detection</span>
        </div>

        <h4>MINUS Side: Work Card Material Requirements</h4>
        <p>Each work card carries a <code>material_details</code> JSON that specifies exactly what raw materials it will consume. The service maps machine types to material categories:</p>
        <table>
            <tr><th>Machine Type</th><th>Material Extracted</th><th>JSON Path</th></tr>
            <tr><td>Kabatel &Ccedil;ekme</td><td>Copper (kg)</td><td><code>material_details.copper_kg</code></td></tr>
            <tr><td>Kalaylama</td><td>Tin (kg)</td><td><code>material_details.tin_kg</code></td></tr>
            <tr><td>Extruder</td><td>Plastic, Catalyst, Dye, Antirodent (kg)</td><td><code>quantities.*</code>, <code>insulation_materials[]</code>, <code>sheath_materials[]</code></td></tr>
            <tr><td>Aktarma</td><td>Reels (adet)</td><td><code>makara_distributions[].count</code></td></tr>
            <tr><td>Paletleme</td><td>Palettes (adet)</td><td><code>palettes[].quantity</code></td></tr>
        </table>

        <p>All work cards except <code>CANCELLED</code> are included &mdash; even completed ones, because Projeksiyon tracks the full plan history. On the incoming side, when an order is delivered, the service switches from <code>expected_date</code>/<code>quantity</code> to <code>delivered_date</code>/<code>delivered_quantity</code>, so the projection dynamically reflects actual delivery timing and amounts.</p>

        <h4>PLUS Side: Material Order Incoming</h4>
        <p>Each material order has a <code>material_type</code>, <code>quantity</code>, and <code>expected_date</code>. For delivered orders, the system uses <code>delivered_date</code> and <code>delivered_quantity</code> instead. Material names are resolved from the supplier&rsquo;s material catalog when available. All orders except <code>CANCELLED</code> are included.</p>

        <h4>Cumulative Calculation</h4>
        <p>The service generates all weeks from the <strong>earliest data point</strong> (which may be in a previous year) through the last visible week. It calculates <code>weekly = plus - minus</code> and maintains a running <code>cumulative</code> for each of the 8 material categories. For the user&rsquo;s view window (default 10 weeks), it also tracks <strong>sub-material cumulatives</strong> (e.g., individual plastic types like &ldquo;HFX 500P&rdquo; within the Plastic category) for hidden shortage detection.</p>

        <h3>2.2 Live Inventory Data Flow</h3>
        <p>The live inventory pages read directly from physical inventory tables:</p>

        <div class="flow">
            <span class="flow-step">Production records output</span>
            <span class="flow-arrow">&rarr;</span>
            <span class="flow-step">half_product_stock row created</span>
            <span class="flow-arrow">&rarr;</span>
            <span class="flow-step">&Uuml;r&uuml;n Stok shows it</span>
        </div>
        <div class="flow">
            <span class="flow-step">Material entry form</span>
            <span class="flow-arrow">&rarr;</span>
            <span class="flow-step">materials row created</span>
            <span class="flow-arrow">&rarr;</span>
            <span class="flow-step">Hammadde Stok shows it</span>
        </div>

        <p>&Uuml;r&uuml;n Stok fetches 7 parallel API calls (one per production step: Kabatel, Kalaylama, &Idot;ncetel, Buncher, Extruder, E-Beam, Aktarma), while Hammadde Stok fetches all materials in a single call and groups them client-side into 8 categories.</p>

        <!-- ============================================ -->
        <h2 id="sec-3">3. THE DATABASE LAYER</h2>
        <!-- ============================================ -->

        <p>The Stock module relies on two primary tables for live inventory, plus two external tables (from other modules) that feed the Projeksiyon calculation.</p>

        <h3>3.1 half_product_stock (20 columns) &mdash; Semi-Finished &amp; Finished Products</h3>
        <p>Every basket, reel, or coil produced by any machine is recorded here. Each entry has a deterministic QR code (X1 for Kabatel, Y1 for Kalaylama, Z1 for &Idot;ncetel, T1 for Buncher, U1 for Extruder, G1 for E-Beam).</p>

        <table>
            <tr><th>Column</th><th>Type</th><th>Details</th></tr>
            <tr><td><code>id</code></td><td>Integer PK</td><td>Auto-increment</td></tr>
            <tr><td><code>qr_code</code></td><td>String(50)</td><td>Unique, indexed. Deterministic: X1, X2, Y1, Y2, etc.</td></tr>
            <tr><td><code>product_code</code></td><td>String(100)</td><td>Indexed. e.g., KC_18 (Kabatel 1.8mm), KL_18 (Kalaylama 1.8mm)</td></tr>
            <tr><td><code>product_name</code></td><td>String(200)</td><td>Human-readable name</td></tr>
            <tr><td><code>production_step</code></td><td>String(50)</td><td>Indexed. Enum: kabatel_cekme, kalaylama, incetel, buncher, extruder, ebeam</td></tr>
            <tr><td><code>initial_weight_kg</code></td><td>Float</td><td>Weight when first produced</td></tr>
            <tr><td><code>remaining_weight_kg</code></td><td>Float</td><td>Current weight (decreases as material is consumed in next step)</td></tr>
            <tr><td><code>basket_number</code></td><td>Integer</td><td>Sequential within session</td></tr>
            <tr><td><code>allocation</code></td><td>String(20)</td><td><code>ORDER</code> (tied to a customer order) or <code>STOCK</code> (free inventory)</td></tr>
            <tr><td><code>order_id</code></td><td>Integer FK</td><td>References <code>orders.id</code> if allocation = ORDER</td></tr>
            <tr><td><code>status</code></td><td>String(50)</td><td>Indexed. Enum: available, in_use, consumed, reserved, shipped</td></tr>
            <tr><td><code>production_output_id</code></td><td>Integer FK</td><td>References <code>production_outputs.id</code>, indexed</td></tr>
            <tr><td><code>session_id</code></td><td>Integer FK</td><td>References <code>production_sessions.id</code></td></tr>
            <tr><td><code>work_card_id</code></td><td>Integer FK</td><td>References <code>work_cards.id</code></td></tr>
            <tr><td><code>source_qr_codes</code></td><td>Text</td><td>JSON array of input QR codes for full traceability (e.g., a Kalaylama Y1 consumed Kabatel X3 and X4)</td></tr>
            <tr><td><code>produced_at</code></td><td>DateTime</td><td>When produced</td></tr>
            <tr><td><code>consumed_at</code></td><td>DateTime</td><td>When fully consumed (nullable)</td></tr>
            <tr><td><code>created_at</code></td><td>DateTime</td><td>UTC</td></tr>
            <tr><td><code>updated_at</code></td><td>DateTime</td><td>Auto-updated</td></tr>
            <tr><td><code>notes</code></td><td>Text</td><td>Optional notes</td></tr>
        </table>

        <p><strong>Composite indexes:</strong> <code>(production_step, status)</code> for step-based filtering, <code>(product_code, status)</code> for product-based grouping. 4 foreign keys link to orders, production outputs, sessions, and work cards.</p>

        <h3>3.2 materials (from Hammadde module)</h3>
        <p>The raw material inventory table (documented in the Hammadde module). Hammadde Stok reads this table directly via <code>GET /api/materials/list</code>. Each row represents a physical lot of raw material with QR code, weight, supplier, lot number, and status. 8 material types: raw_copper, raw_tin, raw_plastic, raw_catalyst, raw_dye, raw_antirodent, raw_palette, raw_reel.</p>

        <h3>3.3 External Tables Feeding Projeksiyon</h3>

        <table>
            <tr><th>Table</th><th>Module</th><th>What Projeksiyon Reads</th></tr>
            <tr><td><code>work_cards</code></td><td>Production</td><td><code>sevkiyat_week</code> (delivery week), <code>machine_type</code>, <code>material_details</code> JSON, <code>status</code> (excludes CANCELLED)</td></tr>
            <tr><td><code>material_orders</code></td><td>Hammadde</td><td><code>material_type</code>, <code>quantity</code>, <code>expected_date</code>, <code>delivered_date</code>, <code>delivered_quantity</code>, <code>status</code> (excludes CANCELLED)</td></tr>
        </table>

        <div class="insight">
            <p style="margin-bottom: 0;"><strong>No dedicated &ldquo;projeksiyon&rdquo; table exists.</strong> The projection is computed on-the-fly from work cards and material orders. This is a deliberate design decision: since Projeksiyon reflects the plan (not a stored state), it always shows the latest version of the plan without requiring synchronization or cache invalidation. The trade-off is computational cost per request, but the query scope (hundreds of work cards and orders, not millions) makes this viable.</p>
        </div>

        <!-- ============================================ -->
        <h2 id="sec-4">4. THE BACKEND ARCHITECTURE</h2>
        <!-- ============================================ -->

        <h3>4.1 Route Files</h3>

        <table>
            <tr><th>File</th><th>Lines</th><th>Prefix</th><th>Endpoints</th><th>Purpose</th></tr>
            <tr><td><code>projeksiyon_routes.py</code></td><td>245</td><td><code>/api/projeksiyon</code></td><td>4</td><td>Stock projection: main data, summary, debug, per-material detail</td></tr>
            <tr><td><code>half_product_routes.py</code></td><td>327</td><td><code>/api/stock</code></td><td>6</td><td>Half-product CRUD: list, by-step, summary, by-QR, update, delete</td></tr>
            <tr><td><code>material_routes.py</code></td><td>(Hammadde)</td><td><code>/api/materials</code></td><td>~4</td><td>Raw material listing (shared with Hammadde module)</td></tr>
        </table>

        <h3>4.2 The Projeksiyon Service (804 lines)</h3>
        <p>The computational heart of the module. <code>ProjeksiyonService</code> orchestrates the entire projection calculation:</p>

        <table>
            <tr><th>Method</th><th>What It Does</th></tr>
            <tr><td><code>get_earliest_data_week_offset()</code></td><td>Scans both work cards and material orders to find the earliest week with data. Ensures cumulative calculations include data from previous years (e.g., 2025 orders still affect 2026 projection).</td></tr>
            <tr><td><code>get_requirements_by_week(weeks)</code></td><td>Reads ALL non-cancelled work cards, extracts material requirements per week per category. Maps 5 machine types to 8 material categories. Produces both aggregate totals and detailed breakdowns by specific material name. Consolidates duplicate material names per week.</td></tr>
            <tr><td><code>get_incoming_by_week(weeks)</code></td><td>Reads ALL non-cancelled material orders. For delivered orders, uses actual delivered date/quantity; for pending/shipped, uses expected date/quantity. Maps to the same 8 categories. Resolves specific material names from supplier catalog.</td></tr>
            <tr><td><code>get_projeksiyon(num_weeks, offset)</code></td><td>Master method. Generates week windows, fetches requirements and incoming for ALL weeks (not just view window), calculates running cumulative per category and per sub-material, captures pre-view cumulative state for frontend shortage detection, returns structured response.</td></tr>
        </table>

        <h3>4.3 API Contract &mdash; Projeksiyon Endpoints (4)</h3>

        <table>
            <tr><th>Method</th><th>Path</th><th>Parameters</th><th>What It Does</th></tr>
            <tr><td><code>GET</code></td><td><code>/api/projeksiyon</code></td><td><code>weeks</code> (4&ndash;52, default 10), <code>offset</code> (&minus;260 to +260)</td><td>Main endpoint. Returns weekly breakdown with PLUS/MINUS/cumulative per material, sub-material cumulatives, detail arrays for consumption and incoming, navigation info.</td></tr>
            <tr><td><code>GET</code></td><td><code>/api/projeksiyon/summary</code></td><td><code>weeks</code> (4&ndash;52, default 8)</td><td>Shortage alert endpoint. Scans all weeks for negative cumulatives, returns list of shortage events with material, week, and cumulative value.</td></tr>
            <tr><td><code>GET</code></td><td><code>/api/projeksiyon/material/{type}</code></td><td><code>type</code> (8 valid), <code>weeks</code></td><td>Per-material detail. Returns week-by-week data for a single material type with full plus/minus/cumulative. Includes plastic details for the plastic type.</td></tr>
            <tr><td><code>GET</code></td><td><code>/api/projeksiyon/debug</code></td><td>&mdash;</td><td>Debug endpoint. Shows unique sevkiyat_weeks in DB, cards per week, sample work cards with material_details keys, sample material orders.</td></tr>
        </table>

        <h3>4.4 API Contract &mdash; Half Product Endpoints (6)</h3>

        <table>
            <tr><th>Method</th><th>Path</th><th>What It Does</th></tr>
            <tr><td><code>GET</code></td><td><code>/api/stock/half-products</code></td><td>List all half products with optional <code>production_step</code> and <code>status</code> filters. Paginated (limit/offset).</td></tr>
            <tr><td><code>GET</code></td><td><code>/api/stock/half-products/by-step/{step}</code></td><td>Get items for a specific production step with operator name from session. Used by &Uuml;r&uuml;n Stok page (7 parallel calls).</td></tr>
            <tr><td><code>GET</code></td><td><code>/api/stock/half-products/summary</code></td><td>Aggregated counts and weights per step (available count, available kg, total count) for 6 production steps.</td></tr>
            <tr><td><code>GET</code></td><td><code>/api/stock/half-products/{qr_code}</code></td><td>Get single item by QR code.</td></tr>
            <tr><td><code>PUT</code></td><td><code>/api/stock/half-products/{id}</code></td><td>Update allowed fields: <code>remaining_weight_kg</code>, <code>status</code>, <code>notes</code>.</td></tr>
            <tr><td><code>DELETE</code></td><td><code>/api/stock/half-products/{id}</code></td><td>Hard delete. Also deletes linked <code>production_output</code> and decrements QR sequence if this was the last number.</td></tr>
        </table>

        <!-- ============================================ -->
        <h2 id="sec-5">5. THE FRONTEND</h2>
        <!-- ============================================ -->

        <h3>5.1 Page Structure</h3>

        <table>
            <tr><th>Route</th><th>Component</th><th>Lines</th><th>Purpose</th></tr>
            <tr><td><code>/stok/projeksiyon</code></td><td><code>Stok/Projeksiyon/index.tsx</code></td><td><strong>3,323</strong></td><td>One of the largest components in the ERP. Weekly forecast table with expandable sub-material columns + 3 chart types (Line, Heatmap, Radar). Material filtering, week navigation, hidden shortage detection.</td></tr>
            <tr><td><code>/stok/urun-stok</code></td><td><code>Stok/UrunStok/index.tsx</code></td><td>866</td><td>Semi-finished product inventory. 7 Collapse panels (one per production step), 3-level table hierarchy (step &rarr; product group &rarr; individual item), edit/delete, bonded test viewing.</td></tr>
            <tr><td><code>/stok/hammadde-stok</code></td><td><code>Stok/HammaddeStok/index.tsx</code></td><td>676</td><td>Raw material inventory. 8 Collapse panels (one per material type), 3-level table hierarchy (type &rarr; material name &rarr; individual lot), conditional weight coloring, edit/delete.</td></tr>
        </table>

        <p><strong>Total frontend:</strong> 4,865 lines across 3 pages. Projeksiyon alone accounts for 68% of the code.</p>

        <h3>5.2 Shared Patterns</h3>
        <ul>
            <li><strong>No WebSocket:</strong> All three pages use REST API polling or one-time fetches. No real-time subscriptions.</li>
            <li><strong>Turkish locale:</strong> All pages wrap in <code>ConfigProvider locale={trTR}</code> with <code>dayjs</code> timezone conversion to <code>Europe/Istanbul</code>.</li>
            <li><strong>No ProTable:</strong> Unlike other modules, the stock pages use plain Ant Design <code>Table</code> components (except HammaddeSiparis which is in the Hammadde module).</li>
            <li><strong>Client-side grouping:</strong> Both &Uuml;r&uuml;n Stok and Hammadde Stok fetch data and group it client-side (by product_code and material_name respectively).</li>
        </ul>

        <h3>5.3 Projeksiyon &mdash; Frontend Highlights</h3>
        <p>At 3,323 lines, Projeksiyon is one of the largest React components in the ERP. It has two tabs:</p>

        <p><strong>Tab 1 &mdash; Table View:</strong> A dynamic table with week rows and 8 material columns. Each material column shows incoming (green &uarr;), consumption (red &darr;), and cumulative balance (color-coded Tag). Columns are <strong>expandable</strong>: clicking a material header reveals individual sub-material columns (e.g., &ldquo;Filma&#351;in&rdquo; under Copper, &ldquo;HFX 500P&rdquo; under Plastic). Non-expanded materials collapse to 20px color bars with traffic-light indicators. Week navigation shifts the 10-week window via offset parameter. A summary row shows final cumulatives.</p>

        <p><strong>Tab 2 &mdash; Charts View:</strong> Three interchangeable chart types powered by <strong>ReactECharts</strong>:</p>
        <ol>
            <li><strong>Line Chart:</strong> Smooth cumulative lines with area fill. Overview mode (all materials) or detail mode (1&ndash;3 selected materials showing sub-material stacked bars + cumulative overlay).</li>
            <li><strong>Heatmap:</strong> Weeks (x) vs materials/sub-materials (y), colored red-to-green with per-material normalization. Custom HTML axis tooltips show shortage start/increase info.</li>
            <li><strong>Radar Chart:</strong> Merged mode (4 weeks overlapping) or individual mode (paginated spiders). Normalized 0&ndash;100 scale with 50 = zero line. Rich text labels colored by sign.</li>
        </ol>

        <p><strong>Hidden Shortage Detection:</strong> The most sophisticated feature. If the aggregate Copper cumulative is positive but the sub-material &ldquo;Filma&#351;in 8mm&rdquo; is negative, the cell gets a <span class="bad">red border</span> on a <span class="good">green background</span> with a warning tooltip. This appears across all three chart types.</p>

        <h3>5.4 &Uuml;r&uuml;n Stok &mdash; Frontend Highlights</h3>
        <p>7 Collapse panels (Kabatel, Kalaylama, &Idot;ncetel, Buncher, Extruder, E-Beam, Aktarma), each with a color-coded icon and 3 header stats (Total kg, Sipari&#351; kg, Serbest kg). Items grouped by product_code at level 2, individual QR-coded items at level 3. Features: edit modal (weight, allocation, notes), delete with confirmation, and a <strong>bonded test viewer</strong> that fetches test results from the Lab module for any item with a production_output_id.</p>

        <h3>5.5 Hammadde Stok &mdash; Frontend Highlights</h3>
        <p>8 Collapse panels (Bak&inodot;r, Kalay, Plastik, Kataliz&ouml;r, Boya, Antirodent, Palet, Makara). Structurally mirrors &Uuml;r&uuml;n Stok but for raw materials. Units adapt: kg for most materials, &ldquo;adet&rdquo; for palettes and reels. <strong>Conditional weight coloring:</strong> remaining weight shown in <span class="bad">red</span> below 20% of original, <span style="color: #ca8a04; font-weight: 700;">yellow</span> below 95% of original. Single API call fetches all materials; client-side grouping by <code>material_type</code>.</p>

        <h3>5.6 Permission System</h3>
        <table>
            <tr><th>Page</th><th>Route Guard</th><th>Manifest Buttons</th></tr>
            <tr><td>Projeksiyon</td><td><code>canStok</code></td><td><code>access_page</code>, <code>view_projections</code>, <code>create_projection</code>, <code>edit_projection</code></td></tr>
            <tr><td>&Uuml;r&uuml;n Stok</td><td><code>canStok</code></td><td><code>access_page</code>, <code>view_table</code>, <code>view_details</code>, <code>edit_stock</code>, <code>adjust_quantity</code></td></tr>
            <tr><td>Hammadde Stok</td><td><code>canStok</code></td><td><code>access_page</code>, <code>view_table</code>, <code>view_details</code>, <code>edit_stock</code>, <code>adjust_quantity</code></td></tr>
        </table>

        <p>All three pages share the <code>canStok</code> route guard from <code>access.ts</code>. Button-level permissions are defined in the manifest but not currently enforced in the page components &mdash; the route-level guard is the active access control.</p>

        <!-- ============================================ -->
        <h2 id="sec-6">6. THE SUBMODULES</h2>
        <!-- ============================================ -->

        <p>The Stock module has three submodules, ordered by complexity:</p>

        <div class="submod-card">
            <div class="submod-num">6.1</div>
            <div class="submod-body">
                <h4>Projeksiyon (Stock Projection)</h4>
                <p>Week-by-week forecast of material supply and demand. 804-line backend service + 3,323-line frontend &mdash; one of the largest React components in the ERP. Read-only: no CRUD, pure computation.</p>
                <div class="submod-tags">
                    <span class="submod-tag">3,323 LOC FRONTEND</span>
                    <span class="submod-tag">804 LOC SERVICE</span>
                    <span class="submod-tag">4 ENDPOINTS</span>
                    <span class="submod-tag">3 CHART TYPES</span>
                </div>
            </div>
        </div>

        <div class="submod-card">
            <div class="submod-num">6.2</div>
            <div class="submod-body">
                <h4>Hammadde Stok (Raw Material Stock)</h4>
                <p>Live inventory of all raw materials (copper, tin, plastic, catalyst, dye, antirodent, palette, reel). Reads from the Hammadde module&rsquo;s <code>materials</code> table. 8 collapse panels, conditional weight coloring, edit/delete.</p>
                <div class="submod-tags">
                    <span class="submod-tag">676 LOC FRONTEND</span>
                    <span class="submod-tag">8 MATERIAL CATEGORIES</span>
                    <span class="submod-tag">SHARED API</span>
                </div>
            </div>
        </div>

        <div class="submod-card">
            <div class="submod-num">6.3</div>
            <div class="submod-body">
                <h4>&Uuml;r&uuml;n Stok (Product Stock)</h4>
                <p>Live inventory of semi-finished and finished products across all production steps. 7 collapse panels organized by machine type, 3-level grouping, bonded test integration with Lab module.</p>
                <div class="submod-tags">
                    <span class="submod-tag">866 LOC FRONTEND</span>
                    <span class="submod-tag">6 ENDPOINTS</span>
                    <span class="submod-tag">7 PRODUCTION STEPS</span>
                    <span class="submod-tag">LAB INTEGRATION</span>
                </div>
            </div>
        </div>


        <!-- ============================================= -->
        <!--  6.1  PROJEKSÄ°YON (Stock Projection)          -->
        <!-- ============================================= -->

        <h2 id="sec-6-1">6.1 &mdash; Projeksiyon (Stock Projection)</h2>

        <h3>6.1.1 &mdash; Purpose and Business Context</h3>
        <p>Projeksiyon answers the most forward-looking question in the factory: <strong>&ldquo;Week by week, will we have enough of each raw material, or will we run short?&rdquo;</strong> It is a read-only, computed view that blends two data streams &mdash; material consumption from production plans (work cards) and material arrivals from purchase orders &mdash; into a single, navigable weekly forecast spanning up to 5 years in either direction.</p>
        <p>This is not a dashboard with pre-calculated snapshots. Every time the page loads, the backend queries ALL non-cancelled work cards and ALL non-cancelled material orders, computes a running cumulative balance across every week since the earliest data point, and returns the result for the user&rsquo;s 10-week view window. The projection is <strong>always fresh</strong> &mdash; no caching, no stored state, no stale data.</p>
        <p>The page serves two audiences: the <strong>purchasing team</strong> (who need to know when to order more material) and the <strong>production planners</strong> (who need to know if upcoming work cards will cause a shortage). At 3,323 lines of frontend code and 804 lines of backend service, it is one of the largest and most complex components in the Stock module.</p>

        <h3>6.1.2 &mdash; The Two Data Streams</h3>
        <p>Every piece of data in Projeksiyon comes from one of two sources:</p>

        <div class="arch-grid">
            <div class="arch-box" style="border-left: 4px solid #dc2626;">
                <h4>EKS&Idot; (MINUS) &mdash; Material Requirements</h4>
                <p><strong>Source:</strong> <code>work_cards</code> table (Production module)</p>
                <p><strong>Key field:</strong> <code>sevkiyat_week</code> (delivery week, e.g., &ldquo;2026-W12&rdquo;)</p>
                <p><strong>What it extracts:</strong> Each work card carries a <code>material_details</code> JSON. The service maps 5 machine types to 8 material categories:</p>
                <ul>
                    <li><code>kabatel_cekme</code> &rarr; <code>copper_kg</code> (Filma&#351;in)</li>
                    <li><code>kalaylama</code> &rarr; <code>tin_kg</code> (Kalay)</li>
                    <li><code>extruder</code> &rarr; plastic, catalyst, dye, antirodent (from <code>insulation_materials[]</code> and <code>sheath_materials[]</code>)</li>
                    <li><code>aktarma</code> &rarr; reels (from <code>makara_distributions[]</code>) &mdash; note: kangal (coilless) uses plastic packaging and is NOT tracked</li>
                    <li><code>paletleme</code> &rarr; palettes (from <code>palettes[]</code>)</li>
                </ul>
                <p><strong>Includes:</strong> ALL statuses except CANCELLED &mdash; even completed work cards count because the plan happened.</p>
            </div>

            <div class="arch-box" style="border-left: 4px solid #16a34a;">
                <h4>ARTI (PLUS) &mdash; Incoming Materials</h4>
                <p><strong>Source:</strong> <code>material_orders</code> table (Hammadde module)</p>
                <p><strong>Key field:</strong> <code>expected_date</code> or <code>delivered_date</code></p>
                <p><strong>Dynamic switching:</strong> For pending/shipped orders, uses <code>expected_date</code> + <code>quantity</code> (the plan). For delivered orders, switches to <code>delivered_date</code> + <code>delivered_quantity</code> (the actual). This means the projection dynamically reflects reality as deliveries happen.</p>
                <p><strong>Material resolution:</strong> The service resolves specific material names via the <code>supplier_material</code> relationship (e.g., not just &ldquo;plastic&rdquo; but &ldquo;HFX 500P&rdquo;). Defaults to category name if no supplier material linked.</p>
                <p><strong>Includes:</strong> ALL statuses except CANCELLED.</p>
            </div>
        </div>

        <h3>6.1.3 &mdash; The Cumulative Calculation Engine</h3>
        <p>The core of Projeksiyon lives in <code>ProjeksiyonService.get_projeksiyon()</code>. The calculation is not a simple &ldquo;show this week&rsquo;s plus and minus&rdquo; &mdash; it is a <strong>full historical running total</strong>:</p>

        <ol>
            <li><strong>Find earliest data:</strong> <code>get_earliest_data_week_offset()</code> scans both work cards (<code>MIN(sevkiyat_week)</code>) and material orders (<code>MIN(expected_date)</code>, <code>MIN(delivered_date)</code>) to find the very first week that has any data. This might be in a previous year (e.g., 2025 orders still affect 2026 projection).</li>
            <li><strong>Generate ALL weeks:</strong> From the earliest data week through the last week in the user&rsquo;s view (e.g., if earliest data is 2025-W40 and the user is viewing 2026-W05 to W14, the system generates weeks from W40 through W14 &mdash; 27 weeks of computation for a 10-week view).</li>
            <li><strong>Fetch requirements and incoming for ALL weeks:</strong> Two bulk queries: one for work cards grouped by <code>sevkiyat_week</code>, one for material orders mapped to their respective weeks.</li>
            <li><strong>Walk through every week in order:</strong> For each week, compute <code>weekly = plus - minus</code> per material category, and add it to the running <code>cumulative</code> total. Also track sub-material cumulatives (e.g., &ldquo;Filma&#351;in 8mm&rdquo; within Copper).</li>
            <li><strong>Capture pre-view state:</strong> Before processing the first week in the user&rsquo;s view window, snapshot the current cumulative state into <code>pre_view_sub_material_cumulatives</code>. This is critical for the frontend&rsquo;s hidden shortage detection.</li>
            <li><strong>Return only view weeks:</strong> Of all the weeks processed, only the 10 weeks the user is actually viewing are included in the response. But their cumulative values include ALL historical data.</li>
        </ol>

        <div class="warning">
            <p style="margin-bottom: 0;"><strong>Why not just compute the view window?</strong> If you only compute weeks 5&ndash;14 and a massive copper delivery happened in week 2, the cumulative for week 5 would show 0 instead of +5000 kg. Historical context is essential for accurate cumulative balances. The trade-off is more computation per request, but the data volume (hundreds of work cards and orders, not millions) makes this approach viable without caching.</p>
        </div>

        <h3>6.1.4 &mdash; Detail Consolidation</h3>
        <p>Both <code>get_requirements_by_week()</code> and <code>get_incoming_by_week()</code> produce not only aggregate totals per category but also <strong>detailed breakdowns by specific material name</strong>. For example, an Extruder work card might consume 200 kg of &ldquo;HFX 500P&rdquo; and 150 kg of &ldquo;HFFR 302&rdquo; &mdash; both are &ldquo;plastic&rdquo; but tracked individually.</p>
        <p>After processing all cards/orders, the service <strong>consolidates</strong> duplicate names within each week. If two Extruder cards in the same week both consume &ldquo;HFX 500P&rdquo;, their quantities are merged into a single detail entry. This consolidation runs across all 8 detail arrays (copper_details, tin_details, plastic_details, catalyst_details, dye_details, antirodent_details, makara_details, palette_details).</p>

        <h3>6.1.5 &mdash; API Endpoints</h3>
        <table>
            <tr><th>Method</th><th>Path</th><th>Parameters</th><th>Purpose</th></tr>
            <tr><td><code>GET</code></td><td><code>/api/projeksiyon</code></td><td><code>weeks</code> (4&ndash;52, default 10), <code>offset</code> (&minus;260 to +260)</td><td>Main endpoint. Returns weekly breakdown with PLUS/MINUS/cumulative per material category, sub-material cumulatives per week, requirement and incoming detail arrays, work card and order counts, navigation metadata, and pre-view sub-material cumulatives for shortage detection.</td></tr>
            <tr><td><code>GET</code></td><td><code>/api/projeksiyon/summary</code></td><td><code>weeks</code> (4&ndash;52, default 8)</td><td>Shortage alert endpoint. Scans all weeks for any material category with a negative cumulative, returns a flat list of shortage events with material key, label, week, cumulative value, and unit.</td></tr>
            <tr><td><code>GET</code></td><td><code>/api/projeksiyon/material/{type}</code></td><td><code>type</code> (8 valid types), <code>weeks</code></td><td>Per-material detail. Returns week-by-week plus/minus/cumulative for a single material type. Includes plastic_details breakdown for the plastic type.</td></tr>
            <tr><td><code>GET</code></td><td><code>/api/projeksiyon/debug</code></td><td>&mdash;</td><td>Debug endpoint. Shows unique <code>sevkiyat_week</code> values in the database, card counts per week, sample work cards with their <code>material_details</code> keys, and sample material orders. Used during development to verify data mapping.</td></tr>
        </table>

        <h3>6.1.6 &mdash; Frontend Architecture (3,323 Lines)</h3>
        <p>The Projeksiyon page is a single React component with two tabs: <strong>Projeksiyon</strong> (table view) and <strong>Grafikler</strong> (charts view). Both tabs consume the same API response.</p>

        <h4>State Management</h4>
        <table>
            <tr><th>State Variable</th><th>Type</th><th>Purpose</th></tr>
            <tr><td><code>projeksiyonData</code></td><td><code>ProjeksiyonResponse | null</code></td><td>The entire API response, shared between both tabs</td></tr>
            <tr><td><code>weekOffset</code></td><td><code>number</code></td><td>Current week offset from H01. Changed by navigation arrows. Triggers API refetch.</td></tr>
            <tr><td><code>expandedMaterials</code></td><td><code>string[]</code></td><td>Which material columns are currently expanded to show sub-materials</td></tr>
            <tr><td><code>knownSubMaterials</code></td><td><code>Record&lt;string, string[]&gt;</code></td><td>Persists discovered sub-material names across navigations so expand arrows don&rsquo;t disappear</td></tr>
            <tr><td><code>graphType</code></td><td><code>'line' | 'heatmap' | 'waterfall'</code></td><td>Active chart type (waterfall is actually radar)</td></tr>
            <tr><td><code>selectedGraphMaterials</code></td><td><code>string[]</code></td><td>Material filter for charts. Empty = &ldquo;T&uuml;m&uuml;&rdquo; (all). 1&ndash;3 = detail mode with sub-material breakdown.</td></tr>
            <tr><td><code>radarViewMode</code></td><td><code>'merged' | 'individual'</code></td><td>Radar chart display mode: 4 weeks overlapping vs. paginated individual spiders</td></tr>
            <tr><td><code>radarPage</code></td><td><code>number</code></td><td>Current page for individual radar mode pagination</td></tr>
            <tr><td><code>activeTab</code></td><td><code>'projeksiyon' | 'grafikler'</code></td><td>Current tab</td></tr>
        </table>

        <h3>6.1.7 &mdash; Tab 1: The Projection Table</h3>
        <p>The table is the primary interface. It displays 10 weeks as rows and 8 material categories as columns. The table is NOT an Ant Design <code>ProTable</code> &mdash; it is a plain <code>Table</code> with heavily customized column rendering.</p>

        <h4>Column Structure</h4>
        <p>Each material column renders three pieces of information per cell:</p>
        <ul>
            <li><strong>Incoming (PLUS):</strong> Green upward arrow with the amount of material arriving that week</li>
            <li><strong>Consumption (MINUS):</strong> Red downward arrow with the amount of material being consumed</li>
            <li><strong>Cumulative:</strong> A color-coded <code>Tag</code> showing the running total. Green if positive (surplus), red if negative (shortage), grey if zero.</li>
        </ul>

        <h4>Expandable Sub-Material Columns</h4>
        <p>This is one of the most distinctive features. Each material column header has a small expand arrow. Clicking it reveals <strong>individual sub-material columns</strong> nested under the parent. For example, expanding &ldquo;Plastik&rdquo; might reveal columns for &ldquo;HFX 500P&rdquo;, &ldquo;HFFR 302&rdquo;, and &ldquo;XLPE&rdquo; &mdash; each showing their own plus/minus/cumulative within that week.</p>
        <p>Sub-material names are discovered from the API response&rsquo;s detail arrays and persisted in <code>knownSubMaterials</code> so they survive week navigation. When a column is NOT expanded, it collapses to a <strong>20px-wide color bar</strong> with a traffic-light indicator (green dot = all positive, red dot = any negative cumulative, yellow dot = mixed). This compact view lets users see all 8 materials at once without horizontal scrolling.</p>

        <h4>Week Navigation</h4>
        <p>Left/right arrows shift the 10-week window by 10 weeks at a time (via <code>weekOffset</code> state). A calendar icon resets to the current week (<code>offset = 0</code>). The API enforces limits of &minus;260 to +260 (5 years each direction). Each navigation triggers a new API call; the backend recalculates from scratch.</p>

        <h4>Summary Row</h4>
        <p>The last row of the table shows the final cumulative for each material across the entire view window. It serves as the &ldquo;bottom line&rdquo; &mdash; after all incoming and consumption for these 10 weeks, this is where each material stands.</p>

        <h3>6.1.8 &mdash; Hidden Shortage Detection</h3>
        <p>This is the most sophisticated feature in the entire Stock module. The problem it solves:</p>

        <div class="finding">
            <p><strong>Scenario:</strong> The aggregate &ldquo;Plastic&rdquo; cumulative for week H12 is <span class="good">+2,500 kg</span>. Everything looks fine. But hidden inside, sub-material &ldquo;HFX 500P&rdquo; is at <span class="bad">&minus;180 kg</span> while &ldquo;HFFR 302&rdquo; has <span class="good">+2,680 kg</span>. The surplus of one plastic masks the shortage of another. You cannot substitute HFFR for HFX &mdash; they are chemically different compounds.</p>
        </div>

        <p><strong>How it works:</strong></p>
        <ol>
            <li>The backend tracks <code>sub_material_cumulatives</code> as a dictionary keyed by <code>category_materialName</code> (e.g., <code>plastic_HFX 500P</code>). This is updated for EVERY week (not just the view window).</li>
            <li>Each week in the response carries its own <code>sub_material_cumulatives</code> snapshot.</li>
            <li>The frontend checks: if the parent category cumulative is &ge; 0 but ANY sub-material within that category has a negative cumulative, this is a <strong>hidden shortage</strong>.</li>
            <li>Visual indicator: the cell gets a <span class="bad">red border</span> on a <span class="good">green background</span> with a warning tooltip listing which specific sub-materials are in deficit.</li>
        </ol>
        <p>This detection works across all three visualization modes (table, line chart, heatmap, radar). In the radar chart, hidden shortages are indicated by a special rich-text label style that combines green text with a red indicator.</p>

        <h3>6.1.9 &mdash; Tab 2: Charts View</h3>
        <p>The charts tab provides three interchangeable visualization types, all powered by <strong>ReactECharts</strong> (<code>echarts-for-react</code>). All share the same data from <code>projeksiyonData</code> and respond to the same week navigation and material filter controls.</p>

        <h4>Material Filter Pills</h4>
        <p>A row of clickable pills at the top allows filtering by material. Three modes:</p>
        <ul>
            <li><strong>T&uuml;m&uuml; (All):</strong> No filter selected. Charts show aggregate cumulative lines for all materials. No sub-material breakdown.</li>
            <li><strong>1&ndash;3 materials selected (Detail Mode):</strong> Charts switch to showing sub-material stacked bars for consumption and incoming, with cumulative overlay lines per sub-material. This is where the hidden shortage detection becomes most visible.</li>
            <li><strong>4+ materials:</strong> Not allowed. The UI enforces a maximum of 3 selections by deselecting the oldest when a 4th is clicked. This prevents chart overcrowding.</li>
        </ul>

        <h4>Chart Type 1: Line Chart</h4>
        <p>Smooth cumulative lines with gradient area fill. In overview mode, each material gets its own line (copper=orange, tin=cyan, plastic=purple, etc.). A dashed red zero-line marks the shortage threshold. In detail mode, sub-materials get stacked bar charts for consumption (negative, red) and incoming (positive, green), with individual cumulative overlay lines.</p>
        <p>The tooltip is extensively customized: it shows the week label, date range, sections for &ldquo;K&Uuml;M&Uuml;LAT&Idot;F&rdquo; (cumulative), &ldquo;KULLANILAN (Bu Hafta)&rdquo; (consumption), &ldquo;&Idot;HT&Idot;YA&Ccedil; (Eksik)&rdquo; (shortages), and &ldquo;GELEN (Bu Hafta)&rdquo; (incoming). Shortages use a 2-column grid layout when there are more than 6 items.</p>

        <h4>Chart Type 2: Heatmap</h4>
        <p>A grid with weeks on the x-axis and materials/sub-materials on the y-axis. Each cell is colored on a red-to-green gradient based on cumulative value. The coloring uses <strong>per-material normalization</strong> &mdash; each material row is normalized independently so a +5000 kg copper surplus and a +50 adet palette surplus both appear equally green.</p>
        <p>Custom HTML axis tooltips appear on hover over material labels. These tooltips show detailed shortage information: which weeks this material first goes negative, whether the shortage is increasing or decreasing, and which specific sub-materials are affected. Shortage information is pre-calculated and stored in <code>heatmapShortageInfoRef</code> for efficient event handling.</p>

        <h4>Chart Type 3: Radar Chart</h4>
        <p>Operates in two modes:</p>
        <ul>
            <li><strong>Merged mode:</strong> Last 4 weeks overlapping on a single radar. Each week gets a different color (grey, amber, purple, cyan). Materials are positioned around the perimeter with rich-text labels showing the material name and cumulative value, colored green/red by sign. A dashed circle at the 50 mark represents the zero line (scale is normalized 0&ndash;100).</li>
            <li><strong>Individual mode:</strong> Paginated display showing 4 weeks per page as separate spider diagrams side by side. Each has its own radar with the week label below. Left/right arrows paginate through weeks.</li>
        </ul>
        <p>In both modes, hidden shortages are visualized using a special label format: the material name appears with an amber/warning color and the value shows green with a red warning indicator.</p>

        <h3>6.1.10 &mdash; Dashboard Statistics Cards</h3>
        <p>Above the charts, 4 statistic cards provide a quick summary:</p>
        <ul>
            <li><strong>Toplam Gelen (Total Incoming):</strong> Sum of all PLUS across all materials and weeks</li>
            <li><strong>Toplam &Idot;htiya&ccedil; (Total Consumption):</strong> Sum of all MINUS across all materials and weeks</li>
            <li><strong>Net Bakiye (Net Balance):</strong> Total incoming minus total consumption. Green if positive, red if negative.</li>
            <li><strong>Stok Sa&gbreve;l&inodot;&gbreve;&inodot; (Health Score):</strong> A percentage calculated as <code>(totalPlus / totalMinus) &times; 50</code>, capped at 0&ndash;100. Rendered as a Progress bar. Below 50% = red, 50&ndash;80% = yellow, above 80% = green.</li>
        </ul>

        <h3>6.1.11 &mdash; Extruder Material Extraction Logic</h3>
        <p>The most complex material mapping is for Extruder work cards. A single Extruder card can consume multiple materials simultaneously because cable extrusion involves layered coatings:</p>

        <ol>
            <li><strong>Insulation materials</strong> (<code>insulation_materials[]</code>): Each entry has <code>material_name</code> (plastic type), <code>plastic_kg</code>, <code>catalyst_name</code>, <code>catalyst_kg</code>, and <code>dyes[]</code> array with <code>dye_name</code> and <code>dye_kg</code>.</li>
            <li><strong>Sheath materials</strong> (<code>sheath_materials[]</code>): Same structure as insulation but also includes <code>antirodent_name</code> and <code>antirodent_kg</code> (only the outer sheath can have rodent repellent).</li>
        </ol>
        <p>The service walks through both arrays, extracting individual material names and quantities. This means a single Extruder work card can produce detail entries for 3&ndash;4 different plastics, 2 catalysts, 2 dyes, and 1 antirodent &mdash; all mapped to their respective category detail arrays and consolidated if the same material name appears in multiple cards for the same week.</p>

        <h3>6.1.12 &mdash; Week Key System</h3>
        <p>All temporal data in Projeksiyon uses ISO week keys in the format <code>YYYY-WNN</code> (e.g., &ldquo;2026-W12&rdquo;). The service provides utility functions:</p>
        <ul>
            <li><code>get_week_key(date)</code>: Converts a Python <code>date</code> to its ISO week key</li>
            <li><code>week_key_to_offset(week_key)</code>: Converts a week key to an integer offset from H01 of the current year. Used to compare weeks across year boundaries (e.g., 2025-W52 = offset &minus;1 from 2026-W01).</li>
            <li><code>generate_weeks(num_weeks, offset)</code>: Produces week metadata including week_key, week_label (H01&ndash;H52), date range in Turkish (e.g., &ldquo;06-12 Oca&rdquo;), and ISO start/end dates.</li>
        </ul>
        <p>The week labels displayed in the UI use <code>HNN</code> format (e.g., H01, H12, H52) with Turkish month abbreviations in the date range (Oca, &#350;ub, Mar, Nis, May, Haz, Tem, A&#287;u, Eyl, Eki, Kas, Ara).</p>

        <h3>6.1.13 &mdash; What Changes the Projection</h3>
        <p>Since the projection is computed on-the-fly, any change to its source data immediately affects the output:</p>
        <table>
            <tr><th>Action</th><th>Effect on Projection</th></tr>
            <tr><td>New work card created</td><td>MINUS increases for the card&rsquo;s <code>sevkiyat_week</code></td></tr>
            <tr><td>Work card&rsquo;s <code>sevkiyat_week</code> changed</td><td>MINUS moves from old week to new week</td></tr>
            <tr><td>Work card cancelled</td><td>MINUS disappears (CANCELLED excluded from query)</td></tr>
            <tr><td>New material order created</td><td>PLUS appears in the <code>expected_date</code> week</td></tr>
            <tr><td>Material order&rsquo;s expected date changed</td><td>PLUS moves from old week to new week</td></tr>
            <tr><td>Material order quantity changed</td><td>PLUS amount changes for that week</td></tr>
            <tr><td>Material order delivered</td><td>PLUS switches from <code>expected_date</code>/<code>quantity</code> to <code>delivered_date</code>/<code>delivered_quantity</code> &mdash; week and amount may both shift</td></tr>
            <tr><td>Material order cancelled</td><td>PLUS disappears entirely</td></tr>
            <tr><td>Production physically completes</td><td><strong>No effect</strong> &mdash; completed work cards are still included</td></tr>
        </table>

        <h3>6.1.14 &mdash; Permission Model</h3>
        <p>Projeksiyon uses the <code>canStok</code> route guard from <code>access.ts</code>. The permission manifest defines 4 buttons: <code>access_page</code>, <code>view_projections</code>, <code>create_projection</code>, <code>edit_projection</code>. However, since Projeksiyon is entirely read-only (no CRUD operations), the create and edit permissions are vestigial &mdash; there is nothing to create or edit. The effective access control is simply whether the user can access the Stock pages.</p>

        <h3>6.1.15 &mdash; What This Submodule Does NOT Do</h3>
        <ul>
            <li>It does <strong>not</strong> store any data &mdash; no dedicated database table exists</li>
            <li>It does <strong>not</strong> support CRUD &mdash; the projection is computed, not edited</li>
            <li>It does <strong>not</strong> use WebSocket &mdash; data is fetched once per page load or navigation</li>
            <li>It does <strong>not</strong> cache results &mdash; every request computes from scratch</li>
            <li>It does <strong>not</strong> account for current physical stock &mdash; it only tracks planned consumption vs. planned/actual arrivals</li>
            <li>It does <strong>not</strong> send alerts &mdash; shortage detection is visual only (the <code>/summary</code> endpoint exists but is not consumed by any notification system)</li>
            <li>It does <strong>not</strong> track kangal (coilless cable packaging) &mdash; kangal uses plastic packaging which is not a tracked raw material</li>
        </ul>

        <div class="insight">
            <p style="margin-bottom: 0;"><strong>The design philosophy:</strong> Projeksiyon deliberately avoids storing its own state. By computing everything on-the-fly from work cards and material orders, it guarantees that the projection always reflects the absolute latest version of the plan. There is no synchronization problem, no stale cache, no &ldquo;last refreshed 2 hours ago&rdquo; warning. The price is computation per request, but the data scale (hundreds of records, not millions) makes this a good trade-off. If the factory grows to tens of thousands of work cards, a materialized view or caching layer can be added without changing the API contract.</p>
        </div>


        <!-- ============================================= -->
        <!--  6.2  HAMMADDE STOK (Raw Material Stock)       -->
        <!-- ============================================= -->

        <h2 id="sec-6-2">6.2 &mdash; Hammadde Stok (Raw Material Stock)</h2>

        <h3>6.2.1 &mdash; Purpose and Business Context</h3>
        <p>Hammadde Stok answers the question <strong>&ldquo;What raw materials do we physically have in the warehouse right now, and how much of each is still available?&rdquo;</strong></p>
        <p>This page exists because of a specific business need: the Hammadde module already has <strong>Hammaddeler Listesi</strong> (Materials List) &mdash; a flat, 14-column admin table that shows every individual material record with photos, WebSocket real-time updates, bilingual search, and granular edit forms. But Hammaddeler Listesi is a <em>record-level</em> view. A stock manager doesn&rsquo;t want to scroll through 500 individual QR-coded entries to answer &ldquo;how many kilograms of HFX 500P plastic do we have?&rdquo; They need an <em>aggregated category-level</em> view that groups materials by type and name, shows totals, and highlights what&rsquo;s available vs. what&rsquo;s in use.</p>
        <p>The data that populates this page comes from two upstream flows:</p>
        <ul>
            <li><strong>Hammadde Giri&#351;i (Material Entry)</strong> creates the records &mdash; every time raw material arrives at the factory, an operator scans it through one of four entry archetypes (copper, tin, lot-based, count-based), and it enters the <code>materials</code> table with <code>status = 'received'</code> and <code>remaining_weight = weight</code>.</li>
            <li><strong>&Uuml;retim (Production)</strong> consumes the records &mdash; when Production modules (especially Kabatel &Ccedil;ekme / wire drawing) use a raw material, they select it by QR code and deduct from its <code>remaining_weight</code>. A 1,000 kg copper rod (A1) that goes through wire drawing comes back as 980 kg. Production also changes <code>status</code>: <code>received</code> &rarr; <code>in_use</code> (material is currently on a machine) &rarr; <code>consumed</code> (fully depleted). This is exactly what the &ldquo;Kalan&rdquo; (Remaining) column and the conditional coloring (yellow/red) are designed to show.</li>
        </ul>
        <p>So Hammadde Stok sits at the intersection: Hammadde Giri&#351;i fills it, Production drains it, and this page visualizes the current balance. It reads directly from the <code>materials</code> table (owned by the Hammadde module) via the shared <code>/api/materials/list</code> endpoint &mdash; it has no backend routes of its own. All grouping and aggregation happens client-side.</p>
        <p>The page is implemented as a single React component (<code>HammaddeStok</code>) in <code>src/pages/Stok/HammaddeStok/index.tsx</code> (676 lines), using Ant Design&rsquo;s <code>Collapse</code> with nested <code>Table</code> components, wrapped in a <code>ConfigProvider</code> with Turkish locale (<code>trTR</code>).</p>

        <h3>6.2.2 &mdash; CRUD Flow</h3>

        <p><strong>Read (Primary Operation):</strong></p>
        <ol>
            <li>Page loads &rarr; <code>useEffect([], [])</code> triggers <code>fetchMaterials()</code> on mount</li>
            <li>Single <code>GET /api/materials/list</code> call fetches ALL raw materials as a flat array, regardless of type</li>
            <li>Response passes through <code>processAndGroupMaterials()</code> which: filters by <code>material_type</code> into 8 buckets, groups within each bucket by <code>material_name</code>, calculates aggregate totals (total, reserved, available), and stores everything in the <code>sectionData</code> state object</li>
            <li>User clicks a Collapse panel to see the grouped table for that category</li>
            <li>User clicks the expand arrow on a group row to see individual lots with QR codes, weights, supplier, dates, and status</li>
            <li>User can click the &ldquo;Yenile&rdquo; (Refresh) button in the page header to re-fetch all data at any time</li>
        </ol>

        <p><strong>Update (Edit Modal):</strong></p>
        <ol>
            <li>Click the <code>EditOutlined</code> icon on any individual item row (Level 3)</li>
            <li>Modal opens with title &ldquo;D&uuml;zenle: {QR_CODE}&rdquo; (e.g., &ldquo;D&uuml;zenle: A7&rdquo;)</li>
            <li>Form pre-fills from the selected item&rsquo;s current values via <code>form.setFieldsValue()</code></li>
            <li>Two fields available (see 6.2.10 for full details):
                <ul>
                    <li><code>remaining_weight</code> &mdash; <code>InputNumber</code>, min=0, step=0.1. <strong>Hidden</strong> for palette/reel types</li>
                    <li><code>status</code> &mdash; <code>Select</code> dropdown with 5 options</li>
                </ul>
            </li>
            <li>On submit: <code>PUT /api/materials/update/{id}</code> with the form values</li>
            <li>On success: <code>message.success('G&uuml;ncellendi')</code> &rarr; modal closes &rarr; form resets &rarr; <code>fetchMaterials()</code> refetches all data</li>
            <li>On failure: <code>message.error('G&uuml;ncellenemedi')</code></li>
        </ol>

        <p><strong>Delete (Hard Delete with Confirmation):</strong></p>
        <ol>
            <li>Click the <code>DeleteOutlined</code> icon (styled with <code>color: '#ff4d4f'</code>) on any individual item row</li>
            <li><code>Modal.confirm()</code> opens with title &ldquo;Silme Onay&#305;&rdquo;, content &ldquo;{QR_CODE} kodlu malzemeyi silmek istedi&#287;inize emin misiniz?&rdquo;, a red &ldquo;Sil&rdquo; (Delete) button, and an &ldquo;&#304;ptal&rdquo; (Cancel) button</li>
            <li>On confirm: <code>DELETE /api/materials/{id}/hard-delete</code> &mdash; this is a <strong>permanent, irreversible</strong> deletion. The material record and all associated <code>material_photos</code> records are removed from the database</li>
            <li>On success: <code>message.success('Silindi')</code> &rarr; <code>fetchMaterials()</code> refetches</li>
            <li>On failure: <code>message.error('Silinemedi')</code></li>
        </ol>

        <p><strong>Create:</strong> Not available on this page. Material creation happens exclusively through the Hammadde Giri&#351;i (Material Entry) page in the Hammadde module. This page only provides read, update, and delete operations.</p>

        <h3>6.2.3 &mdash; Data Source and API</h3>
        <p>Hammadde Stok consumes three API endpoints, all owned by the Hammadde module (<code>material_routes.py</code>), not the Stock module:</p>
        <table style="width: 100%; border-collapse: collapse; margin: 16px 0;">
            <thead>
                <tr style="background: var(--bg-secondary);">
                    <th style="padding: 8px; text-align: left; border-bottom: 2px solid var(--border-color);">Method</th>
                    <th style="padding: 8px; text-align: left; border-bottom: 2px solid var(--border-color);">Path</th>
                    <th style="padding: 8px; text-align: left; border-bottom: 2px solid var(--border-color);">What It Returns</th>
                </tr>
            </thead>
            <tbody>
                <tr><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);"><code>GET</code></td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);"><code>/api/materials/list</code></td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">ALL raw materials as a flat JSON array. Each object includes: <code>id</code>, <code>qr_code</code>, <code>material_type</code>, <code>material_name</code>, <code>supplier_name</code>, <code>lot_number</code>, <code>weight</code> (original measured weight at entry), <code>remaining_weight</code> (current weight after production consumption), <code>form_weight</code> (supplier&rsquo;s declared weight), <code>quantity</code> (label count for lot-based materials), <code>received_date</code> (ISO datetime), <code>status</code> (string: received/available/in_use/consumed/rejected)</td></tr>
                <tr><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);"><code>PUT</code></td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);"><code>/api/materials/update/{id}</code></td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Updates <code>remaining_weight</code> and/or <code>status</code> on a single material record. Called from the edit modal.</td></tr>
                <tr><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);"><code>DELETE</code></td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);"><code>/api/materials/{id}/hard-delete</code></td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Permanently removes the material and its associated photos from the database. Called from the delete confirmation modal.</td></tr>
            </tbody>
        </table>
        <p>The API response is a flat array &mdash; no server-side grouping, filtering, or pagination. The frontend receives every material regardless of type and handles all grouping logic client-side. This means the entire raw material inventory loads in a single request.</p>

        <h3>6.2.4 &mdash; State Management Architecture</h3>
        <p>The component manages 5 pieces of state:</p>
        <ul>
            <li><strong><code>allMaterials</code></strong> (<code>RawMaterial[]</code>) &mdash; the raw API response, stored for potential re-processing</li>
            <li><strong><code>loading</code></strong> (<code>boolean</code>) &mdash; true during the <code>fetchMaterials()</code> call, drives the &ldquo;Yenile&rdquo; button spinner and the loading indicator inside each panel</li>
            <li><strong><code>sectionData</code></strong> (<code>Record&lt;string, SectionData&gt;</code>) &mdash; the core data structure, keyed by material type. Each entry holds: <code>groups</code> (array of <code>MaterialGroupSummary</code>), <code>loading</code>, <code>expandedKeys</code> (which group rows are expanded), and <code>totalItems</code> (count of individual materials in this category). Initialized with all 8 category keys and empty defaults.</li>
            <li><strong><code>activePanels</code></strong> (<code>string[]</code>) &mdash; which Collapse panels are open. Passed to <code>Collapse</code> via <code>activeKey</code>.</li>
            <li><strong><code>editModalVisible</code></strong> + <strong><code>editingItem</code></strong> &mdash; controls the edit modal visibility and which material is being edited</li>
        </ul>
        <p>The <code>SectionData</code> structure preserves <code>expandedKeys</code> across data refetches. When the user edits or deletes a material and the page refetches, the <code>processAndGroupMaterials()</code> function reads the previous <code>expandedKeys</code> via <code>sectionData[cat.key]?.expandedKeys || []</code> and carries them into the new state. This means open group rows stay open after an update &mdash; the user does not lose their scroll position or expanded state.</p>

        <h3>6.2.5 &mdash; The 8 Material Category Panels</h3>
        <p>The page renders an Ant Design <code>Collapse</code> component with 8 panels, one per material category. The categories are defined in a constant <code>MATERIAL_CATEGORIES</code> array, each with a <code>key</code>, <code>label</code> (Turkish name), <code>icon</code> (Ant Design icon component), and <code>color</code>. The categories match the Hammadde Giri&#351;i page&rsquo;s card colors exactly:</p>

        <table style="width: 100%; border-collapse: collapse; margin: 16px 0;">
            <thead>
                <tr style="background: var(--bg-secondary);">
                    <th style="padding: 8px; text-align: left; border-bottom: 2px solid var(--border-color);">Category</th>
                    <th style="padding: 8px; text-align: left; border-bottom: 2px solid var(--border-color);">Key</th>
                    <th style="padding: 8px; text-align: left; border-bottom: 2px solid var(--border-color);">Icon</th>
                    <th style="padding: 8px; text-align: left; border-bottom: 2px solid var(--border-color);">Color</th>
                    <th style="padding: 8px; text-align: left; border-bottom: 2px solid var(--border-color);">Unit</th>
                    <th style="padding: 8px; text-align: left; border-bottom: 2px solid var(--border-color);">QR Prefix</th>
                </tr>
            </thead>
            <tbody>
                <tr><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Bak&#305;r (Copper)</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);"><code>raw_copper</code></td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);"><code>MenuOutlined</code></td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">#cd7f32 (bronze)</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">kg</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">A</td></tr>
                <tr><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Kalay (Tin)</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);"><code>raw_tin</code></td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);"><code>GoldOutlined</code></td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">#c0c0c0 (silver)</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">kg</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">B</td></tr>
                <tr><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Plastik (Plastic)</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);"><code>raw_plastic</code></td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);"><code>DockerOutlined</code></td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">#3498db (blue)</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">kg</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">C</td></tr>
                <tr><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Kataliz&ouml;r (Catalyst)</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);"><code>raw_catalyst</code></td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);"><code>ExperimentOutlined</code></td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">#9b59b6 (purple)</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">kg</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">D</td></tr>
                <tr><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Boya (Dye)</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);"><code>raw_dye</code></td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);"><code>BgColorsOutlined</code></td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">#e74c3c (red)</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">kg</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">E</td></tr>
                <tr><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Antirodent</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);"><code>raw_antirodent</code></td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);"><code>BugOutlined</code></td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">#27ae60 (green)</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">kg</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">F</td></tr>
                <tr><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Palet (Palette)</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);"><code>raw_palette</code></td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);"><code>BorderInnerOutlined</code></td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">#f39c12 (orange)</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">adet</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">I</td></tr>
                <tr><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Makara (Reel)</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);"><code>raw_reel</code></td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);"><code>PicCenterOutlined</code></td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">#1abc9c (teal)</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">adet</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">H</td></tr>
            </tbody>
        </table>
        <p>The Collapse component uses a custom <code>expandIcon</code> &mdash; a <code>RightOutlined</code> icon that rotates 90&deg; when the panel opens. The entire Collapse sits inside a borderless <code>Card</code> with 12px border-radius for a clean look.</p>

        <h3>6.2.6 &mdash; Panel Header: Inline Statistics Dashboard</h3>
        <p>Each panel header is not just a label &mdash; it is a mini dashboard that is visible even when the panel is collapsed. The header is a <code>flexbox</code> row with these elements from left to right:</p>
        <ol>
            <li><strong>Category icon:</strong> The material-specific icon, rendered at 18px font size in the category&rsquo;s color (e.g., bronze <code>MenuOutlined</code> for copper). The icon has a fixed 24px width for alignment across all panels.</li>
            <li><strong>Category name:</strong> Bold text at 15px (e.g., &ldquo;Bak&#305;r&rdquo;, &ldquo;Plastik&rdquo;).</li>
            <li><strong>Record count tag:</strong> An Ant Design <code>Tag</code> showing the total number of individual material records in this category (e.g., &ldquo;47 kay&#305;t&rdquo;). Only shown if the category has data.</li>
            <li><strong>Three aggregate statistics</strong> (pushed to the right via <code>marginLeft: 'auto'</code>):</li>
        </ol>
        <p>The three statistics are each a small vertical block (label above, value below) with <code>textAlign: 'right'</code> and <code>minWidth: 90px</code>:</p>
        <ul>
            <li><strong>Toplam (Total):</strong> Plain text. For kg-based materials, this is the sum of <code>remaining_weight</code> (or <code>weight</code> if remaining is null). For palette/reel, it&rsquo;s the sum of <code>weight</code> (which represents quantity/count). The label is a 10px, 50% opacity text reading &ldquo;Toplam&rdquo;. The value is bold 13px with Turkish locale formatting (e.g., &ldquo;12.456,3 kg&rdquo;).</li>
            <li><strong>Kullan&#305;mda (In Use):</strong> Blue <code>Tag</code>. Sum of quantities from items with <code>status === 'in_use'</code>. Label: 10px &ldquo;Kullan&#305;mda&rdquo;.</li>
            <li><strong>Serbest (Available):</strong> Green <code>Tag</code>. Sum of quantities from items with <code>status === 'received'</code> or <code>status === 'available'</code>. Label: 10px &ldquo;Serbest&rdquo;.</li>
        </ul>
        <p>The <code>getCategoryTotals()</code> function computes these three numbers by iterating over all groups in the category and summing their <code>total_quantity</code>, <code>reserved_quantity</code>, and <code>available_quantity</code>. The unit is determined by the category key &mdash; &ldquo;adet&rdquo; for <code>raw_palette</code>/<code>raw_reel</code>, &ldquo;kg&rdquo; for everything else.</p>

        <h3>6.2.7 &mdash; Three-Level Table Hierarchy</h3>
        <p>The page implements a three-level drill-down that lets users navigate from high-level category totals down to individual lot details:</p>

        <p><strong>Level 1 &mdash; Category Panel (Collapse):</strong> The 8 Collapse panels themselves. Each panel header shows category name + icon + aggregate statistics. Opening a panel reveals the Level 2 table. Multiple panels can be open simultaneously &mdash; the <code>activePanels</code> state is an array of keys.</p>

        <p><strong>Level 2 &mdash; Material Name Group Table:</strong> Inside each panel, a <code>Table</code> component groups materials by <code>material_name</code>. For example, under &ldquo;Plastik&rdquo;, you might see groups: &ldquo;HFX 500P&rdquo;, &ldquo;HFFR 302&rdquo;, &ldquo;XLPE 2003&rdquo;, &ldquo;PVC 70&rdquo;. Each group row shows 4 columns:</p>
        <table style="width: 100%; border-collapse: collapse; margin: 16px 0;">
            <thead>
                <tr style="background: var(--bg-secondary);">
                    <th style="padding: 8px; text-align: left; border-bottom: 2px solid var(--border-color);">Column</th>
                    <th style="padding: 8px; text-align: left; border-bottom: 2px solid var(--border-color);">Width</th>
                    <th style="padding: 8px; text-align: left; border-bottom: 2px solid var(--border-color);">Rendering</th>
                </tr>
            </thead>
            <tbody>
                <tr><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Malzeme Ad&#305; (Material Name)</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">250px</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Bold <code>fontWeight: 600</code> text + lot count in parentheses with <code>opacity: 0.5</code>, e.g. &ldquo;<strong>HFX 500P</strong> <span style="opacity:0.5">(12 lot)</span>&rdquo;</td></tr>
                <tr><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Toplam (Total)</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">120px</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);"><code>fontWeight: 500</code>, Turkish locale number formatting with max 1 decimal, e.g. &ldquo;4.523,8 kg&rdquo;</td></tr>
                <tr><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Kullan&#305;mda (In Use)</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">120px</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Blue <code>Tag</code> with formatted quantity + unit</td></tr>
                <tr><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Serbest (Available)</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">120px</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Green <code>Tag</code> with formatted quantity + unit</td></tr>
            </tbody>
        </table>
        <p>The table uses <code>pagination={false}</code> (all groups visible), <code>size=&quot;small&quot;</code> for compact rows, and <code>scroll={{ x: 'max-content' }}</code> for horizontal overflow. If a material has no <code>material_name</code>, it falls into a fallback group named &ldquo;{Category} (&#304;simsiz)&rdquo;.</p>

        <p><strong>Level 3 &mdash; Individual Lots (Expanded Row):</strong> Clicking the expand icon on a group row reveals a nested <code>Table</code> with the individual material entries. The nested table is rendered by <code>renderExpandedRow()</code> and uses a negative left margin (<code>margin: '8px 8px 8px -32px'</code>) to align with the parent table columns. If a group has no items, a centered message &ldquo;Detay bulunamad&#305;&rdquo; appears at 50% opacity. The detail table shows 7&ndash;8 columns:</p>
        <table style="width: 100%; border-collapse: collapse; margin: 16px 0;">
            <thead>
                <tr style="background: var(--bg-secondary);">
                    <th style="padding: 8px; text-align: left; border-bottom: 2px solid var(--border-color);">Column</th>
                    <th style="padding: 8px; text-align: left; border-bottom: 2px solid var(--border-color);">Width</th>
                    <th style="padding: 8px; text-align: left; border-bottom: 2px solid var(--border-color);">Behavior</th>
                </tr>
            </thead>
            <tbody>
                <tr><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">QR Kod</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">100px</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Fixed left (<code>fixed: 'left'</code>). Blue <code>Tag</code> showing the deterministic QR code (A1, B3, C12, etc.)</td></tr>
                <tr><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">&Ouml;l&ccedil;&uuml;len / Miktar</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">100px</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Title adapts: &ldquo;&Ouml;l&ccedil;&uuml;len&rdquo; (Measured) for kg types, &ldquo;Miktar&rdquo; (Quantity) for palette/reel. Shows <code>weight</code> field with locale formatting + unit.</td></tr>
                <tr><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Kalan (Remaining)</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">100px</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);"><strong>Conditionally included</strong> &mdash; column is completely absent for palette/reel (spread operator with empty array). Uses <code>remaining_weight ?? weight ?? 0</code> fallback. <strong>Color-coded</strong> (see 6.2.8).</td></tr>
                <tr><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Durum (Status)</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">100px</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Color-coded Ant Design <code>Tag</code>: <span style="color:green">green</span>=Teslim Al&#305;nd&#305;, <span style="color:#2563eb">blue</span>=Mevcut, <span style="color:orange">orange</span>=Kullan&#305;mda, grey=T&uuml;kendi, <span style="color:red">red</span>=Reddedildi</td></tr>
                <tr><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Tedarik&ccedil;i (Supplier)</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">120px</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Blue <code>Tag</code> if supplier exists, plain &ldquo;-&rdquo; if null/undefined</td></tr>
                <tr><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Lot No</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">100px</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Blue <code>Tag</code> if lot number exists, plain &ldquo;-&rdquo; if null/undefined</td></tr>
                <tr><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Giri&#351; Tarihi (Entry Date)</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">110px</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Date rendered at <code>opacity: 0.8</code>. Uses <code>dayjs.utc(date).tz('Europe/Istanbul').format('DD.MM.YY')</code> &mdash; converts UTC server time to Turkey timezone.</td></tr>
                <tr><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">&#304;&#351;lem (Actions)</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">80px</td><td style="padding: 6px 8px; border-bottom: 1px solid var(--border-color);">Fixed right (<code>fixed: 'right'</code>). Two <code>Button</code> components: <code>EditOutlined</code> (default color) and <code>DeleteOutlined</code> (red <code>#ff4d4f</code>). Both are <code>type=&quot;text&quot;</code>, <code>size=&quot;small&quot;</code> with 4px spacing.</td></tr>
            </tbody>
        </table>

        <h3>6.2.8 &mdash; Conditional Weight Coloring</h3>
        <p>The &ldquo;Kalan&rdquo; (Remaining) column is one of the most operationally important visual features on this page. It uses conditional coloring to provide instant visual feedback about material consumption levels. The logic computes two boolean flags for each row:</p>
        <ul>
            <li><code>isReduced = currentWeight &lt; originalWeight * 0.95</code> &mdash; the material has been partially consumed (more than 5% used)</li>
            <li><code>isLow = currentWeight &lt; originalWeight * 0.2</code> &mdash; the material is critically low (less than 20% remaining)</li>
        </ul>
        <p>The rendering rules:</p>
        <ul>
            <li><strong>Normal (no color, normal weight):</strong> <code>remaining_weight &ge; 95%</code> of original &mdash; material is barely touched or freshly entered</li>
            <li><strong style="color: #faad14;">Yellow (#faad14) + bold (fontWeight: 600):</strong> <code>remaining_weight &lt; 95%</code> but &ge; 20% of original &mdash; partially consumed, draw attention</li>
            <li><strong style="color: #ff4d4f;">Red (#ff4d4f) + bold (fontWeight: 600):</strong> <code>remaining_weight &lt; 20%</code> of original &mdash; critically low, needs reorder</li>
        </ul>
        <p>Concrete example: A 1,000 kg copper wire rod (QR: A1) shows normal text until it drops below 950 kg. At 949 kg it turns yellow. At 199 kg it turns red. The <code>currentWeight</code> is computed as <code>remaining_weight ?? weight ?? 0</code> for backward compatibility with older records that don&rsquo;t have <code>remaining_weight</code> set.</p>
        <p>For palette and reel materials, this column is <strong>completely absent</strong> from the table &mdash; not hidden, but conditionally excluded from the columns array using a spread with empty array: <code>...(!isPaletteOrReel ? [{ ... }] : [])</code>. Counted items don&rsquo;t have a remaining weight concept &mdash; they are either available or consumed as whole units.</p>

        <h3>6.2.9 &mdash; Unit Adaptation: kg vs adet</h3>
        <p>The page dynamically adapts its behavior based on whether a material is measured by weight or counted as discrete pieces. This distinction affects <strong>five different places</strong> in the UI:</p>
        <ol>
            <li><strong>Panel header statistics:</strong> Show &ldquo;kg&rdquo; or &ldquo;adet&rdquo; after aggregate numbers</li>
            <li><strong>Group table columns:</strong> Unit suffix on Toplam, Kullan&#305;mda, Serbest values</li>
            <li><strong>Detail table column title:</strong> &ldquo;&Ouml;l&ccedil;&uuml;len&rdquo; (Measured) for kg types vs &ldquo;Miktar&rdquo; (Quantity) for adet types</li>
            <li><strong>Detail table &ldquo;Kalan&rdquo; column:</strong> Completely hidden for palette/reel</li>
            <li><strong>Edit modal:</strong> The &ldquo;Kalan A&#287;&#305;rl&#305;k (kg)&rdquo; field is hidden for palette/reel types</li>
        </ol>
        <p>The determination is made by checking <code>materialType === 'raw_palette' || materialType === 'raw_reel'</code>. These are the only two count-based categories &mdash; all six others use kg. For quantity calculations in the grouping logic, palette/reel materials read from <code>item.weight</code> (which stores the count), while kg-based materials read from <code>item.remaining_weight ?? item.weight</code>.</p>

        <h3>6.2.10 &mdash; Client-Side Grouping Logic</h3>
        <p>The <code>processAndGroupMaterials()</code> function is the core data transformation engine. It takes the flat API response and produces the hierarchical <code>sectionData</code> structure. The function runs in four stages:</p>
        <ol>
            <li><strong>Category filter:</strong> For each of the 8 categories, filter <code>materials.filter(m =&gt; m.material_type === cat.key)</code></li>
            <li><strong>Name grouping:</strong> Within each category, build a <code>Record&lt;string, RawMaterial[]&gt;</code> keyed by <code>material_name</code>. If <code>material_name</code> is null/empty, the key becomes &ldquo;{label} (&#304;simsiz)&rdquo; (e.g., &ldquo;Bak&#305;r (&#304;simsiz)&rdquo;)</li>
            <li><strong>Group aggregation:</strong> For each group, create a <code>MaterialGroupSummary</code> object:
                <ul>
                    <li><code>total_quantity</code>: Sum of <code>remaining_weight ?? weight ?? 0</code> for kg types, or <code>weight ?? 0</code> for adet types, across ALL items regardless of status</li>
                    <li><code>reserved_quantity</code>: Sum from items where <code>status === 'in_use'</code></li>
                    <li><code>available_quantity</code>: Sum from items where <code>status === 'received' || status === 'available'</code></li>
                    <li>Items with other statuses (<code>consumed</code>, <code>rejected</code>) are counted in <code>total_quantity</code> but not in reserved or available &mdash; they effectively represent consumed or discarded stock</li>
                </ul>
            </li>
            <li><strong>State preservation:</strong> Carry forward the previous <code>expandedKeys</code> from the existing <code>sectionData</code>, so open group rows remain open after a data refresh</li>
        </ol>

        <h3>6.2.11 &mdash; The Edit Modal</h3>
        <p>The edit modal uses Ant Design&rsquo;s <code>Modal</code> + <code>Form</code> pattern. It is a single variant (unlike Hammaddeler Listesi&rsquo;s three variants) because this page provides a simplified stock-adjustment interface rather than full material editing:</p>
        <ul>
            <li><strong>Title:</strong> &ldquo;D&uuml;zenle: {QR_CODE}&rdquo; (e.g., &ldquo;D&uuml;zenle: C8&rdquo;)</li>
            <li><strong>Width:</strong> 400px (compact)</li>
            <li><strong>Field 1 &mdash; Kalan A&#287;&#305;rl&#305;k (kg):</strong> <code>Form.Item</code> wrapping an <code>InputNumber</code> with <code>min={0}</code>, <code>step={0.1}</code>, <code>style={{ width: '100%' }}</code>. Pre-filled with <code>remaining_weight ?? weight</code>. <strong>Conditionally rendered</strong> &mdash; the entire <code>Form.Item</code> is wrapped in a check: <code>editingItem?.material_type !== 'raw_palette' &amp;&amp; editingItem?.material_type !== 'raw_reel'</code>. For palette/reel materials, only the status field appears.</li>
            <li><strong>Field 2 &mdash; Durum (Status):</strong> <code>Form.Item</code> wrapping a <code>Select</code> with 5 options:
                <ul>
                    <li><code>received</code> &rarr; &ldquo;Teslim Al&#305;nd&#305;&rdquo;</li>
                    <li><code>available</code> &rarr; &ldquo;Mevcut&rdquo;</li>
                    <li><code>in_use</code> &rarr; &ldquo;Kullan&#305;mda&rdquo;</li>
                    <li><code>consumed</code> &rarr; &ldquo;T&uuml;kendi&rdquo;</li>
                    <li><code>rejected</code> &rarr; &ldquo;Reddedildi&rdquo;</li>
                </ul>
            </li>
            <li><strong>OK button:</strong> Text &ldquo;G&uuml;ncelle&rdquo;. Triggers <code>form.submit()</code> which calls <code>handleUpdate()</code>.</li>
            <li><strong>Cancel button:</strong> Text &ldquo;&#304;ptal&rdquo;. Closes modal, resets form, clears <code>editingItem</code>.</li>
        </ul>
        <p>Unlike the Hammaddeler Listesi edit modal, this modal does <strong>not</strong> allow editing QR codes, lot numbers, supplier names, or photos. It is strictly for stock-level adjustments: correcting remaining weight and updating status.</p>

        <h3>6.2.12 &mdash; Loading and Empty States</h3>
        <p>The page handles two empty-data scenarios:</p>
        <ul>
            <li><strong>Loading state:</strong> While <code>loading</code> is true, each panel&rsquo;s content area shows a centered <code>Spin</code> component with &ldquo;Y&uuml;kleniyor...&rdquo; text below it (12px margin-top, 60% opacity). The &ldquo;Yenile&rdquo; button in the page header also shows a spinner via <code>loading={loading}</code>.</li>
            <li><strong>Empty category:</strong> If a category has no materials (e.g., no antirodent in stock), the panel content shows Ant Design&rsquo;s <code>Empty</code> component with <code>description=&quot;Bu kategoride stok bulunamad&#305;&rdquo;</code> (No stock found in this category) and <code>PRESENTED_IMAGE_SIMPLE</code> (the minimal empty illustration).</li>
        </ul>

        <h3>6.2.13 &mdash; Timezone Handling</h3>
        <p>All dates from the API are stored as UTC in the database. The frontend converts them to Turkey timezone for display using <code>dayjs</code> with the <code>utc</code> and <code>timezone</code> plugins:</p>
        <ul>
            <li>The timezone constant is defined at module level: <code>const TURKEY_TZ = 'Europe/Istanbul'</code></li>
            <li>Date rendering: <code>dayjs.utc(date).tz(TURKEY_TZ).format('DD.MM.YY')</code></li>
            <li>This ensures a material entered at 23:30 UTC on January 15 shows as January 16 in the Turkish display (UTC+3), correctly reflecting the local date of entry</li>
        </ul>

        <h3>6.2.14 &mdash; Connection to Other Modules</h3>
        <p>Hammadde Stok does not exist in isolation &mdash; it is essentially a <strong>read-only window</strong> into data that is created, modified, and consumed by other modules. Understanding those connections is key to understanding this page:</p>

        <p><strong>Upstream: Who fills the inventory?</strong></p>
        <ul>
            <li><strong>Hammadde Giri&#351;i (Material Entry)</strong> &mdash; the sole creator. Every single row visible on this page was created through one of the four entry archetypes in Hammadde Giri&#351;i. When a copper wire rod arrives, an operator weighs it, scans photos, assigns QR code A{n}, and it enters the <code>materials</code> table with <code>status = 'received'</code> and <code>remaining_weight = weight</code>. That record immediately becomes visible here under the &ldquo;Bak&#305;r&rdquo; panel. Hammadde Stok cannot create, only view.</li>
            <li><strong>Hammadde Sipari&#351; (Material Orders)</strong> &mdash; the reason materials arrive in the first place. When a purchase order is fulfilled and materials are delivered, the entry operator can link the material to the order group code (R1, R2, etc.). This traceability exists in the data but is <strong>not displayed</strong> on this page &mdash; it&rsquo;s visible on Hammaddeler Listesi&rsquo;s &ldquo;Sipari&#351; No&rdquo; column instead.</li>
            <li><strong>Tedarik&ccedil;i Y&ouml;netimi (Supplier Management)</strong> &mdash; defines the supplier names that appear in the detail rows. The supplier association is set at entry time and is read-only here.</li>
        </ul>

        <p><strong>Downstream: Who drains the inventory?</strong></p>
        <ul>
            <li><strong>&Uuml;retim / Production (especially Kabatel &Ccedil;ekme)</strong> &mdash; the primary consumer. When Production starts a work card, it selects raw materials by QR code. For wire drawing (Kabatel &Ccedil;ekme), an operator picks a copper rod (e.g., A7) and feeds it into the machine. Production then updates the material record: <code>status</code> changes from <code>received</code>/<code>available</code> to <code>in_use</code>, and <code>remaining_weight</code> decreases as material is consumed. When the rod is fully used, <code>status</code> becomes <code>consumed</code>. This is the entire reason the &ldquo;Kalan&rdquo; column exists with its yellow/red coloring &mdash; it visualizes how much Production has consumed. Similarly, plastic granules, tin, catalysts, and dyes are consumed by their respective production steps (extrusion, tinning, etc.).</li>
            <li><strong>Lab (indirect)</strong> &mdash; Lab tests may result in a material being <code>rejected</code>, which changes its status and effectively removes it from the &ldquo;Serbest&rdquo; (Available) count on this page.</li>
        </ul>

        <p><strong>Sibling views over the same data:</strong></p>
        <ul>
            <li><strong>Hammaddeler Listesi (in Hammadde module)</strong> &mdash; reads from the exact same <code>/api/materials/list</code> endpoint. It is the full-power admin view: 14 columns, lazy-loaded photos, WebSocket real-time sync, bilingual search, three edit form variants, QR label printing, 12 granular permissions. This page is the <em>record-level</em> view; Hammadde Stok is the <em>stock-level</em> view. Together they cover different user needs over identical data.</li>
            <li><strong>Projeksiyon (in Stock module)</strong> &mdash; also uses material data, but for a completely different purpose. Projeksiyon computes what the stock <em>will be</em> in future weeks by combining current inventory + incoming orders &minus; production requirements. Hammadde Stok shows what the stock <em>is right now</em>. They are complementary: one is a live snapshot, the other is a weekly forecast.</li>
        </ul>

        <h3>6.2.15 &mdash; Permission Model</h3>
        <p>The page uses the <code>canStok</code> route guard from <code>access.ts</code> for page-level access. The permission manifest in <code>permissionManifest.ts</code> defines 5 buttons for this page:</p>
        <ul>
            <li><code>access_page</code> &mdash; can access the Hammadde Stok page</li>
            <li><code>view_table</code> &mdash; can see the category tables</li>
            <li><code>view_details</code> &mdash; can expand groups to see individual lots</li>
            <li><code>edit_stock</code> &mdash; can open the edit modal</li>
            <li><code>adjust_quantity</code> &mdash; can modify remaining weight values</li>
        </ul>
        <p>However, unlike Hammaddeler Listesi which enforces permissions at the button level (e.g., disabling the print button without <code>print_qr</code> permission), this page does <strong>not</strong> enforce button-level checks in the frontend. The edit and delete buttons are always rendered for any user who has page access. Permission enforcement happens at the API level only.</p>

        <h3>6.2.16 &mdash; What This Submodule Does NOT Do</h3>
        <ul>
            <li>It does <strong>not</strong> have its own backend routes &mdash; it consumes the Hammadde module&rsquo;s <code>material_routes.py</code> endpoints</li>
            <li>It does <strong>not</strong> support material creation &mdash; that happens exclusively in Hammadde Giri&#351;i</li>
            <li>It does <strong>not</strong> use WebSocket for real-time updates &mdash; data is fetched once on mount and refreshed manually or after edit/delete operations. Compare with Hammaddeler Listesi which subscribes to <code>materials</code> and <code>all</code> WebSocket rooms</li>
            <li>It does <strong>not</strong> have server-side filtering or pagination &mdash; all 8-way category filtering, name-based grouping, and quantity aggregation is client-side</li>
            <li>It does <strong>not</strong> show material photos &mdash; no delivery or test photos are displayed. These are only visible in Hammaddeler Listesi</li>
            <li>It does <strong>not</strong> show order linkage &mdash; the &ldquo;Sipari&#351; No&rdquo; (order group code) column exists in Hammaddeler Listesi but not here</li>
            <li>It does <strong>not</strong> support printing &mdash; no QR label reprint functionality. That is in Hammaddeler Listesi</li>
            <li>It does <strong>not</strong> have a client-side search bar &mdash; browsing is done by expanding category panels and group rows</li>
            <li>It does <strong>not</strong> track consumption history &mdash; it shows the current snapshot only, not a timeline of weight changes</li>
            <li>It does <strong>not</strong> have soft-delete &mdash; the delete operation uses <code>/hard-delete</code>, permanently removing the record</li>
        </ul>

        <div class="insight">
            <p style="margin-bottom: 0;"><strong>Hammadde Stok vs Hammaddeler Listesi &mdash; same data, different purpose:</strong> Both pages read from the same <code>/api/materials/list</code> endpoint and display the same <code>materials</code> table data. The difference is perspective. Hammaddeler Listesi (in the Hammadde module) is the full-power admin view: 14 columns, lazy photos, WebSocket, bilingual search, three edit form variants, printing, 12 granular permissions. Hammadde Stok (in the Stock module) is the <strong>stock manager&rsquo;s view</strong>: grouped by category and material name, with aggregate totals front and center, optimized for answering &ldquo;how much do we have?&rdquo; rather than &ldquo;what is the full history of this lot?&rdquo; The edit modal here is deliberately minimal (weight + status only) because the full edit belongs in the Hammadde module.</p>
        </div>

        <!-- placeholder: 6.3 ÃrÃ¼n Stok will be added here -->

        <!-- placeholder: Section 7 CONCLUSION will be added here -->

    </main>
</body>
</html>
